{"version":3,"sources":["meta/compile/Expression.js"],"names":[],"mappings":"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","file":"meta/compile/Expression.js","sourcesContent":["import tuple from 'esast/dist/private/tuple'\nimport Loc from 'esast/dist/Loc'\nimport { JsGlobals, KAssign, KFun, SpecialKeywords } from './private/Lang'\nimport Op, { None } from './private/U/Op'\nimport { newSet } from './private/U/util'\n\nexport default class Expression { }\n// These can only appear as lines in a Block.\n// Not to be confused with Generator expressions resulting from `do` keyword.\nexport class Do extends Expression { }\n// These can appear in any expression.\nexport class Val extends Expression { }\n\nconst makeType = superType => (name, ...namesTypes) =>\n\ttuple(name, superType, 'doc', [ 'loc', Loc ].concat(namesTypes))\nconst\n\tee = makeType(Expression), ed = makeType(Do), ev = makeType(Val)\n\n// TODO: Get rid of null\nconst KSpecial = newSet(SpecialKeywords, [ 'contains', 'debugger', 'sub', 'null' ])\n\nexport const\n\tDebug = ed('Debug', 'lines', [Expression]),\n\tBlockDo = ed('BlockDo', 'lines', [Expression]),\n\tBlockVal = ed('BlockVal', 'lines', [Expression], 'returned', Val),\n\tModuleDefaultExport = ed('ModuleDefaultExport', 'value', Val),\n\tLocalDeclare = Object.assign(\n\t\tee('LocalDeclare',\n\t\t\t'name', String, 'opType', Op(Val), 'isLazy', Boolean, 'okToNotUse', Boolean),\n\t\t{\n\t\t\tfocus: loc => LocalDeclare(loc, '_', None, false, false),\n\t\t\tres: (loc, opType) => LocalDeclare(loc, 'res', opType, false, true)\n\t\t}),\n\tAssign = Object.assign(\n\t\ted('Assign', 'assignee', LocalDeclare, 'k', KAssign, 'value', Val),\n\t\t{ focus: (loc, value) => Assign(loc, LocalDeclare.focus(loc), '=', value) }),\n\tAssignDestructure = ed('AssignDestructure',\n\t\t'assignees', [LocalDeclare],\n\t\t'k', KAssign,\n\t\t'value', Val,\n\t\t'isLazy', Boolean),\n\tLocalAccess = Object.assign(\n\t\tev('LocalAccess', 'name', String),\n\t\t{ focus: loc => LocalAccess(loc, '_') }),\n\tGlobalAccess = Object.assign(\n\t\tev('GlobalAccess', 'name', JsGlobals),\n\t\t{\n\t\t\tnull: loc => GlobalAccess(loc, 'null'),\n\t\t\ttrue: loc => GlobalAccess(loc, 'true')\n\t\t}),\n\t// Module\n\tUseDo = ee('UseDo', 'path', String),\n\tUse = ee('Use', 'path', String, 'used', [LocalDeclare], 'opUseDefault', Op(LocalDeclare)),\n\t// `block` will contain ModuleExport and ModuleDefaultExport_s\n\t// TODO: BlockVal and don't have `exports` object\n\tModule = ee('Module', 'doUses', [UseDo], 'uses', [Use], 'debugUses', [Use], 'block', BlockDo),\n\n\t// Data\n\t// TODO: Don't store index here, do it in Vr\n\tListEntry = ed('ListEntry', 'value', Val, 'index', Number),\n\t// TODO: Don't store length here, do it in Vr\n\tListReturn = ev('ListReturn', 'length', Number),\n\tListSimple = ev('ListSimple', 'parts', [Val]),\n\n\t// TODO: Don't store index here, do it in Vr\n\tMapEntry = ed('MapEntry', 'key', Val, 'val', Val, 'index', Number),\n\t// TODO: Don't store length here, do it in Vr\n\tMapReturn = ev('MapReturn', 'length', Number),\n\tObjReturn = ev('ObjReturn',\n\t\t'keys', [LocalDeclare],\n\t\t'debugKeys', [LocalDeclare],\n\t\t'opObjed', Op(Val),\n\t\t'opDisplayName', Op(String)),\n\t// keysVals: values are Vals\n\tObjSimple = ev('ObjSimple', 'keysVals', Object),\n\n\t// Case\n\tCaseDoPart = ee('CaseDoPart', 'test', Val, 'result', BlockDo),\n\tCaseValPart = ee('CaseValPart', 'test', Val, 'result', BlockVal),\n\tCaseDo = ed('CaseDo', 'opCased', Op(Assign), 'parts', [CaseDoPart], 'opElse', Op(BlockDo)),\n\t// Unlike CaseDo, this has `return` statements.\n\tCaseVal = ev('CaseVal', 'opCased', Op(Assign), 'parts', [CaseValPart], 'opElse', Op(BlockVal)),\n\n\t// Statements\n\tLoop = ed('Loop', 'block', BlockDo),\n\tEndLoop = ed('EndLoop'),\n\n\t// Generators\n\tYield = ev('Yield', 'yielded', Val),\n\tYieldTo = ev('YieldTo', 'yieldedTo', Val),\n\n\t// Expressions\n\tCall = Object.assign(\n\t\tev('Call', 'called', Val, 'args', [Val]),\n\t\t{\n\t\t\tcontains: (loc, testType, tested) =>\n\t\t\t\tCall(loc, Special.contains(loc), [ testType, tested ]),\n\t\t\tsub: (loc, args) => Call(loc, Special.sub(loc), args)\n\t\t}),\n\t// Only for use in a Call\n\tSplat = ev('Splat', 'splatted', Val),\n\n\tBlockWrap = ev('BlockWrap', 'block', BlockVal),\n\n\tFun = ev('Fun',\n\t\t'k', KFun,\n\t\t'args', [LocalDeclare],\n\t\t'opRestArg', Op(LocalDeclare),\n\t\t// BlockDo or BlockVal\n\t\t'block', Expression,\n\t\t'opIn', Op(Debug),\n\t\t// If non-empty, block should be a BlockVal, and either it has a type or opOut is non-empty.\n\t\t'opResDeclare', Op(LocalDeclare),\n\t\t'opOut', Op(Debug)),\n\n\tLazy = ev('Lazy', 'value', Val),\n\tELiteral = ev('Literal', 'value', String, 'k', newSet([Number, String, 'js'])),\n\tMember = ev('Member', 'object', Val, 'name', String),\n\tQuote = ev('Quote', 'parts', [Val]),\n\n\tSpecial = Object.assign(\n\t\tev('Special', 'k', KSpecial),\n\t\t{\n\t\t\tcontains: loc => Special(loc, 'contains'),\n\t\t\tdebugger: loc => Special(loc, 'debugger'),\n\t\t\tsub: loc => Special(loc, 'sub')\n\t\t})\n\n"],"sourceRoot":"/src"}