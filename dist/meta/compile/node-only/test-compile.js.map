{"version":3,"sources":["meta/compile/node-only/test-compile.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,OAAM,IAAI,GAAG,UAAA,KAAK,EAAI;AACrB,QAAM,KAAK,GAAG,eAjBN,KAAK,EAiBY,CAAA;AACzB,QAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,OAAO,CAAC,UAAA,IAAI;UAC9B,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,CAAC;GAAA,CAAC,CAAA;AAC9B,OAAK,CAAC,EAAE,CAAC,UAAU,EAAE,YAAW;AAC/B,OAAI,CAAC,OAAO,CAAC,UAAA,CAAC,EAAI;AACjB,UAAM,EAAE,GAAG,UAAQ,CAAC,CAAC,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAA;AACtD,WAAO,CAAC,GAAG,MAAI,CAAC,CAAC,IAAI,UAAK,EAAE,iBAAY,CAAC,CAAC,EAAE,QAAK,CAAA;IACjD,CAAC,CAAA;GACF,CAAC,CAAA;AACF,OAAK,CAAC,EAAE,CAAC,OAAO,EAAE,UAAA,GAAG,EAAI;AACxB,SAAM,GAAG,CAAC,MAAM,CAAC,KAAK,CAAA;GACtB,CAAC,CAAA;AACF,OAAK,CAAC,GAAG,EAAE,CAAA;EACX,CAAA;;kBAEc,YAAM;AACpB,QAAM,CAAC,KAAK,GAAG,IAAI,CAAA;;AAEnB,QAAM,MAAM,GAAG,KAAG,YAAY,CAAC,cAAc,EAAE,OAAO,CAAC,CAAA;AACvD,QAAM,IAAI,GAAG,aAtBL,cAAc,CAsBM;AAC3B,SAAM,EAAE,cAAc;GACtB,CAAC,CAAA;AACF,QAAM,EAAE,GAAG,QAAO,IAAI,CAAC,CAAA;;AAEvB,QAAM,CAAC,GAAG,KAAI,EAAE,EAAE,MAAM,CAAC,CAAA;;AAEzB,QAAM,CAAC,GAAG,OAAM,EAAE,EAAE,CAAC,CAAC,CAAA;;AAEtB,QAAM,EAAE,GAAG,QAAO,EAAE,EAAE,CAAC,CAAC,CAAA;;AAExB,QAAM,GAAG,GAAG,WAAU,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC,CAAA;;;gBAEf,SAAO,EAAE,EAAE,GAAG,CAAC;;QAAxB,IAAI,WAAJ,IAAI;;AACZ,gBArCQ,GAAG,WAqCC,IAAI,CAAG,CAAA;;;AAGnB,QAAM,CAAC,gBAAgB,GAAG;UACzB,cAAa,eAjDF,UAAU,CAiDO,EAAE,CAAC,EAAE,MAAM,CAAC;GAAA,CAAA;AACzC,QAAM,UAAU,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAA;AAC5C,QAAM,CAAC,YAAY,GAAG;UACrB,UAAS,eApDE,UAAU,CAoDG,EAAE,CAAC,EAAE,UAAU,CAAC;GAAA,CAAA;;AAEzC,MAAI,CAAC;AACJ,eAAY,EAAE;WAAM,MAAM,CAAC,gBAAgB,EAAE;IAAA;AAC7C,WAAQ,EAAE;WAAM,MAAM,CAAC,YAAY,EAAE;IAAA;AACrC,cAAW,EAAE;WAAM,KAAI,EAAE,EAAE,MAAM,CAAC;IAAA;AAClC,QAAK,EAAE;WAAM,OAAM,EAAE,EAAE,CAAC,CAAC;IAAA;AACzB,SAAM,EAAE;WAAM,QAAO,EAAE,EAAE,CAAC,CAAC;IAAA;AAC3B,YAAS,EAAE;WAAM,WAAU,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;IAAA;AACrC,SAAM,EAAE;WAAM,SAAO,EAAE,EAAE,GAAG,CAAC;IAAA;GAC7B,CAAC,CAAA;;AAEF,QACC,KAAK,GAAG,QAAQ,CAAC,CAAC,EAAE,UAAA,CAAC;UAAI,CAAC,wBAAsB;GAAA,CAAC;QACjD,OAAO,GAAG,QAAQ,CAAC,GAAG,EAAE,UAAA,CAAC;UAAI,CAAC,0BAtEvB,IAAI,AAsEmC;GAAA,CAAC,CAAA;AAChD,gBA3DQ,GAAG,4BA2DkB,KAAK,CAAC,IAAI,OAAI,CAAA;AAC3C,gBA5DQ,GAAG,mBA4DS,OAAO,CAAC,IAAI,mBAAc,OAAO,CAAC,OAAO,OAAI,CAAA;AACjE,gBA7DQ,GAAG,mBA6DS,IAAI,CAAC,MAAM,kBAAe,CAAA;EAC9C;;AAED,OAAM,QAAQ,GAAG,UAAC,IAAI,EAAE,IAAI,EAAK;AAChC,QAAM,OAAO,GAAG,IAAI,GAAG,EAAE,CAAA;AACzB,MAAI,OAAO,GAAG,CAAC,CAAA;AACf,QAAM,KAAK,GAAG,UAAA,IAAI,EAAI;AACrB,OAAI,IAAI,IAAI,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EACrC,IAAI,IAAI,CAAC,IAAI,CAAC,EAAE;AACf,WAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAA;AACjB,UAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,UAAA,IAAI,EAAI;AAChD,WAAM,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,CAAA;AACxB,SAAI,KAAK,YAAY,KAAK,EACzB,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAA,KAEpB,KAAK,CAAC,KAAK,CAAC,CAAA;KACb,CAAC,CAAA;IACF,MACA,OAAO,GAAG,OAAO,GAAG,CAAC,CAAA;GACvB,CAAA;AACD,OAAK,CAAC,IAAI,CAAC,CAAA;AACX,SAAO,EAAE,IAAI,EAAE,OAAO,CAAC,IAAI,EAAE,OAAO,EAAP,OAAO,EAAE,CAAA;EACtC,CAAA","file":"meta/compile/node-only/test-compile.js","sourcesContent":["import { Suite } from 'benchmark'\nimport { Node } from 'esast/dist/ast'\nimport fs from 'fs'\nimport numeral from 'numeral'\nimport Expression from '../Expression'\nimport Cx, { SubContext } from '../private/Cx'\nimport lex from '../private/lex/lex'\nimport lexUngrouped from '../private/lex/ungrouped'\nimport lexGroup from '../private/lex/group'\nimport parse from '../private/parse/parse'\nimport render from '../private/render'\nimport transpile from '../private/transpile/transpile'\nimport verify from '../private/verify'\nimport { log } from '../private/U/util'\nimport { OptsFromObject } from '../private/Opts'\n\nconst test = tests => {\n\tconst suite = new Suite()\n\tObject.keys(tests).forEach(name =>\n\t\tsuite.add(name, tests[name]))\n\tsuite.on('complete', function() {\n\t\tthis.forEach(_ => {\n\t\t\tconst ms = numeral(_.stats.mean * 1000).format('0.00')\n\t\t\tconsole.log(`${_.name}: ${ms}ms mean, ${_.hz}Hz`)\n\t\t})\n\t})\n\tsuite.on('error', err => {\n\t\tthrow err.target.error\n\t})\n\tsuite.run()\n}\n\nexport default () => {\n\tglobal.DEBUG = true\n\n\tconst source = fs.readFileSync('./ms-test.ms', 'utf-8')\n\tconst opts = OptsFromObject({\n\t\tinFile: './ms-test.ms'\n\t})\n\tconst cx = new Cx(opts)\n\n\tconst t = lex(cx, source)\n\t// log(`==>\\n${t}`)\n\tconst e = parse(cx, t)\n\t// log(`==>\\n${e}`)\n\tconst vr = verify(cx, e)\n\t// log(`+++\\n${vr})\n\tconst ast = transpile(cx, e, vr)\n\t// log(`==>\\n${ast}`)\n\tconst { code } = render(cx, ast)\n\tlog(`==>\\n${code}`)\n\n\t// Benchmark has problems if I don't put these in global variables...\n\tglobal.lexUngroupedTest = () =>\n\t\tlexUngrouped(new SubContext(cx), source)\n\tconst tUngrouped = global.lexUngroupedTest()\n\tglobal.lexGroupTest = () =>\n\t\tlexGroup(new SubContext(cx), tUngrouped)\n\n\ttest({\n\t\tlexUngrouped: () => global.lexUngroupedTest(),\n\t\tlexGroup: () => global.lexGroupTest(),\n\t\t'lex (all)': () => lex(cx, source),\n\t\tparse: () => parse(cx, t),\n\t\tverify: () => verify(cx, e),\n\t\ttranspile: () => transpile(cx, e, vr),\n\t\trender: () => render(cx, ast)\n\t})\n\n\tconst\n\t\teSize = treeSize(e, _ => _ instanceof Expression),\n\t\tastSize = treeSize(ast, _ => _ instanceof Node)\n\tlog(`Expression tree size: ${eSize.size}.`)\n\tlog(`ES AST size: ${astSize.size}, nLeaves: ${astSize.nLeaves}.`)\n\tlog(`Output size: ${code.length} characters.`)\n}\n\nconst treeSize = (tree, cond) => {\n\tconst visited = new Set()\n\tlet nLeaves = 0\n\tconst visit = node => {\n\t\tif (node != null && !visited.has(node))\n\t\t\tif (cond(node)) {\n\t\t\t\tvisited.add(node)\n\t\t\t\tObject.getOwnPropertyNames(node).forEach(name => {\n\t\t\t\t\tconst child = node[name]\n\t\t\t\t\tif (child instanceof Array)\n\t\t\t\t\t\tchild.forEach(visit)\n\t\t\t\t\telse\n\t\t\t\t\t\tvisit(child)\n\t\t\t\t})\n\t\t\t} else\n\t\t\t\tnLeaves = nLeaves + 1\n\t}\n\tvisit(tree)\n\treturn { size: visited.size, nLeaves }\n}\n"],"sourceRoot":"/src"}