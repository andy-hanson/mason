{"version":3,"sources":["meta/compile/private/transpile/transpile.js"],"names":[],"mappings":";;;;;;;;;;mBAyBwB,SAAS;;;;AAFjC,KAAI,EAAE,EAAE,EAAE,EAAE,aAAa,CAAA;;AAEV,UAAS,SAAS,CAAC,GAAG,EAAE,CAAC,EAAE,GAAG,EAAE;AAC9C,IAAE,GAAG,GAAG,CAAA;AACR,IAAE,GAAG,GAAG,CAAA;AACR,eAAa,GAAG,KAAK,CAAA;AACrB,QAAM,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;;AAEhB,IAAE,GAAG,EAAE,GAAG,SAAS,CAAA;AACnB,SAAO,GAAG,CAAA;EACV;;AAEM,OAAM,CAAC,GAAG,UAAC,IAAI,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAK;AAC3C,QAAM,GAAG,GAAG,IAAI,CAAC,gBAAgB,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAA;AAClD,MAAI,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,EAAE,GAAG,YAAY,KAAK,CAAA,AAAC;;AAEjD,MAAG,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAA;AACnB,SAAO,GAAG,CAAA;EACV,CAAA;;SANY,CAAC,GAAD,CAAC;AAQd,UAAS,cAAc,CAAC,IAAI,EAAE,YAAY,EAAE,KAAK,EAAE;;;AAClD,MAAI,IAAI,KAAK,SAAS,EACrB,IAAI,GAAG,EAAE,CAAA;AACV,MAAI,YAAY,KAAK,SAAS,EAC7B,YAAY,GAAG,KAAK,QApCL,IAAI,AAoCQ,CAAA;AAC5B,QAAM,IAAI,GAAG,MAtCL,OAAO,CAsCM,IAAI,CAAC,KAAK,EAAE,UAAA,IAAI;UAAI,eA7CH,YAAY,CA6CI,CAAC,CAAC,IAAI,CAAC,CAAC;GAAA,CAAC,CAAA;AAC/D,QAAM,KAAK,GAAG,IAAI,YAAY,YAAS,QAAQ,CAAA;AAC/C,QAAM,GAAG,GAAG,KAvCJ,MAAM,CAuCK,YAAY,EAC9B,UAAA,EAAE,EAAI;AACL,UAxCM,MAAM,CAwCL,KAAK,CAAC,CAAA;AACb,SAAM,QAAQ,GAAG,MAjCnB,wBAAwB,CAiCoB,EAAE,EAAE,CAAC,CAAC,MAAK,QAAQ,CAAC,EAAE,EAAE,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;AACjF,UAAO,KA3CD,MAAM,CA2CE,KAAK,EAClB,UAAA,CAAC;WAAI,CAAE,WA1CF,OAAO,CA0CG,EAAE,EAAE,QAAQ,CAAC,CAAE,CAAC,MAAM,CAAC,CAAC,EAAE,OArCG,SAAS,CAqCC,CAAC;IAAA,EACvD;WAAM,CAAE,cAtDqC,eAAe,CAsDpC,QAAQ,CAAC,CAAE;IAAA,CAAC,CAAA;GACrC,EACD;UAAM,KAAK,CAAC,MAAM,CAAC,KA/CE,IAAI,CA+CD,KAAK,EAAE;WAAM,cAxDU,eAAe,CAwDT,CAAC,CAAC,MAAK,QAAQ,CAAC,CAAC;IAAA,CAAC,CAAC;GAAA,CAAC,CAAA;AAC1E,SAAO,cA3DwC,cAAc,CA2DvC,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAA;EAC7C;;AAED,QAlDiB,aAAa,cAkDN,kBAAkB,EAAE;AAC3C,QAAM,EAAA,YAAG;AACR,UAAO,qBAzDe,wBAAwB,CAyDd,CAC/B,MA9CqB,cAAc,CA8CpB,EAAE,EAAE,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAE,CAAC,CAAA;GACtE;;AAED,mBAAiB,EAAA,YAAG;AACnB,UAAO,qBA9De,wBAAwB,CA+D7C,MAnDqC,0BAA0B,CAoD9D,EAAE,EACF,IAAI,CAAC,GAAG,EACR,IAAI,CAAC,SAAS,EACd,IAAI,CAAC,MAAM,EACX,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,EACb,IAAI,CAAC,CAAC,EACN,KAAK,CAAC,CAAC,CAAA;GACT;AACD,SAAO,EAAE,cAAc;AACvB,UAAQ,EAAE,cAAc;AACxB,WAAS,EAAA,YAAG;AAAE,UAAO,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;GAAE;AACrD,MAAI,EAAA,YAAG;AACN,SAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAA,GAAG;WAAI,GAAG,YAAY,YAAS,KAAK;IAAA,CAAC,CAAA;AACrE,OAAI,QAAQ,EAAE;AACb,UAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,UAAA,GAAG;YAC7B,GAAG,YAAY,YAAS,KAAK,GAC5B,MAlEU,KAAK,CAkET,CAAE,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAE,CAAC,GAC1B,CAAC,CAAC,GAAG,CAAC;KAAA,CAAC,CAAA;AACT,WAAO,cAxFT,cAAc,OAgB4B,mBAAmB,EAwEhB,CAC1C,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,QAxEc,OAAO,EA0EnC,cA3FH,cAAc,CA2FI,eAzFA,MAAM,OAexB,aAAa,EA0E2B,QAAQ,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAA;IACxD,MACI,OAAO,cA7Fb,cAAc,CA6Fc,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;GAC5D;AACD,QAAM,EAAA,YAAG;;;AACR,UAAO,KAtFA,MAAM,CAsFC,IAAI,CAAC,OAAO,EACzB,UAAA,KAAK;WAAI,cAlGoC,cAAc,CAkGnC,CAAE,CAAC,CAAC,KAAK,CAAC,EAAE,QAAQ,CAAC,OAAK,KAAK,EAAE,OAAK,MAAM,CAAC,CAAE,CAAC;IAAA,EACxE;WAAM,QAAQ,CAAC,OAAK,KAAK,EAAE,OAAK,MAAM,CAAC;IAAA,CAAC,CAAA;GACzC;AACD,SAAO,EAAA,YAAG;AACT,SAAM,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,CAAC,MAAM,CAAC,CAAA;AAC9C,SAAM,KAAK,GAAG,KA5FP,MAAM,CA4FQ,IAAI,CAAC,OAAO,EAAE,UAAA,KAAK;WAAI,CAAE,CAAC,CAAC,KAAK,CAAC,EAAE,IAAI,CAAE;IAAA,EAAE;WAAM,CAAE,IAAI,CAAE;IAAA,CAAC,CAAA;AAC/E,UAAO,SAAS,CAAC,IAAI,EAAE,cAxGuB,cAAc,CAwGtB,KAAK,CAAC,CAAC,CAAA;GAC7C;AACD,YAAU,EAAA,YAAG;AAAE,UAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,CAAA;GAAE;AAC9D,aAAW,EAAA,YAAG;AAAE,UAAO,QAAQ,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK,CAAC,CAAA;GAAE;;AAEhE,OAAK,EAAA,YAAG;AACP,UAAO,EAAE,CAAC,IAAI,CAAC,kBAAkB,EAAE,GAClC,MArGM,OAAO,CAqGL,IAAI,CAAC,KAAK,EAAE,UAAA,IAAI;WAAI,eA5GQ,YAAY,CA4GP,CAAC,CAAC,IAAI,CAAC,CAAC;IAAA,CAAC,GAClD,EAAG,CAAA;GACJ;AACD,WAAS,EAAA,YAAG;AAAE,UAAO,cApGb,kBAAkB,CAoGc,IAAI,EAAE,EAAE,CAAC,CAAA;GAAE;AACnD,WAAS,EAAA,YAAG;AAAE,UAAO,cArGO,kBAAkB,CAqGN,IAAI,EAAE,EAAE,CAAC,CAAA;GAAE;AACnD,SAAO,EAAA,YAAG;AAAE,UAAO,cApH4C,cAAc,CAoH3C,MAAM,CAAC,EAAE,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;GAAE;AACvE,KAAG,EAAA,YAAG;AACL,SAAM,cAAc,GAAG,aAAa,CAAA;AACpC,gBAAa,GAAG,IAAI,CAAC,CAAC,KAAK,IAAI,CAAA;;;AAG/B,SAAM,KAAK,GAAG,cAzHkD,OAAO,CAyHjD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAA;AACvC,SAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,UAAA,IAAI;WAC5C,WA/GM,OAAO,CA+GL,IAAI,EAAE,cA3HhB,cAAc,OAgBU,gBAAgB,EA2GS,OA3GtC,WAAW,EA2GyC,KAAK,CAAC,CAAC,CAAC;IAAA,CAAC,CAAA;AACvE,SAAM,SAAS,GAAG,MAnHX,OAAO,CAmHY,IAAI,CAAC,IAAI,EAAE,UAAA,GAAG;WAAI,MAxG7C,YAAY,CAwG8C,EAAE,EAAE,GAAG,EAAE,GAAG,CAAC,MAAM,CAAC;IAAA,CAAC,CAAA;AAC9E,SAAM,GAAG,GAAG,MApHL,OAAO,CAoHM,IAAI,CAAC,IAAI,EAAE,UAAA,CAAC;WAAI,eA3HC,YAAY,CA2HA,CAAC,CAAC,CAAC,CAAC,CAAC;IAAA,CAAC,CAAA;AACvD,SAAM,IAAI,GAAG,aAAa,CAAC,MAAM,CAAC,SAAS,EAAE,GAAG,CAAC,CAAA;;AAEjD,SAAM,IAAI,GAAG,MAvHN,OAAO,CAuHO,IAAI,CAAC,KAAK,EAAE,UAAA,CAAC;WAAI,eA9HD,YAAY,CA8HE,CAAC,CAAC,CAAC,CAAC,CAAC;IAAA,CAAC,CAAA;AACzD,SAAM,IAAI,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,EAAE,IAAI,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAA;AACzD,SAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAA;AAC7B,SAAM,GAAG,GAAG,qBA/H8B,uBAAuB,CA+H7B,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC,KAAK,IAAI,CAAC,CAAA;;AAEhE,gBAAa,GAAG,cAAc,CAAA;AAC9B,UAAO,GAAG,CAAA;GACV;AACD,MAAI,EAAA,YAAG;AAAE,UAAO,MAtHH,QAAQ,CAsHI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;GAAE;AACzC,YAAU,EAAA,YAAG;AACZ,UAAO,cA3IA,eAAe,CA2IC,MAjID,KAAK,CAiIE,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,UAAA,CAAC;WAAI,eAxI/C,QAAQ,OAwIoD,CAAC,CAAG;IAAA,CAAC,CAAC,CAAA;GACzE;AACD,YAAU,EAAA,YAAG;AAAE,UAAO,cA7Id,eAAe,CA6Ie,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAA;GAAE;AAC1D,WAAS,EAAA,YAAG;AAAE,UAAO,WAjIJ,cAAc,OAiIS,IAAI,CAAC,KAAK,EAAI,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;GAAE;AACtE,eAAa,EAAA,YAAG;;;AAGf,SAAM,GAAG,GAAG,cAjJoD,OAAO,CAiJnD,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;AACzC,UAAO,OAvIuB,UAAU,CAuItB,IAAI,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,qBA5IvC,qBAAqB,CA4IwC,GAAG,CAAC,CAAA;GAChE;AACD,cAAY,EAAA,YAAG;AAAE,UAAO,cApJW,UAAU,CAoJV,IAAI,CAAC,IAAI,CAAC,CAAA;GAAE;AAC/C,aAAW,EAAA,YAAG;AAAE,UAAO,MAnIvB,WAAW,CAmIwB,IAAI,EAAE,EAAE,CAAC,CAAA;GAAE;AAC9C,cAAY,EAAA,YAAG;AAAE,UAAO,WA1IS,kBAAkB,CA0IR,IAAI,CAAC,CAAA;GAAE;;AAElD,MAAI,EAAA,YAAG;AACN,UAAO,cAzJuC,gBAAgB,CAyJtC,MAAM,CAAC,IAAI,CAAC,EAAE,qBAnJU,sBAAsB,CAmJT,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;GAC5E;AACD,WAAS,EAAA,YAAG;AACX,UAAO,MAxIqB,KAAK,CAwIpB,MAnJN,OAAO,CAmJO,MAnJC,KAAK,CAmJA,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,UAAA,CAAC;WAC5C,CAAE,eA3JI,QAAQ,CA2JH,IAAI,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC,EAAE,eA3J3B,QAAQ,CA2J4B,IAAI,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAE;IAAA,CAAC,CAAC,CAAA;GACnE;AACD,UAAQ,EAAA,YAAG;AACV,UAAO,qBA1Je,wBAAwB,CA0Jd,CAC/B,cAhK0B,kBAAkB,CAgKzB,eA/Jb,QAAQ,QA+JmB,IAAI,CAAC,KAAK,CAAG,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,EAC5D,cAjK0B,kBAAkB,CAiKzB,eAhKb,QAAQ,QAgKmB,IAAI,CAAC,KAAK,CAAG,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAC5D,CAAC,CAAA;GACF;AACD,QAAM,EAAA,YAAG;AACR,UAAO,eApKU,MAAM,CAoKT,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAA;GACxC;AACD,QAAM,EAAA,YAAG;AAAE,UAAO,kBAAgB,IAAI,EAAE,EAAE,CAAC,CAAA;GAAE;;AAE7C,qBAAmB,EAAA,YAAG;AACrB,SAAM,CAAC,GAAG,eAzKO,MAAM,OAcxB,SAAS,EA2JoB,SAAS,CAAC,CAAA;AACtC,UAAO,cA7KiB,oBAAoB,CA6KhB,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAA;GAClD;AACD,OAAK,EAAA,YAAG;;AAEP,SAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;;cAE1B,OAAO,KAAK,KAAK,QAAQ,GACxB,CAAE,cAnL4D,OAAO,CAmL3D,KAAK,CAAC,EAAE,MA1KS,IAAI,CA0KR,IAAI,CAAC,KAAK,CAAC,CAAE,GACpC,OAnKY,cAAc,EAmKR,IAAI,CAAC,KAAK,CAAE;;;;SAHxB,KAAK;SAAE,SAAS;;AAIxB,UAAO,SAAS,CAAC,MAAM,CACtB,UAAC,EAAE,EAAE,CAAC;WACL,qBAnLH,oBAAoB,CAmLI,EAAE,EAAE,OAAO,CAAC,KAAK,QAAQ,GAAG,cAvLa,OAAO,CAuLZ,CAAC,CAAC,GAAG,MAnK7B,MAAM,CAmK8B,CAAE,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC,CAAC;IAAA,EAChF,KAAK,CAAC,CAAA;GACP;AACD,SAAO,EAAA,YAAG;;AAET,WAAQ,IAAI,CAAC,CAAC;AACb,SAAK,UAAU;AAAE,YAAO,eA3LR,MAAM,OAcuC,IAAI,EA6K5B,UAAU,CAAC,CAAA;AAAA,AAChD,SAAK,UAAU;AAAE,YAAO,cA9LV,iBAAiB,EA8LY,CAAA;AAAA,AAC3C,SAAK,KAAK;AAAE,YAAO,eA7LH,MAAM,OAcuC,IAAI,EA+KjC,KAAK,CAAC,CAAA;AAAA,AACtC,SAAK,MAAM;AAAE,YAAQ,cA/LX,cAAc,EA+La,CAAA;AAAA,AACrC,SAAK,uBAAuB;AAAE,YAAO,cAjMJ,UAAU,CAiMK,WAAW,CAAC,CAAA;AAAA,AAC5D;AAAS,WAAM,IAAI,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAA;AAAA,IAChC;GACD;AACD,OAAK,EAAA,YAAG;AAAE,KAAE,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,0CAA0C,CAAC,CAAA;GAAE;AACzE,OAAK,EAAA,YAAG;AAAE,UAAO,qBA/LQ,yBAAyB,CA+LP,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAA;GAAE;AAC7D,SAAO,EAAA,YAAG;AAAE,UAAO,qBAhMnB,uBAAuB,CAgMoB,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAA;GAAE;EAC/D,CAAC,CAAA;;AAEF,OAAM,SAAS,GAAG,UAAC,CAAC,EAAE,KAAK,EAAK;AAC/B,QAAM,CAAC,GAAG,aAAa,CAAA;AACvB,QAAM,MAAM,GAAG,qBAxMO,mBAAmB,CAwMN,qBAxMiC,uBAAuB,CAwMhC,KAAK,EAAE,CAAC,CAAC,CAAC,CAAA;AACrE,SAAO,CAAC,GAAG,qBAtMX,uBAAuB,CAsMY,MAAM,CAAC,GAAG,MAAM,CAAA;EACnD,CAAA;;AAED,OAAM,QAAQ,GAAG,cA/MhB,UAAU,CA+MiB,IAAI,EAAE,CAAE,eA9MT,UAAU,CA8MU,8BAA8B,CAAC,CAAE,CAAC,CAAA;AACjF,UAAS,QAAQ,CAAC,KAAK,EAAE,MAAM,EAAE;AAChC,QAAM,IAAI,GAAG,KAxML,MAAM,CAwMM,MAAM,EACzB,UAAA,CAAC;UAAI,cAlNN,UAAU,CAkNO,IAAI,EAAE,CAAE,CAAC,CAAC,CAAC,CAAC,CAAE,CAAC;GAAA,EAC/B;UAAM,QAAQ;GAAA,CAAC,CAAA;AAChB,QAAM,KAAK,GAAG,MA5MG,IAAI,CA4MF,KAAK,CAAC,GAAG,CAAC,UAAA,IAAI;UAAI,CAAC,CAAC,IAAI,CAAC;GAAA,CAAC,EAAE,IAAI,CAAC,CAAA;AACpD,SAAO,qBAjNP,qBAAqB,CAiNQ,KAAK,CAAC,CAAA;EACnC;;AAED,UAAS,QAAQ,CAAC,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE;AAC1C,QAAM,WAAW,GAAG,EAAE,CAAC,IAAI,CAAC,iBAAiB,EAAE,GAAG,MAtM7B,MAAM,CAsM8B,CAAE,CAAC,CAAC,IAAI,CAAC,CAAE,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAA;AAC/E,QAAM,KAAK,GAAG,SAAS,GAAG,CAAE,CAAC,CAAC,MAAM,CAAC,QA1MG,KAAK,CA0MC,GAAG,CAAE,CAAC,CAAC,MAAM,CAAC,CAAE,CAAA;AAC9D,SAAO,cA3NP,UAAU,CA2NQ,WAAW,EAAE,KAAK,CAAC,CAAA;EACrC;;;AAGD,OAAM,MAAM,GAAG,UAAA,IAAI,EAAI;AACtB,SAAO,eA/NC,QAAQ,UA+NO,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,CAAG,CAAA;EAC7C,CAAA","file":"meta/compile/private/transpile/transpile.js","sourcesContent":["import { ArrayExpression, AssignmentExpression, BlockStatement, BreakStatement,\n\tCallExpression, DebuggerStatement, Identifier, LabeledStatement, Literal,\n\tSwitchCase, ThisExpression, VariableDeclarator, ReturnStatement } from 'esast/dist/ast'\nimport { idCached, member, throwError, toStatements } from 'esast/dist/util'\nimport {\n\tbinaryExpressionPlus, callExpressionThunk, functionExpressionPlain, functionExpressionThunk,\n\tswitchStatementOnTrue,\n\tunaryExpressionNegate, variableDeclarationConst, whileStatementInfinite,\n\tyieldExpressionDelegate, yieldExpressionNoDelegate } from 'esast/dist/specialize'\nimport * as EExports from '../../Expression'\nimport { flatMap, push, range, tail } from '../U/Bag'\nimport { ifElse, None, opIf } from '../U/Op'\nimport { assert, implementMany, isPositive } from '../U/util'\nimport { declare, declareSpecial, idForDeclareCached } from './esast-util'\nimport { transpileObjReturn, transpileObjSimple } from './transpileObj'\nimport transpileModule from './transpileModule'\nimport {\n\tIdExports, IdArguments, IdArraySliceCall, IdFunctionApplyCall, IdMs,\n\tLitEmptyArray, LitEmptyString, LitNull, Break, ReturnRes,\n\taccessLocal, lazyWrap, makeDeclarator, makeDestructureDeclarators,\n\tmaybeWrapInCheckContains,\n\topLocalCheck, msArr, msBool, msMap, msShow } from './util'\n\nlet cx, vr, isInGenerator\n\nexport default function transpile(_cx, e, _vr) {\n\tcx = _cx\n\tvr = _vr\n\tisInGenerator = false\n\tconst res = t(e)\n\t// Release for garbage collection\n\tcx = vr = undefined\n\treturn res\n}\n\nexport const t = (expr, arg, arg2, arg3) => {\n\tconst ast = expr.transpileSubtree(arg, arg2, arg3)\n\tif (cx.opts.sourceMap() && !(ast instanceof Array))\n\t\t// Array is only allowed for statement groups inside of Blocks, such as Debug.\n\t\tast.loc = expr.loc\n\treturn ast\n}\n\nfunction transpileBlock(lead, opResDeclare, opOut) {\n\tif (lead === undefined)\n\t\tlead = []\n\tif (opResDeclare === undefined)\n\t\topResDeclare = opOut = None\n\tconst body = flatMap(this.lines, line => toStatements(t(line)))\n\tconst isVal = this instanceof EExports.BlockVal\n\tconst fin = ifElse(opResDeclare,\n\t\trd => {\n\t\t\tassert(isVal)\n\t\t\tconst returned = maybeWrapInCheckContains(cx, t(this.returned), rd.opType, 'res')\n\t\t\treturn ifElse(opOut,\n\t\t\t\to => [ declare(rd, returned) ].concat(o, [ ReturnRes ]),\n\t\t\t\t() => [ ReturnStatement(returned) ])\n\t\t},\n\t\t() => opOut.concat(opIf(isVal, () => ReturnStatement(t(this.returned)))))\n\treturn BlockStatement(lead.concat(body, fin))\n}\n\nimplementMany(EExports, 'transpileSubtree', {\n\tAssign() {\n\t\treturn variableDeclarationConst([\n\t\t\tmakeDeclarator(cx, this.loc, this.assignee, this.k, t(this.value)) ])\n\t},\n\t// TODO:ES6 Just use native destructuring assign\n\tAssignDestructure() {\n\t\treturn variableDeclarationConst(\n\t\t\tmakeDestructureDeclarators(\n\t\t\t\tcx,\n\t\t\t\tthis.loc,\n\t\t\t\tthis.assignees,\n\t\t\t\tthis.isLazy,\n\t\t\t\tt(this.value),\n\t\t\t\tthis.k,\n\t\t\t\tfalse))\n\t},\n\tBlockDo: transpileBlock,\n\tBlockVal: transpileBlock,\n\tBlockWrap() { return blockWrap(this, t(this.block)) },\n\tCall() {\n\t\tconst anySplat = this.args.some(arg => arg instanceof EExports.Splat)\n\t\tif (anySplat) {\n\t\t\tconst args = this.args.map(arg =>\n\t\t\t\targ instanceof EExports.Splat ?\n\t\t\t\t\tmsArr([ t(arg.splatted) ]) :\n\t\t\t\t\tt(arg))\n\t\t\treturn CallExpression(IdFunctionApplyCall, [\n\t\t\t\tt(this.called),\n\t\t\t\tLitNull,\n\t\t\t\tCallExpression(member(LitEmptyArray, 'concat'), args)])\n\t\t}\n\t\telse return CallExpression(t(this.called), this.args.map(t))\n\t},\n\tCaseDo() {\n\t\treturn ifElse(this.opCased,\n\t\t\tcased => BlockStatement([ t(cased), caseBody(this.parts, this.opElse) ]),\n\t\t\t() => caseBody(this.parts, this.opElse))\n\t},\n\tCaseVal() {\n\t\tconst body = caseBody(this.parts, this.opElse)\n\t\tconst block = ifElse(this.opCased, cased => [ t(cased), body ], () => [ body ])\n\t\treturn blockWrap(this, BlockStatement(block))\n\t},\n\tCaseDoPart() { return casePart(this.test, this.result, true) },\n\tCaseValPart() { return casePart(this.test, this.result, false) },\n\t// TODO: includeInoutChecks is misnamed\n\tDebug() {\n\t\treturn cx.opts.includeInoutChecks() ?\n\t\t\tflatMap(this.lines, line => toStatements(t(line))) :\n\t\t\t[ ]\n\t},\n\tObjReturn() { return transpileObjReturn(this, cx) },\n\tObjSimple() { return transpileObjSimple(this, cx) },\n\tEndLoop() { return BreakStatement(loopId(vr.endLoopToLoop.get(this))) },\n\tFun() {\n\t\tconst oldInGenerator = isInGenerator\n\t\tisInGenerator = this.k === '~|'\n\n\t\t// TODO:ES6 use `...`\n\t\tconst nArgs = Literal(this.args.length)\n\t\tconst opDeclareRest = this.opRestArg.map(rest =>\n\t\t\tdeclare(rest, CallExpression(IdArraySliceCall, [IdArguments, nArgs])))\n\t\tconst argChecks = flatMap(this.args, arg => opLocalCheck(cx, arg, arg.isLazy))\n\t\tconst _in = flatMap(this.opIn, i => toStatements(t(i)))\n\t\tconst lead = opDeclareRest.concat(argChecks, _in)\n\n\t\tconst _out = flatMap(this.opOut, o => toStatements(t(o)))\n\t\tconst body = t(this.block, lead, this.opResDeclare, _out)\n\t\tconst args = this.args.map(t)\n\t\tconst res = functionExpressionPlain(args, body, this.k === '~|')\n\n\t\tisInGenerator = oldInGenerator\n\t\treturn res\n\t},\n\tLazy() { return lazyWrap(t(this.value)) },\n\tListReturn() {\n\t\treturn ArrayExpression(range(0, this.length).map(i => idCached(`_${i}`)))\n\t},\n\tListSimple() { return ArrayExpression(this.parts.map(t)) },\n\tListEntry() { return declareSpecial(`_${this.index}`, t(this.value)) },\n\tNumberLiteral() {\n\t\t// Negative numbers are not part of ES spec.\n\t\t// http://www.ecma-international.org/ecma-262/5.1/#sec-7.8.3\n\t\tconst lit = Literal(Math.abs(this.value))\n\t\treturn isPositive(this.value) ? lit : unaryExpressionNegate(lit)\n\t},\n\tGlobalAccess() { return Identifier(this.name) },\n\tLocalAccess() { return accessLocal(this, vr) },\n\tLocalDeclare() { return idForDeclareCached(this) },\n\t// TODO: Don't always label!\n\tLoop() {\n\t\treturn LabeledStatement(loopId(this), whileStatementInfinite(t(this.block)))\n\t},\n\tMapReturn() {\n\t\treturn msMap(flatMap(range(0, this.length), i =>\n\t\t\t[ idCached('_k' + i.toString()), idCached('_v' + i.toString()) ]))\n\t},\n\tMapEntry() {\n\t\treturn variableDeclarationConst([\n\t\t\tVariableDeclarator(idCached(`_k${this.index}`), t(this.key)),\n\t\t\tVariableDeclarator(idCached(`_v${this.index}`), t(this.val))\n\t\t])\n\t},\n\tMember() {\n\t\treturn member(t(this.object), this.name)\n\t},\n\tModule() { return transpileModule(this, cx) },\n\t// TODO:ES6 Use `export default`\n\tModuleDefaultExport() {\n\t\tconst m = member(IdExports, 'default')\n\t\treturn AssignmentExpression('=', m, t(this.value))\n\t},\n\tQuote() {\n\t\t// TODO:ES6 use template strings\n\t\tconst part0 = this.parts[0]\n\t\tconst [ first, restParts ] =\n\t\t\ttypeof part0 === 'string' ?\n\t\t\t\t[ Literal(part0), tail(this.parts) ] :\n\t\t\t\t[ LitEmptyString, this.parts ]\n\t\treturn restParts.reduce(\n\t\t\t(ex, _) =>\n\t\t\t\tbinaryExpressionPlus(ex, typeof _ === 'string' ? Literal(_) : msShow([ t(_) ])),\n\t\t\tfirst)\n\t},\n\tSpecial() {\n\t\t// Make new objects because we will assign `loc` to them.\n\t\tswitch (this.k) {\n\t\t\tcase 'contains': return member(IdMs, 'contains')\n\t\t\tcase 'debugger': return DebuggerStatement()\n\t\t\tcase 'sub': return member(IdMs, 'sub')\n\t\t\tcase 'this': return \tThisExpression()\n\t\t\tcase 'this-module-directory': return Identifier('__dirname')\n\t\t\tdefault: throw new Error(this.k)\n\t\t}\n\t},\n\tSplat() { cx.fail(this.loc, 'Splat must appear as argument to a call.') },\n\tYield() { return yieldExpressionNoDelegate(t(this.yielded)) },\n\tYieldTo() { return yieldExpressionDelegate(t(this.yieldedTo)) }\n})\n\nconst blockWrap = (_, block) => {\n\tconst g = isInGenerator\n\tconst invoke = callExpressionThunk(functionExpressionThunk(block, g))\n\treturn g ? yieldExpressionDelegate(invoke) : invoke\n}\n\nconst caseFail = SwitchCase(null, [ throwError('No branch of `case` matches.') ])\nfunction caseBody(parts, opElse) {\n\tconst elze = ifElse(opElse,\n\t\t_ => SwitchCase(null, [ t(_) ]),\n\t\t() => caseFail)\n\tconst cases = push(parts.map(part => t(part)), elze)\n\treturn switchStatementOnTrue(cases)\n}\n\nfunction casePart(test, result, needBreak) {\n\tconst checkedTest = cx.opts.includeCaseChecks() ? msBool([ t(test) ]) : t(test)\n\tconst lines = needBreak ? [ t(result), Break ] : [ t(result) ]\n\treturn SwitchCase(checkedTest, lines)\n}\n\n// TODO: MOVE\nconst loopId = loop => {\n\treturn idCached(`loop${loop.loc.start.line}`)\n}\n"],"sourceRoot":"/src"}