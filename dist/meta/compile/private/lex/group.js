if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module', 'esast/dist/Loc', '../Token', '../util', './GroupPre'], function (exports, module, _esastDistLoc, _Token, _util, _GroupPre) {
	'use strict';

	module.exports = group;

	function _interopRequire(obj) { return obj && obj.__esModule ? obj['default'] : obj; }

	var _Loc = _interopRequire(_esastDistLoc);

	var _GroupPre2 = _interopRequire(_GroupPre);

	function group(cx, preGroupedTokens) {
		// Stack of GroupBuilders
		const stack = [];
		let cur;

		const newLevel = function (pos, k) {
			stack.push(cur);
			cur = (0, _Token.Group)((0, _Loc)(pos, null), [], k);
		},
		      finishLevels = function (closePos, k) {
			// We may close other groups. For example, a G_Line can close a G_Paren.
			while (true) {
				const close = (0, _GroupPre.groupOpenToClose)(cur.kind);
				if (close === k) break;else {
					cx.check(cur.kind === _GroupPre.GP_OpenParen || cur.kind === _GroupPre.GP_OpenBracket || cur.kind === _GroupPre.GP_Space, closePos, function () {
						return 'Trying to close ' + showG(k) + ', but last opened was ' + showG(cur.kind);
					});
					finishLevel(closePos, close);
				}
			}
			finishLevel(closePos, k);
		},
		      finishLevel = function (closePos, k) {
			let wrapped = wrapLevel(closePos);
			// cur is now the previous level on the stack
			// Don't add line/spaced
			switch (k) {
				case _GroupPre.GP_Space:
					{
						const size = wrapped.tokens.length;
						if (size === 0) return;else if (size === 1)
							// Spaced should always have at least two elements
							wrapped = wrapped.tokens[0];
						break;
					}
				case _GroupPre.GP_Line:
					if ((0, _util.isEmpty)(wrapped.tokens)) return;
					break;
				case _GroupPre.GP_CloseBlock:
					if ((0, _util.isEmpty)(wrapped.tokens)) cx.fail(closePos, 'Empty block');
				default:
				// fallthrough
			}
			cur.tokens.push(wrapped);
		},
		      wrapLevel = function (closePos) {
			const builtGroup = cur;
			cur = stack.pop();
			builtGroup.loc.end = closePos;
			return builtGroup;
		},
		      startLine = function (pos) {
			newLevel(pos, _GroupPre.GP_Line);
			newLevel(pos, _GroupPre.GP_Space);
		},
		      endLine = function (pos) {
			finishLevels(pos, _GroupPre.GP_Space);
			finishLevels(pos, _GroupPre.GP_Line);
		},
		      endAndStart = function (loc, k) {
			finishLevels(loc.start, k);
			newLevel(loc.end, k);
		};

		cur = (0, _Token.Group)((0, _Loc)(_esastDistLoc.StartPos, null), [], _GroupPre.GP_OpenBlock);
		startLine(_esastDistLoc.StartPos);

		let endLoc = (0, _Loc)(_esastDistLoc.StartPos, _esastDistLoc.StartPos);
		preGroupedTokens.forEach(function (_) {
			if (_ instanceof _GroupPre2) {
				// It's a GroupPre
				const loc = _.loc;
				endLoc = loc;
				const kind = _.kind;
				switch (kind) {
					case _GroupPre.GP_OpenParen:case _GroupPre.GP_OpenBracket:
						newLevel(loc.start, kind);
						newLevel(loc.end, _GroupPre.GP_Space);
						break;
					case _GroupPre.GP_CloseParen:case _GroupPre.GP_CloseBracket:
						finishLevels(loc.end, kind);
						break;
					case _GroupPre.GP_OpenQuote:
						newLevel(loc.start, kind);
						break;
					case _GroupPre.GP_CloseQuote:
						finishLevels(loc.start, kind);
						break;
					case _GroupPre.GP_OpenBlock:
						//  ~ before block is OK
						if ((0, _util.isEmpty)(cur.tokens) || !_Token.Keyword.isLazy((0, _util.last)(cur.tokens))) endAndStart(loc, _GroupPre.GP_Space);
						newLevel(loc.start, kind);
						startLine(loc.end);
						break;
					case _GroupPre.GP_CloseBlock:
						endLine(loc.start);
						finishLevels(loc.end, kind);
						break;
					case _GroupPre.GP_Line:
						endLine(loc.start);
						startLine(loc.end);
						break;
					case _GroupPre.GP_Space:
						endAndStart(loc, kind);
						break;
					default:
						throw new Error(kind);
				}
			} else cur.tokens.push(_);
		});

		endLine(endLoc.end);
		(0, _util.assert)((0, _util.isEmpty)(stack));
		cur.loc.end = endLoc.end;
		return cur;
	}

	// TODO
	const showG = function (kind) {
		return kind;
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1ldGEvY29tcGlsZS9wcml2YXRlL2xleC9ncm91cC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7a0JBT3dCLEtBQUs7Ozs7Ozs7O0FBQWQsVUFBUyxLQUFLLENBQUMsRUFBRSxFQUFFLGdCQUFnQixFQUFFOztBQUVuRCxRQUFNLEtBQUssR0FBRyxFQUFFLENBQUE7QUFDaEIsTUFBSSxHQUFHLENBQUE7O0FBRVAsUUFDQyxRQUFRLEdBQUcsVUFBQyxHQUFHLEVBQUUsQ0FBQyxFQUFLO0FBQ3RCLFFBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDZixNQUFHLEdBQUcsV0FkQSxLQUFLLEVBY0MsVUFBSSxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRyxFQUFFLENBQUMsQ0FBQyxDQUFBO0dBQ25DO1FBRUQsWUFBWSxHQUFHLFVBQUMsUUFBUSxFQUFFLENBQUMsRUFBSzs7QUFFL0IsVUFBTyxJQUFJLEVBQUU7QUFDWixVQUFNLEtBQUssR0FBRyxjQWpCakIsZ0JBQWdCLEVBaUJrQixHQUFHLENBQUMsSUFBSSxDQUFDLENBQUE7QUFDeEMsUUFBSSxLQUFLLEtBQUssQ0FBQyxFQUNkLE1BQUssS0FDRDtBQUNKLE9BQUUsQ0FBQyxLQUFLLENBQ1AsR0FBRyxDQUFDLElBQUksZUF0QkssWUFBWSxBQXNCQSxJQUN4QixHQUFHLENBQUMsSUFBSSxlQXZCa0IsY0FBYyxBQXVCYixJQUMzQixHQUFHLENBQUMsSUFBSSxlQXZCZCxRQUFRLEFBdUJtQixFQUN0QixRQUFRLEVBQUU7a0NBQ1MsS0FBSyxDQUFDLENBQUMsQ0FBQyw4QkFBeUIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUM7TUFBRSxDQUFDLENBQUE7QUFDdkUsZ0JBQVcsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUE7S0FDNUI7SUFDRDtBQUNELGNBQVcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUE7R0FDeEI7UUFFRCxXQUFXLEdBQUcsVUFBQyxRQUFR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Q0FBQyxDQUFBO0dBQ25CLENBQUMsQ0FBQTs7QUFFRixTQUFPLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFBO0FBQ25CLFlBcElRLE1BQU0sRUFvSVAsVUFwSVMsT0FBTyxFQW9JUixLQUFLLENBQUMsQ0FBQyxDQUFBO0FBQ3RCLEtBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUE7QUFDeEIsU0FBTyxHQUFHLENBQUE7RUFDVjs7O0FBR0QsT0FBTSxLQUFLLEdBQUcsVUFBQSxJQUFJO1NBQUksSUFBSTtFQUFBLENBQUEiLCJmaWxlIjoibWV0YS9jb21waWxlL3ByaXZhdGUvbGV4L2dyb3VwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IExvYywgeyBTdGFydFBvcyB9IGZyb20gJ2VzYXN0L2Rpc3QvTG9jJ1xuaW1wb3J0IHsgR3JvdXAsIEtleXdvcmQgfSBmcm9tICcuLi9Ub2tlbidcbmltcG9ydCB7IGFzc2VydCwgaXNFbXB0eSwgbGFzdCB9IGZyb20gJy4uL3V0aWwnXG5pbXBvcnQgR3JvdXBQcmUsIHtcblx0Z3JvdXBPcGVuVG9DbG9zZSwgR1BfT3BlblBhcmVuLCBHUF9PcGVuQnJhY2tldCwgR1BfT3BlbkJsb2NrLCBHUF9PcGVuUXVvdGUsIEdQX0xpbmUsXG5cdEdQX1NwYWNlLCBHUF9DbG9zZVBhcmVuLCBHUF9DbG9zZUJyYWNrZXQsIEdQX0Nsb3NlQmxvY2ssIEdQX0Nsb3NlUXVvdGV9IGZyb20gJy4vR3JvdXBQcmUnXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGdyb3VwKGN4LCBwcmVHcm91cGVkVG9rZW5zKSB7XG5cdC8vIFN0YWNrIG9mIEdyb3VwQnVpbGRlcnNcblx0Y29uc3Qgc3RhY2sgPSBbXVxuXHRsZXQgY3VyXG5cblx0Y29uc3Rcblx0XHRuZXdMZXZlbCA9IChwb3MsIGspID0+IHtcblx0XHRcdHN0YWNrLnB1c2goY3VyKVxuXHRcdFx0Y3VyID0gR3JvdXAoTG9jKHBvcywgbnVsbCksIFsgXSwgaylcblx0XHR9LFxuXG5cdFx0ZmluaXNoTGV2ZWxzID0gKGNsb3NlUG9zLCBrKSA9PiB7XG5cdFx0XHQvLyBXZSBtYXkgY2xvc2Ugb3RoZXIgZ3JvdXBzLiBGb3IgZXhhbXBsZSwgYSBHX0xpbmUgY2FuIGNsb3NlIGEgR19QYXJlbi5cblx0XHRcdHdoaWxlICh0cnVlKSB7XG5cdFx0XHRcdGNvbnN0IGNsb3NlID0gZ3JvdXBPcGVuVG9DbG9zZShjdXIua2luZClcblx0XHRcdFx0aWYgKGNsb3NlID09PSBrKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdGN4LmNoZWNrKFxuXHRcdFx0XHRcdFx0Y3VyLmtpbmQgPT09IEdQX09wZW5QYXJlbiB8fFxuXHRcdFx0XHRcdFx0XHRjdXIua2luZCA9PT0gR1BfT3BlbkJyYWNrZXQgfHxcblx0XHRcdFx0XHRcdFx0Y3VyLmtpbmQgPT09IEdQX1NwYWNlLFxuXHRcdFx0XHRcdFx0Y2xvc2VQb3MsICgpID0+XG5cdFx0XHRcdFx0XHRgVHJ5aW5nIHRvIGNsb3NlICR7c2hvd0coayl9LCBidXQgbGFzdCBvcGVuZWQgd2FzICR7c2hvd0coY3VyLmtpbmQpfWApXG5cdFx0XHRcdFx0ZmluaXNoTGV2ZWwoY2xvc2VQb3MsIGNsb3NlKVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRmaW5pc2hMZXZlbChjbG9zZVBvcywgaylcblx0XHR9LFxuXG5cdFx0ZmluaXNoTGV2ZWwgPSAoY2xvc2VQb3MsIGspID0+IHtcblx0XHRcdGxldCB3cmFwcGVkID0gd3JhcExldmVsKGNsb3NlUG9zKVxuXHRcdFx0Ly8gY3VyIGlzIG5vdyB0aGUgcHJldmlvdXMgbGV2ZWwgb24gdGhlIHN0YWNrXG5cdFx0XHQvLyBEb24ndCBhZGQgbGluZS9zcGFjZWRcblx0XHRcdHN3aXRjaCAoaykge1xuXHRcdFx0XHRjYXNlIEdQX1NwYWNlOiB7XG5cdFx0XHRcdFx0Y29uc3Qgc2l6ZSA9IHdyYXBwZWQudG9rZW5zLmxlbmd0aFxuXHRcdFx0XHRcdGlmIChzaXplID09PSAwKVxuXHRcdFx0XHRcdFx0cmV0dXJuXG5cdFx0XHRcdFx0ZWxzZSBpZiAoc2l6ZSA9PT0gMSlcblx0XHRcdFx0XHRcdC8vIFNwYWNlZCBzaG91bGQgYWx3YXlzIGhhdmUgYXQgbGVhc3QgdHdvIGVsZW1lbnRzXG5cdFx0XHRcdFx0XHR3cmFwcGVkID0gd3JhcHBlZC50b2tlbnNbMF1cblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhc2UgR1BfTGluZTpcblx0XHRcdFx0XHRpZiAoaXNFbXB0eSh3cmFwcGVkLnRva2VucykpXG5cdFx0XHRcdFx0XHRyZXR1cm5cblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIEdQX0Nsb3NlQmxvY2s6XG5cdFx0XHRcdFx0aWYgKGlzRW1wdHkod3JhcHBlZC50b2tlbnMpKVxuXHRcdFx0XHRcdFx0Y3guZmFpbChjbG9zZVBvcywgJ0VtcHR5IGJsb2NrJylcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHQvLyBmYWxsdGhyb3VnaFxuXHRcdFx0fVxuXHRcdFx0Y3VyLnRva2Vucy5wdXNoKHdyYXBwZWQpXG5cdFx0fSxcblxuXHRcdHdyYXBMZXZlbCA9IGNsb3NlUG9zID0+IHtcblx0XHRcdGNvbnN0IGJ1aWx0R3JvdXAgPSBjdXJcblx0XHRcdGN1ciA9IHN0YWNrLnBvcCgpXG5cdFx0XHRidWlsdEdyb3VwLmxvYy5lbmQgPSBjbG9zZVBvc1xuXHRcdFx0cmV0dXJuIGJ1aWx0R3JvdXBcblx0XHR9LFxuXG5cdFx0c3RhcnRMaW5lID0gcG9zID0+IHtcblx0XHRcdG5ld0xldmVsKHBvcywgR1BfTGluZSlcblx0XHRcdG5ld0xldmVsKHBvcywgR1BfU3BhY2UpXG5cdFx0fSxcblx0XHRlbmRMaW5lID0gcG9zID0+IHtcblx0XHRcdGZpbmlzaExldmVscyhwb3MsIEdQX1NwYWNlKVxuXHRcdFx0ZmluaXNoTGV2ZWxzKHBvcywgR1BfTGluZSlcblx0XHR9LFxuXG5cdFx0ZW5kQW5kU3RhcnQgPSAobG9jLCBrKSA9PiB7XG5cdFx0XHRmaW5pc2hMZXZlbHMobG9jLnN0YXJ0LCBrKVxuXHRcdFx0bmV3TGV2ZWwobG9jLmVuZCwgaylcblx0XHR9XG5cblx0Y3VyID0gR3JvdXAoTG9jKFN0YXJ0UG9zLCBudWxsKSwgWyBdLCBHUF9PcGVuQmxvY2spXG5cdHN0YXJ0TGluZShTdGFydFBvcylcblxuXHRsZXQgZW5kTG9jID0gTG9jKFN0YXJ0UG9zLCBTdGFydFBvcylcblx0cHJlR3JvdXBlZFRva2Vucy5mb3JFYWNoKF8gPT4ge1xuXHRcdGlmIChfIGluc3RhbmNlb2YgR3JvdXBQcmUpIHtcblx0XHRcdC8vIEl0J3MgYSBHcm91cFByZVxuXHRcdFx0Y29uc3QgbG9jID0gXy5sb2Ncblx0XHRcdGVuZExvYyA9IGxvY1xuXHRcdFx0Y29uc3Qga2luZCA9IF8ua2luZFxuXHRcdFx0c3dpdGNoIChraW5kKSB7XG5cdFx0XHRcdGNhc2UgR1BfT3BlblBhcmVuOiBjYXNlIEdQX09wZW5CcmFja2V0OlxuXHRcdFx0XHRcdG5ld0xldmVsKGxvYy5zdGFydCwga2luZClcblx0XHRcdFx0XHRuZXdMZXZlbChsb2MuZW5kLCBHUF9TcGFjZSlcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIEdQX0Nsb3NlUGFyZW46IGNhc2UgR1BfQ2xvc2VCcmFja2V0OlxuXHRcdFx0XHRcdGZpbmlzaExldmVscyhsb2MuZW5kLCBraW5kKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgR1BfT3BlblF1b3RlOlxuXHRcdFx0XHRcdG5ld0xldmVsKGxvYy5zdGFydCwga2luZClcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIEdQX0Nsb3NlUXVvdGU6XG5cdFx0XHRcdFx0ZmluaXNoTGV2ZWxzKGxvYy5zdGFydCwga2luZClcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIEdQX09wZW5CbG9jazpcblx0XHRcdFx0XHQvLyAgfiBiZWZvcmUgYmxvY2sgaXMgT0tcblx0XHRcdFx0XHRpZiAoaXNFbXB0eShjdXIudG9rZW5zKSB8fCAhS2V5d29yZC5pc0xhenkobGFzdChjdXIudG9rZW5zKSkpXG5cdFx0XHRcdFx0XHRlbmRBbmRTdGFydChsb2MsIEdQX1NwYWNlKVxuXHRcdFx0XHRcdG5ld0xldmVsKGxvYy5zdGFydCwga2luZClcblx0XHRcdFx0XHRzdGFydExpbmUobG9jLmVuZClcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIEdQX0Nsb3NlQmxvY2s6XG5cdFx0XHRcdFx0ZW5kTGluZShsb2Muc3RhcnQpXG5cdFx0XHRcdFx0ZmluaXNoTGV2ZWxzKGxvYy5lbmQsIGtpbmQpXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBHUF9MaW5lOlxuXHRcdFx0XHRcdGVuZExpbmUobG9jLnN0YXJ0KVxuXHRcdFx0XHRcdHN0YXJ0TGluZShsb2MuZW5kKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgR1BfU3BhY2U6XG5cdFx0XHRcdFx0ZW5kQW5kU3RhcnQobG9jLCBraW5kKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihraW5kKVxuXHRcdFx0fVxuXHRcdH0gZWxzZVxuXHRcdFx0Y3VyLnRva2Vucy5wdXNoKF8pXG5cdH0pXG5cblx0ZW5kTGluZShlbmRMb2MuZW5kKVxuXHRhc3NlcnQoaXNFbXB0eShzdGFjaykpXG5cdGN1ci5sb2MuZW5kID0gZW5kTG9jLmVuZFxuXHRyZXR1cm4gY3VyXG59XG5cbi8vIFRPRE9cbmNvbnN0IHNob3dHID0ga2luZCA9PiBraW5kXG4iXSwic291cmNlUm9vdCI6Ii9zcmMifQ==