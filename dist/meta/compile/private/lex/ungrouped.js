if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module', 'esast/dist/Loc', '../../CompileError', '../Lang', '../Token', '../U/util', './GroupPre', './char'], function (exports, module, _esastDistLoc, _CompileError, _Lang, _Token, _UUtil, _GroupPre, _char) {
	'use strict';

	var _interopRequire = function (obj) { return obj && obj.__esModule ? obj['default'] : obj; };

	var _Loc = _interopRequire(_esastDistLoc);

	var _GroupPre2 = _interopRequire(_GroupPre);

	module.exports = function (cx, str) {
		const res = [];
		let line = _esastDistLoc.StartLine;
		let column = _esastDistLoc.StartColumn;
		let index = 0;

		const o = function (t) {
			res.push(t);
		},
		      pos = function () {
			return _esastDistLoc.Pos(line, column);
		},
		      loc = function () {
			return _esastDistLoc.singleCharLoc(pos());
		},
		      prev = function () {
			return str.charCodeAt(index - 1);
		},
		      peek = function () {
			return str.charCodeAt(index);
		},
		      eat = function () {
			const ch = str.charCodeAt(index);
			index = index + 1;
			column = column + 1;
			return ch;
		},
		      tryEat = function (ch) {
			const canEat = peek() === ch;
			if (canEat) {
				index = index + 1;
				column = column + 1;
			}
			return canEat;
		},
		      tryEatNewline = function () {
			const canEat = peek() === _char.Newline;
			if (canEat) {
				index = index + 1;
				line = line + 1;
				column = _esastDistLoc.StartColumn;
			}
			return canEat;
		},
		     

		// Caller must ensure that backing up nCharsToBackUp characters brings us to oldPos.
		stepBackMany = function (oldPos, nCharsToBackUp) {
			index = index - nCharsToBackUp;
			line = oldPos.line;
			column = oldPos.column;
		},
		      _skipWhile = function (pred) {
			const startIndex = index;
			while (pred(peek())) index = index + 1;
			const diff = index - startIndex;
			column = column + diff;
			return diff;
		},
		      takeWhileWithPrev = function (pred) {
			const startIndex = index;
			_skipWhile(pred);
			return str.slice(startIndex - 1, index);
		},
		      takeWhile = function (pred) {
			const startIndex = index;
			_skipWhile(pred);
			return str.slice(startIndex, index);
		},
		      skipWhileEquals = function (ch) {
			return _skipWhile(function (_) {
				return _ === ch;
			});
		},
		     

		// Called after seeing the first newline.
		skipNewlines = function () {
			line = line + 1;
			const startLine = line;
			while (peek() === _char.Newline) {
				index = index + 1;
				line = line + 1;
			}
			column = _esastDistLoc.StartColumn;
			return line - startLine;
		},
		      skipRestOfLine = function () {
			while (peek() !== _char.Newline) index = index + 1;
		};

		const ungrouped = function (isInQuote) {
			let indent = 0;

			let ch, startLine, startColumn;
			const loc = function () {
				return _Loc(_esastDistLoc.Pos(startLine, startColumn), pos());
			},
			      keyword = function (k) {
				return _Token.Keyword(loc(), k);
			},
			      gp = function (k) {
				return o(_GroupPre2(loc(), k));
			},
			      eatNumber = function () {
				const lit = takeWhileWithPrev(_char.isNumberCharacter);
				const num = Number(lit);
				cx.check(!Number.isNaN(num), pos, function () {
					return 'Invalid number literal ' + _CompileError.code(lit);
				});
				return _Token.TokenNumberLiteral(loc(), num);
			};

			while (index !== str.length) {
				startLine = line;
				startColumn = column;

				ch = eat();
				switch (ch) {
					case _char.N0:case _char.N1:case _char.N2:case _char.N3:case _char.N4:
					case _char.N5:case _char.N6:case _char.N7:case _char.N8:case _char.N9:
						o(eatNumber());
						break;
					case _char.OpParen:
						gp(_GroupPre.GP_OpenParen);
						break;
					case _char.OpBracket:
						gp(_GroupPre.GP_OpenBracket);
						break;
					case _char.ClParen:
						gp(_GroupPre.GP_CloseParen);
						break;
					case _char.ClBracket:
						gp(_GroupPre.GP_CloseBracket);
						break;
					case _char.ClBrace:
						cx.check(isInQuote, loc, function () {
							return 'Reserved character ' + _char.showChar(ch);
						});
						return;
					case _char.Space:
						cx.warnIf(peek() === _char.Space, loc, 'Multiple spaces in a row');
						gp(_GroupPre.GP_Space);
						break;
					case _char.Dot:
						{
							const p = peek();
							if (p === _char.Space || p === _char.Newline) {
								// ObjLit assign in its own spaced group.
								// We can't just create a new Group here because we want to
								// ensure it's not part of the preceding or following spaced group.
								gp(_GroupPre.GP_Space);
								o(keyword('. '));
								gp(_GroupPre.GP_Space);
							} else o(_Token.DotName(loc(),
							// +1 for the dot we just skipped.
							skipWhileEquals(_char.Dot) + 1, takeWhile(_char.isNameCharacter)));
							break;
						}
					case _char.Colon:
						o(keyword(':'));
						break;
					case _char.Tilde:
						if (tryEat(_char.Bar)) {
							o(keyword('~|'));
							gp(_GroupPre.GP_Space);
							break;
						} else {
							o(keyword('~'));
							break;
						}
						break;
					case _char.Bar:
						// First arg in its own spaced group
						o(keyword('|'));
						gp(_GroupPre.GP_Space);
						break;
					case _char.Underscore:
						o(keyword('_'));
						break;
					case _char.Hash:
						if (!(tryEat(_char.Space) || tryEat(_char.Tab))) cx.fail(loc, function () {
							return '' + _CompileError.code('#') + ' must be followed by space or tab.}';
						});
						skipRestOfLine();
						break;
					case _char.Newline:
						{
							cx.check(!isInQuote, loc, 'Quote interpolation cannot contain newline');
							cx.check(prev() !== _char.Space, loc, 'Line ends in a space');

							// Skip any blank lines.
							skipNewlines();
							const oldIndent = indent;
							indent = skipWhileEquals(_char.Tab);
							cx.check(peek() !== _char.Space, pos, 'Line begins in a space');
							if (indent <= oldIndent) {
								for (let i = indent; i < oldIndent; i = i + 1) gp(_GroupPre.GP_CloseBlock);
								gp(_GroupPre.GP_Line);
							} else {
								cx.check(indent === oldIndent + 1, loc, 'Line is indented more than once');
								gp(_GroupPre.GP_OpenBlock);
							}
							break;
						}
					case _char.Tab:
						cx.fail(loc(), 'Tab may only be used to indent');
						break;
					case _char.Quote:
						lexQuote(indent);
						break;
					case _char.Hyphen:
						if (_char.isDigit(peek())) {
							o(eatNumber());
							break;
						}
					// Else fallthrough
					default:
						{
							cx.check(!_char.isReservedCharacter(ch), loc, function () {
								return 'Reserved character ' + _char.showChar(ch);
							});
							// All other characters should be handled in a case above.
							const name = takeWhileWithPrev(_char.isNameCharacter);
							switch (name) {
								case 'region':
									// Rest of line is a comment.
									skipRestOfLine();
									o(keyword('region'));
									break;
								default:
									if (tryEat(_char.Underscore)) o(_Token.CallOnFocus(loc(), name));else if (_Lang.AllKeywords.has(name)) o(keyword(name));else if (_Lang.ReservedWords.has(name)) cx.fail(loc, 'Reserved word ' + _CompileError.code(name));else o(_Token.Name(loc(), name));
							}
						}
				}
			}
		};

		const lexQuote = function (indent) {
			const quoteIndent = indent + 1;

			const isIndented = tryEatNewline();
			if (isIndented) {
				const actualIndent = skipWhileEquals(_char.Tab);
				cx.check(actualIndent === quoteIndent, pos, 'Indented quote must have exactly one more indent than previous line.');
			}

			let read = '';

			const yieldRead = function () {
				if (read !== '') {
					o(read);
					read = '';
				}
			};

			o(_GroupPre2(loc(), _GroupPre.GP_OpenQuote));

			eatChars: while (true) {
				const chPos = pos();
				const ch = eat();
				switch (ch) {
					case _char.Backslash:
						{
							read = read + quoteEscape(eat());
							break;
						}
					case _char.OpBrace:
						{
							yieldRead();
							// We can't create a Group now because there may be other GroupPre_s inside.
							o(_GroupPre2(_esastDistLoc.singleCharLoc(chPos), _GroupPre.GP_OpenParen));
							ungrouped(true);
							o(_GroupPre2(loc(), _GroupPre.GP_CloseParen));
							break;
						}
					case _char.Newline:
						{
							cx.check(prev !== _char.Space, chPos, 'Line ends in a space');
							cx.check(isIndented, chPos, 'Unclosed quote.');
							let newIndent = skipWhileEquals(_char.Tab);

							let extraNewlines = '';
							// Allow blank lines.
							if (newIndent === 0) {
								extraNewlines = '\n'.repeat(skipNewlines());
								newIndent = skipWhileEquals(_char.Tab);
							}

							if (newIndent < quoteIndent) {
								// Indented quote section is over.
								// Undo reading the tabs and newline.
								stepBackMany(chPos, newIndent + 1);
								_UUtil.assert(peek() === _char.Newline);
								break eatChars;
							} else read = read + extraNewlines + '\n' + '\t'.repeat(newIndent - quoteIndent);
							break;
						}
					case _char.Quote:
						if (!isIndented) break eatChars;
					// Else fallthrough
					default:
						read = read + String.fromCharCode(ch);
				}
			}

			yieldRead();
			o(_GroupPre2(loc(), _GroupPre.GP_CloseQuote));
		};

		const quoteEscape = function (ch) {
			switch (ch) {
				case _char.OpBrace:
					return '{';
				case _char.LetterN:
					return '\n';
				case _char.LetterT:
					return '\t';
				case _char.Quote:
					return '"';
				case _char.Backslash:
					return '\\';
				default:
					cx.fail(pos, 'No need to escape ' + _char.showChar(ch));
			}
		};

		ungrouped(false);
		return res;
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1ldGEvY29tcGlsZS9wcml2YXRlL2xleC91bmdyb3VwZWQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O2tCQVllLFVBQUMsRUFBRSxFQUFFLEdBQUcsRUFBSztBQUMzQixRQUFNLEdBQUcsR0FBRyxFQUFHLENBQUE7QUFDZixNQUFJLElBQUksaUJBZFUsU0FBUyxBQWNQLENBQUE7QUFDcEIsTUFBSSxNQUFNLGlCQWZtQixXQUFXLEFBZWhCLENBQUE7QUFDeEIsTUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFBOztBQUViLFFBQ0MsQ0FBQyxHQUFHLFVBQUEsQ0FBQyxFQUFJO0FBQUUsTUFBRyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQTtHQUFFO1FBRXhCLEdBQUcsR0FBRztVQUFNLGNBckJBLEdBQUcsQ0FxQkMsSUFBSSxFQUFFLE1BQU0sQ0FBQztHQUFBO1FBQzdCLEdBQUcsR0FBRztVQUFNLGNBdEI2QixhQUFhLENBc0I1QixHQUFHLEVBQUUsQ0FBQztHQUFBO1FBRWhDLElBQUksR0FBRztVQUFNLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztHQUFBO1FBQ3RDLElBQUksR0FBRztVQUFNLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDO0dBQUE7UUFFbEMsR0FBRyxHQUFHLFlBQU07QUFDWCxTQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ2hDLFFBQUssR0FBRyxLQUFLLEdBQUcsQ0FBQyxDQUFBO0FBQ2pCLFNBQU0sR0FBRyxNQUFNLEdBQUcsQ0FBQyxDQUFBO0FBQ25CLFVBQU8sRUFBRSxDQUFBO0dBQ1Q7UUFDRCxNQUFNLEdBQUcsVUFBQSxFQUFFLEVBQUk7QUFDZCxTQUFNLE1BQU0sR0FBRyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUE7QUFDNUIsT0FBSSxNQUFNLEVBQUU7QUFDWCxTQUFLLEdBQUcsS0FBSyxHQUFHLENBQUMsQ0FBQTtBQUNq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QUUsQ0FBQyxJQUFJLENBQUMsR0FBRyx5QkFBdUIsTUF4VHJDLFFBQVEsQ0F3VHNDLEVBQUUsQ0FBQyxDQUFHLENBQUE7QUFBQSxJQUMxRDtHQUNELENBQUE7O0FBRUQsV0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ2hCLFNBQU8sR0FBRyxDQUFBO0VBQ1YiLCJmaWxlIjoibWV0YS9jb21waWxlL3ByaXZhdGUvbGV4L3VuZ3JvdXBlZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMb2MsIHsgUG9zLCBTdGFydExpbmUsIFN0YXJ0Q29sdW1uLCBzaW5nbGVDaGFyTG9jIH0gZnJvbSAnZXNhc3QvZGlzdC9Mb2MnXG5pbXBvcnQgeyBjb2RlIH0gZnJvbSAnLi4vLi4vQ29tcGlsZUVycm9yJ1xuaW1wb3J0IHsgQWxsS2V5d29yZHMsIFJlc2VydmVkV29yZHMgfSBmcm9tICcuLi9MYW5nJ1xuaW1wb3J0IHsgQ2FsbE9uRm9jdXMsIERvdE5hbWUsIEtleXdvcmQsIFRva2VuTnVtYmVyTGl0ZXJhbCwgTmFtZSB9IGZyb20gJy4uL1Rva2VuJ1xuaW1wb3J0IHsgYXNzZXJ0IH0gZnJvbSAnLi4vVS91dGlsJ1xuaW1wb3J0IEdyb3VwUHJlLCB7IEdQX09wZW5QYXJlbiwgR1BfT3BlbkJyYWNrZXQsIEdQX09wZW5CbG9jaywgR1BfT3BlblF1b3RlLCBHUF9MaW5lLFxuXHRHUF9TcGFjZSwgR1BfQ2xvc2VQYXJlbiwgR1BfQ2xvc2VCcmFja2V0LCBHUF9DbG9zZUJsb2NrLCBHUF9DbG9zZVF1b3RlfSBmcm9tICcuL0dyb3VwUHJlJ1xuaW1wb3J0IHsgc2hvd0NoYXIsIE4wLCBOMSwgTjIsIE4zLCBONCwgTjUsIE42LCBONywgTjgsIE45LFxuXHRPcFBhcmVuLCBPcEJyYWNrZXQsIE9wQnJhY2UsIENsUGFyZW4sIENsQnJhY2tldCwgQ2xCcmFjZSwgU3BhY2UsIERvdCwgQ29sb24sIFRpbGRlLCBCYXIsXG5cdFVuZGVyc2NvcmUsIEJhY2tzbGFzaCwgSGFzaCwgTmV3bGluZSwgUXVvdGUsIFRhYiwgSHlwaGVuLCBMZXR0ZXJOLCBMZXR0ZXJULFxuXHRpc0RpZ2l0LCBpc05hbWVDaGFyYWN0ZXIsIGlzTnVtYmVyQ2hhcmFjdGVyLCBpc1Jlc2VydmVkQ2hhcmFjdGVyIH0gZnJvbSAnLi9jaGFyJ1xuXG5leHBvcnQgZGVmYXVsdCAoY3gsIHN0cikgPT4ge1xuXHRjb25zdCByZXMgPSBbIF1cblx0bGV0IGxpbmUgPSBTdGFydExpbmVcblx0bGV0IGNvbHVtbiA9IFN0YXJ0Q29sdW1uXG5cdGxldCBpbmRleCA9IDBcblxuXHRjb25zdFxuXHRcdG8gPSB0ID0+IHsgcmVzLnB1c2godCkgfSxcblxuXHRcdHBvcyA9ICgpID0+IFBvcyhsaW5lLCBjb2x1bW4pLFxuXHRcdGxvYyA9ICgpID0+IHNpbmdsZUNoYXJMb2MocG9zKCkpLFxuXG5cdFx0cHJldiA9ICgpID0+IHN0ci5jaGFyQ29kZUF0KGluZGV4IC0gMSksXG5cdFx0cGVlayA9ICgpID0+IHN0ci5jaGFyQ29kZUF0KGluZGV4KSxcblxuXHRcdGVhdCA9ICgpID0+IHtcblx0XHRcdGNvbnN0IGNoID0gc3RyLmNoYXJDb2RlQXQoaW5kZXgpXG5cdFx0XHRpbmRleCA9IGluZGV4ICsgMVxuXHRcdFx0Y29sdW1uID0gY29sdW1uICsgMVxuXHRcdFx0cmV0dXJuIGNoXG5cdFx0fSxcblx0XHR0cnlFYXQgPSBjaCA9PiB7XG5cdFx0XHRjb25zdCBjYW5FYXQgPSBwZWVrKCkgPT09IGNoXG5cdFx0XHRpZiAoY2FuRWF0KSB7XG5cdFx0XHRcdGluZGV4ID0gaW5kZXggKyAxXG5cdFx0XHRcdGNvbHVtbiA9IGNvbHVtbiArIDFcblx0XHRcdH1cblx0XHRcdHJldHVybiBjYW5FYXRcblx0XHR9LFxuXHRcdHRyeUVhdE5ld2xpbmUgPSAoKSA9PiB7XG5cdFx0XHRjb25zdCBjYW5FYXQgPSBwZWVrKCkgPT09IE5ld2xpbmVcblx0XHRcdGlmIChjYW5FYXQpIHtcblx0XHRcdFx0aW5kZXggPSBpbmRleCArIDFcblx0XHRcdFx0bGluZSA9IGxpbmUgKyAxXG5cdFx0XHRcdGNvbHVtbiA9IFN0YXJ0Q29sdW1uXG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gY2FuRWF0XG5cdFx0fSxcblxuXHRcdC8vIENhbGxlciBtdXN0IGVuc3VyZSB0aGF0IGJhY2tpbmcgdXAgbkNoYXJzVG9CYWNrVXAgY2hhcmFjdGVycyBicmluZ3MgdXMgdG8gb2xkUG9zLlxuXHRcdHN0ZXBCYWNrTWFueSA9IChvbGRQb3MsIG5DaGFyc1RvQmFja1VwKSA9PiB7XG5cdFx0XHRpbmRleCA9IGluZGV4IC0gbkNoYXJzVG9CYWNrVXBcblx0XHRcdGxpbmUgPSBvbGRQb3MubGluZVxuXHRcdFx0Y29sdW1uID0gb2xkUG9zLmNvbHVtblxuXHRcdH0sXG5cblx0XHRfc2tpcFdoaWxlID0gcHJlZCA9PiB7XG5cdFx0XHRjb25zdCBzdGFydEluZGV4ID0gaW5kZXhcblx0XHRcdHdoaWxlIChwcmVkKHBlZWsoKSkpXG5cdFx0XHRcdGluZGV4ID0gaW5kZXggKyAxXG5cdFx0XHRjb25zdCBkaWZmID0gaW5kZXggLSBzdGFydEluZGV4XG5cdFx0XHRjb2x1bW4gPSBjb2x1bW4gKyBkaWZmXG5cdFx0XHRyZXR1cm4gZGlmZlxuXHRcdH0sXG5cdFx0dGFrZVdoaWxlV2l0aFByZXYgPSBwcmVkID0+IHtcblx0XHRcdGNvbnN0IHN0YXJ0SW5kZXggPSBpbmRleFxuXHRcdFx0X3NraXBXaGlsZShwcmVkKVxuXHRcdFx0cmV0dXJuIHN0ci5zbGljZShzdGFydEluZGV4IC0gMSwgaW5kZXgpXG5cdFx0fSxcblx0XHR0YWtlV2hpbGUgPSBwcmVkID0+IHtcblx0XHRcdGNvbnN0IHN0YXJ0SW5kZXggPSBpbmRleFxuXHRcdFx0X3NraXBXaGlsZShwcmVkKVxuXHRcdFx0cmV0dXJuIHN0ci5zbGljZShzdGFydEluZGV4LCBpbmRleClcblx0XHR9LFxuXHRcdHNraXBXaGlsZUVxdWFscyA9IGNoID0+IF9za2lwV2hpbGUoXyA9PiBfID09PSBjaCksXG5cblx0XHQvLyBDYWxsZWQgYWZ0ZXIgc2VlaW5nIHRoZSBmaXJzdCBuZXdsaW5lLlxuXHRcdHNraXBOZXdsaW5lcyA9ICgpID0+IHtcblx0XHRcdGxpbmUgPSBsaW5lICsgMVxuXHRcdFx0Y29uc3Qgc3RhcnRMaW5lID0gbGluZVxuXHRcdFx0d2hpbGUgKHBlZWsoKSA9PT0gTmV3bGluZSkge1xuXHRcdFx0XHRpbmRleCA9IGluZGV4ICsgMVxuXHRcdFx0XHRsaW5lID0gbGluZSArIDFcblx0XHRcdH1cblx0XHRcdGNvbHVtbiA9IFN0YXJ0Q29sdW1uXG5cdFx0XHRyZXR1cm4gbGluZSAtIHN0YXJ0TGluZVxuXHRcdH0sXG5cblx0XHRza2lwUmVzdE9mTGluZSA9ICgpID0+IHtcblx0XHRcdHdoaWxlIChwZWVrKCkgIT09IE5ld2xpbmUpXG5cdFx0XHRcdGluZGV4ID0gaW5kZXggKyAxXG5cdFx0fVxuXG5cdGNvbnN0IHVuZ3JvdXBlZCA9IGlzSW5RdW90ZSA9PiB7XG5cdFx0bGV0IGluZGVudCA9IDBcblxuXHRcdGxldCBjaCwgc3RhcnRMaW5lLCBzdGFydENvbHVtblxuXHRcdGNvbnN0XG5cdFx0XHRsb2MgPSAoKSA9PiBMb2MoUG9zKHN0YXJ0TGluZSwgc3RhcnRDb2x1bW4pLCBwb3MoKSksXG5cdFx0XHRrZXl3b3JkID0gayA9PiBLZXl3b3JkKGxvYygpLCBrKSxcblx0XHRcdGdwID0gayA9PiBvKEdyb3VwUHJlKGxvYygpLCBrKSksXG5cdFx0XHRlYXROdW1iZXIgPSAoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGxpdCA9IHRha2VXaGlsZVdpdGhQcmV2KGlzTnVtYmVyQ2hhcmFjdGVyKVxuXHRcdFx0XHRjb25zdCBudW0gPSBOdW1iZXIobGl0KVxuXHRcdFx0XHRjeC5jaGVjayghTnVtYmVyLmlzTmFOKG51bSksIHBvcywgKCkgPT5cblx0XHRcdFx0XHRgSW52YWxpZCBudW1iZXIgbGl0ZXJhbCAke2NvZGUobGl0KX1gKVxuXHRcdFx0XHRyZXR1cm4gVG9rZW5OdW1iZXJMaXRlcmFsKGxvYygpLCBudW0pXG5cdFx0XHR9XG5cblx0XHR3aGlsZSAoaW5kZXggIT09IHN0ci5sZW5ndGgpIHtcblx0XHRcdHN0YXJ0TGluZSA9IGxpbmVcblx0XHRcdHN0YXJ0Q29sdW1uID0gY29sdW1uXG5cblx0XHRcdGNoID0gZWF0KClcblx0XHRcdHN3aXRjaCAoY2gpIHtcblx0XHRcdFx0Y2FzZSBOMDogY2FzZSBOMTogY2FzZSBOMjogY2FzZSBOMzogY2FzZSBONDpcblx0XHRcdFx0Y2FzZSBONTogY2FzZSBONjogY2FzZSBONzogY2FzZSBOODogY2FzZSBOOTpcblx0XHRcdFx0XHRvKGVhdE51bWJlcigpKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgT3BQYXJlbjpcblx0XHRcdFx0XHRncChHUF9PcGVuUGFyZW4pXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBPcEJyYWNrZXQ6XG5cdFx0XHRcdFx0Z3AoR1BfT3BlbkJyYWNrZXQpXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBDbFBhcmVuOlxuXHRcdFx0XHRcdGdwKEdQX0Nsb3NlUGFyZW4pXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBDbEJyYWNrZXQ6XG5cdFx0XHRcdFx0Z3AoR1BfQ2xvc2VCcmFja2V0KVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgQ2xCcmFjZTpcblx0XHRcdFx0XHRjeC5jaGVjayhpc0luUXVvdGUsIGxvYywgKCkgPT4gYFJlc2VydmVkIGNoYXJhY3RlciAke3Nob3dDaGFyKGNoKX1gKVxuXHRcdFx0XHRcdHJldHVyblxuXHRcdFx0XHRjYXNlIFNwYWNlOlxuXHRcdFx0XHRcdGN4Lndhcm5JZihwZWVrKCkgPT09IFNwYWNlLCBsb2MsICdNdWx0aXBsZSBzcGFjZXMgaW4gYSByb3cnKVxuXHRcdFx0XHRcdGdwKEdQX1NwYWNlKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgRG90OiB7XG5cdFx0XHRcdFx0Y29uc3QgcCA9IHBlZWsoKVxuXHRcdFx0XHRcdGlmIChwID09PSBTcGFjZSB8fCBwID09PSBOZXdsaW5lKSB7XG5cdFx0XHRcdFx0XHQvLyBPYmpMaXQgYXNzaWduIGluIGl0cyBvd24gc3BhY2VkIGdyb3VwLlxuXHRcdFx0XHRcdFx0Ly8gV2UgY2FuJ3QganVzdCBjcmVhdGUgYSBuZXcgR3JvdXAgaGVyZSBiZWNhdXNlIHdlIHdhbnQgdG9cblx0XHRcdFx0XHRcdC8vIGVuc3VyZSBpdCdzIG5vdCBwYXJ0IG9mIHRoZSBwcmVjZWRpbmcgb3IgZm9sbG93aW5nIHNwYWNlZCBncm91cC5cblx0XHRcdFx0XHRcdGdwKEdQX1NwYWNlKVxuXHRcdFx0XHRcdFx0byhrZXl3b3JkKCcuICcpKVxuXHRcdFx0XHRcdFx0Z3AoR1BfU3BhY2UpXG5cdFx0XHRcdFx0fSBlbHNlXG5cdFx0XHRcdFx0XHRvKERvdE5hbWUoXG5cdFx0XHRcdFx0XHRcdGxvYygpLFxuXHRcdFx0XHRcdFx0XHQvLyArMSBmb3IgdGhlIGRvdCB3ZSBqdXN0IHNraXBwZWQuXG5cdFx0XHRcdFx0XHRcdHNraXBXaGlsZUVxdWFscyhEb3QpICsgMSxcblx0XHRcdFx0XHRcdFx0dGFrZVdoaWxlKGlzTmFtZUNoYXJhY3RlcikpKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdH1cblx0XHRcdFx0Y2FzZSBDb2xvbjpcblx0XHRcdFx0XHRvKGtleXdvcmQoJzonKSlcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIFRpbGRlOlxuXHRcdFx0XHRcdGlmICh0cnlFYXQoQmFyKSkge1xuXHRcdFx0XHRcdFx0byhrZXl3b3JkKCd+fCcpKVxuXHRcdFx0XHRcdFx0Z3AoR1BfU3BhY2UpXG5cdFx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRvKGtleXdvcmQoJ34nKSlcblx0XHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgQmFyOlxuXHRcdFx0XHRcdC8vIEZpcnN0IGFyZyBpbiBpdHMgb3duIHNwYWNlZCBncm91cFxuXHRcdFx0XHRcdG8oa2V5d29yZCgnfCcpKVxuXHRcdFx0XHRcdGdwKEdQX1NwYWNlKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdGNhc2UgVW5kZXJzY29yZTpcblx0XHRcdFx0XHRvKGtleXdvcmQoJ18nKSlcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHRjYXNlIEhhc2g6XG5cdFx0XHRcdFx0aWYgKCEodHJ5RWF0KFNwYWNlKSB8fCB0cnlFYXQoVGFiKSkpXG5cdFx0XHRcdFx0XHRjeC5mYWlsKGxvYywgKCkgPT4gYCR7Y29kZSgnIycpfSBtdXN0IGJlIGZvbGxvd2VkIGJ5IHNwYWNlIG9yIHRhYi59YClcblx0XHRcdFx0XHRza2lwUmVzdE9mTGluZSgpXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBOZXdsaW5lOiB7XG5cdFx0XHRcdFx0Y3guY2hlY2soIWlzSW5RdW90ZSwgbG9jLCAnUXVvdGUgaW50ZXJwb2xhdGlvbiBjYW5ub3QgY29udGFpbiBuZXdsaW5lJylcblx0XHRcdFx0XHRjeC5jaGVjayhwcmV2KCkgIT09IFNwYWNlLCBsb2MsICdMaW5lIGVuZHMgaW4gYSBzcGFjZScpXG5cblx0XHRcdFx0XHQvLyBTa2lwIGFueSBibGFuayBsaW5lcy5cblx0XHRcdFx0XHRza2lwTmV3bGluZXMoKVxuXHRcdFx0XHRcdGNvbnN0IG9sZEluZGVudCA9IGluZGVudFxuXHRcdFx0XHRcdGluZGVudCA9IHNraXBXaGlsZUVxdWFscyhUYWIpXG5cdFx0XHRcdFx0Y3guY2hlY2socGVlaygpICE9PSBTcGFjZSwgcG9zLCAnTGluZSBiZWdpbnMgaW4gYSBzcGFjZScpXG5cdFx0XHRcdFx0aWYgKGluZGVudCA8PSBvbGRJbmRlbnQpIHtcblx0XHRcdFx0XHRcdGZvciAobGV0IGkgPSBpbmRlbnQ7IGkgPCBvbGRJbmRlbnQ7IGkgPSBpICsgMSlcblx0XHRcdFx0XHRcdFx0Z3AoR1BfQ2xvc2VCbG9jaylcblx0XHRcdFx0XHRcdGdwKEdQX0xpbmUpXG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGN4LmNoZWNrKGluZGVudCA9PT0gb2xkSW5kZW50ICsgMSwgbG9jLCAnTGluZSBpcyBpbmRlbnRlZCBtb3JlIHRoYW4gb25jZScpXG5cdFx0XHRcdFx0XHRncChHUF9PcGVuQmxvY2spXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdH1cblx0XHRcdFx0Y2FzZSBUYWI6XG5cdFx0XHRcdFx0Y3guZmFpbChsb2MoKSwgJ1RhYiBtYXkgb25seSBiZSB1c2VkIHRvIGluZGVudCcpXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBRdW90ZTpcblx0XHRcdFx0XHRsZXhRdW90ZShpbmRlbnQpXG5cdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0Y2FzZSBIeXBoZW46XG5cdFx0XHRcdFx0aWYgKGlzRGlnaXQocGVlaygpKSkge1xuXHRcdFx0XHRcdFx0byhlYXROdW1iZXIoKSlcblx0XHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8vIEVsc2UgZmFsbHRocm91Z2hcblx0XHRcdFx0ZGVmYXVsdDoge1xuXHRcdFx0XHRcdGN4LmNoZWNrKFxuXHRcdFx0XHRcdFx0IWlzUmVzZXJ2ZWRDaGFyYWN0ZXIoY2gpLCBsb2MsICgpID0+IGBSZXNlcnZlZCBjaGFyYWN0ZXIgJHtzaG93Q2hhcihjaCl9YClcblx0XHRcdFx0XHQvLyBBbGwgb3RoZXIgY2hhcmFjdGVycyBzaG91bGQgYmUgaGFuZGxlZCBpbiBhIGNhc2UgYWJvdmUuXG5cdFx0XHRcdFx0Y29uc3QgbmFtZSA9IHRha2VXaGlsZVdpdGhQcmV2KGlzTmFtZUNoYXJhY3Rlcilcblx0XHRcdFx0XHRzd2l0Y2ggKG5hbWUpIHtcblx0XHRcdFx0XHRcdGNhc2UgJ3JlZ2lvbic6XG5cdFx0XHRcdFx0XHRcdC8vIFJlc3Qgb2YgbGluZSBpcyBhIGNvbW1lbnQuXG5cdFx0XHRcdFx0XHRcdHNraXBSZXN0T2ZMaW5lKClcblx0XHRcdFx0XHRcdFx0byhrZXl3b3JkKCdyZWdpb24nKSlcblx0XHRcdFx0XHRcdFx0YnJlYWtcblx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdGlmICh0cnlFYXQoVW5kZXJzY29yZSkpXG5cdFx0XHRcdFx0XHRcdFx0byhDYWxsT25Gb2N1cyhsb2MoKSwgbmFtZSkpXG5cdFx0XHRcdFx0XHRcdGVsc2UgaWYgKEFsbEtleXdvcmRzLmhhcyhuYW1lKSlcblx0XHRcdFx0XHRcdFx0XHRvKGtleXdvcmQobmFtZSkpXG5cdFx0XHRcdFx0XHRcdGVsc2UgaWYgKFJlc2VydmVkV29yZHMuaGFzKG5hbWUpKVxuXHRcdFx0XHRcdFx0XHRcdGN4LmZhaWwobG9jLCBgUmVzZXJ2ZWQgd29yZCAke2NvZGUobmFtZSl9YClcblx0XHRcdFx0XHRcdFx0ZWxzZVxuXHRcdFx0XHRcdFx0XHRcdG8oTmFtZShsb2MoKSwgbmFtZSkpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0Y29uc3QgbGV4UXVvdGUgPSBpbmRlbnQgPT4ge1xuXHRcdGNvbnN0IHF1b3RlSW5kZW50ID0gaW5kZW50ICsgMVxuXG5cdFx0Y29uc3QgaXNJbmRlbnRlZCA9IHRyeUVhdE5ld2xpbmUoKVxuXHRcdGlmIChpc0luZGVudGVkKSB7XG5cdFx0XHRjb25zdCBhY3R1YWxJbmRlbnQgPSBza2lwV2hpbGVFcXVhbHMoVGFiKVxuXHRcdFx0Y3guY2hlY2soYWN0dWFsSW5kZW50ID09PSBxdW90ZUluZGVudCwgcG9zLFxuXHRcdFx0XHQnSW5kZW50ZWQgcXVvdGUgbXVzdCBoYXZlIGV4YWN0bHkgb25lIG1vcmUgaW5kZW50IHRoYW4gcHJldmlvdXMgbGluZS4nKVxuXHRcdH1cblxuXHRcdGxldCByZWFkID0gJydcblxuXHRcdGNvbnN0IHlpZWxkUmVhZCA9ICgpID0+IHtcblx0XHRcdGlmIChyZWFkICE9PSAnJykge1xuXHRcdFx0XHRvKHJlYWQpXG5cdFx0XHRcdHJlYWQgPSAnJ1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdG8oR3JvdXBQcmUobG9jKCksIEdQX09wZW5RdW90ZSkpXG5cblx0XHRlYXRDaGFyczogd2hpbGUgKHRydWUpIHtcblx0XHRcdGNvbnN0IGNoUG9zID0gcG9zKClcblx0XHRcdGNvbnN0IGNoID0gZWF0KClcblx0XHRcdHN3aXRjaCAoY2gpIHtcblx0XHRcdFx0Y2FzZSBCYWNrc2xhc2g6IHtcblx0XHRcdFx0XHRyZWFkID0gcmVhZCArIHF1b3RlRXNjYXBlKGVhdCgpKVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdH1cblx0XHRcdFx0Y2FzZSBPcEJyYWNlOiB7XG5cdFx0XHRcdFx0eWllbGRSZWFkKClcblx0XHRcdFx0XHQvLyBXZSBjYW4ndCBjcmVhdGUgYSBHcm91cCBub3cgYmVjYXVzZSB0aGVyZSBtYXkgYmUgb3RoZXIgR3JvdXBQcmVfcyBpbnNpZGUuXG5cdFx0XHRcdFx0byhHcm91cFByZShzaW5nbGVDaGFyTG9jKGNoUG9zKSwgR1BfT3BlblBhcmVuKSlcblx0XHRcdFx0XHR1bmdyb3VwZWQodHJ1ZSlcblx0XHRcdFx0XHRvKEdyb3VwUHJlKGxvYygpLCBHUF9DbG9zZVBhcmVuKSlcblx0XHRcdFx0XHRicmVha1xuXHRcdFx0XHR9XG5cdFx0XHRcdGNhc2UgTmV3bGluZToge1xuXHRcdFx0XHRcdGN4LmNoZWNrKHByZXYgIT09IFNwYWNlLCBjaFBvcywgJ0xpbmUgZW5kcyBpbiBhIHNwYWNlJylcblx0XHRcdFx0XHRjeC5jaGVjayhpc0luZGVudGVkLCBjaFBvcywgJ1VuY2xvc2VkIHF1b3RlLicpXG5cdFx0XHRcdFx0bGV0IG5ld0luZGVudCA9IHNraXBXaGlsZUVxdWFscyhUYWIpXG5cblx0XHRcdFx0XHRsZXQgZXh0cmFOZXdsaW5lcyA9ICcnXG5cdFx0XHRcdFx0Ly8gQWxsb3cgYmxhbmsgbGluZXMuXG5cdFx0XHRcdFx0aWYgKG5ld0luZGVudCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0ZXh0cmFOZXdsaW5lcyA9ICdcXG4nLnJlcGVhdChza2lwTmV3bGluZXMoKSlcblx0XHRcdFx0XHRcdG5ld0luZGVudCA9IHNraXBXaGlsZUVxdWFscyhUYWIpXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKG5ld0luZGVudCA8IHF1b3RlSW5kZW50KSB7XG5cdFx0XHRcdFx0XHQvLyBJbmRlbnRlZCBxdW90ZSBzZWN0aW9uIGlzIG92ZXIuXG5cdFx0XHRcdFx0XHQvLyBVbmRvIHJlYWRpbmcgdGhlIHRhYnMgYW5kIG5ld2xpbmUuXG5cdFx0XHRcdFx0XHRzdGVwQmFja01hbnkoY2hQb3MsIG5ld0luZGVudCArIDEpXG5cdFx0XHRcdFx0XHRhc3NlcnQocGVlaygpID09PSBOZXdsaW5lKVxuXHRcdFx0XHRcdFx0YnJlYWsgZWF0Q2hhcnNcblx0XHRcdFx0XHR9IGVsc2Vcblx0XHRcdFx0XHRcdHJlYWQgPSByZWFkICsgZXh0cmFOZXdsaW5lcyArICdcXG4nICsgJ1xcdCcucmVwZWF0KG5ld0luZGVudCAtIHF1b3RlSW5kZW50KVxuXHRcdFx0XHRcdGJyZWFrXG5cdFx0XHRcdH1cblx0XHRcdFx0Y2FzZSBRdW90ZTpcblx0XHRcdFx0XHRpZiAoIWlzSW5kZW50ZWQpXG5cdFx0XHRcdFx0XHRicmVhayBlYXRDaGFyc1xuXHRcdFx0XHRcdC8vIEVsc2UgZmFsbHRocm91Z2hcblx0XHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0XHRyZWFkID0gcmVhZCArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0eWllbGRSZWFkKClcblx0XHRvKEdyb3VwUHJlKGxvYygpLCBHUF9DbG9zZVF1b3RlKSlcblx0fVxuXG5cdGNvbnN0IHF1b3RlRXNjYXBlID0gY2ggPT4ge1xuXHRcdHN3aXRjaCAoY2gpIHtcblx0XHRcdGNhc2UgT3BCcmFjZTogcmV0dXJuICd7J1xuXHRcdFx0Y2FzZSBMZXR0ZXJOOiByZXR1cm4gJ1xcbidcblx0XHRcdGNhc2UgTGV0dGVyVDogcmV0dXJuICdcXHQnXG5cdFx0XHRjYXNlIFF1b3RlOiByZXR1cm4gJ1wiJ1xuXHRcdFx0Y2FzZSBCYWNrc2xhc2g6IHJldHVybiAnXFxcXCdcblx0XHRcdGRlZmF1bHQ6IGN4LmZhaWwocG9zLCBgTm8gbmVlZCB0byBlc2NhcGUgJHtzaG93Q2hhcihjaCl9YClcblx0XHR9XG5cdH1cblxuXHR1bmdyb3VwZWQoZmFsc2UpXG5cdHJldHVybiByZXNcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NyYyJ9