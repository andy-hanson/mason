{"version":3,"sources":["meta/compile/private/verify/Vx.js"],"names":[],"mappings":"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","file":"meta/compile/private/verify/Vx.js","sourcesContent":["import { code } from '../../CompileError'\nimport { LocalDeclare } from '../../Expression'\nimport { SubContext } from '../Cx'\nimport { assert } from '../U/util'\nimport { toArray } from '../U/Bag'\nimport { some } from '../U/Op'\nimport type from '../U/type'\nimport { emptyVr, VrLocalInfo } from '../Vr'\n\n// Context used during verification.\nexport default class Vx extends SubContext {\n\tconstructor(cx) {\n\t\tsuper(cx)\n\t\tthis.locals = new Map()\n\t\t// Locals for this block.\n\t\t// Replaces `locals` when entering into sub-function.\n\t\tthis.pendingBlockLocals = []\n\t\tthis.isInDebug = false\n\t\tthis.isInGenerator = false\n\t\tthis.opLoop = []\n\t\tthis.vr = emptyVr()\n\t}\n\n\t// Getters\n\tallLocalNames() {\n\t\treturn this.locals.keys()\n\t}\n\n\t// Modifiers\n\twithInGenerator(isInGenerator, fun) {\n\t\tconst g = this.isInGenerator\n\t\tthis.isInGenerator = isInGenerator\n\t\tfun()\n\t\tthis.isInGenerator = g\n\t}\n\tplusLocals(addedLocals, fun) {\n\t\ttype(addedLocals, [LocalDeclare])\n\t\tconst shadowed = new Map()\n\t\taddedLocals.forEach(l => {\n\t\t\tconst got = this.locals.get(l.name)\n\t\t\tif (got !== undefined)\n\t\t\t\tshadowed.set(l.name, got)\n\t\t\tthis.locals.set(l.name, l)\n\t\t})\n\t\tfun()\n\t\taddedLocals.forEach(l => {\n\t\t\tthis.locals.delete(l.name)\n\t\t\tconst s = shadowed.get(l.name)\n\t\t\tif (s !== undefined)\n\t\t\t\tthis.locals.set(l.name, s)\n\t\t})\n\t}\n\tplusPendingBlockLocals(pending, fun) {\n\t\tconst oldLength = this.pendingBlockLocals.length\n\t\tthis.pendingBlockLocals.push(...pending)\n\t\tfun()\n\t\twhile (this.pendingBlockLocals.length > oldLength)\n\t\t\tthis.pendingBlockLocals.pop()\n\t}\n\twithInLoop(loop, fun) {\n\t\tconst l = this.opLoop\n\t\tthis.opLoop = some(loop)\n\t\tfun()\n\t\tthis.opLoop = l\n\t}\n\twithInDebug(isInDebug, fun) {\n\t\tconst d = this.isInDebug\n\t\tthis.isInDebug = isInDebug\n\t\tfun()\n\t\tthis.isInDebug = d\n\t}\n\twithRes(loc, fun) {\n\t\t// TODO: Bad idea to be creating new E at this point...\n\t\tconst res = LocalDeclare.res(loc)\n\t\tthis.registerLocal(res)\n\t\treturn this.plusLocals([ res ], fun)\n\t}\n\twithBlockLocals(fun) {\n\t\tconst bl = this.pendingBlockLocals\n\t\tthis.pendingBlockLocals = []\n\t\tthis.plusLocals(bl, fun)\n\t\tthis.pendingBlockLocals = bl\n\t}\n\n\t// Vr setters\n\tsetEndLoop(endLoop, loop) {\n\t\tthis.vr.endLoopToLoop.set(endLoop, loop)\n\t}\n\t// TODO: Better name\n\tsetEIsInGenerator(e) {\n\t\tthis.vr.setEIsInGenerator(e, this.isInGenerator)\n\t}\n\tregisterLocal(local) {\n\t\ttype(local, LocalDeclare)\n\t\tassert(!this.vr.localToInfo.has(local))\n\t\tthis.vr.localToInfo.set(local, VrLocalInfo({\n\t\t\tisInDebug: this.isInDebug,\n\t\t\tdebugAccesses: [],\n\t\t\tnonDebugAccesses: []\n\t\t}))\n\t}\n\n\tlocalAccess(access) {\n\t\tconst name = access.name\n\t\tconst local = this.locals.get(name)\n\t\tif (local !== undefined) {\n\t\t\tthis.vr.accessToLocal.set(access, local)\n\t\t\tconst info = this.vr.localToInfo.get(local)\n\t\t\tconst accesses = this.isInDebug ? info.debugAccesses : info.nonDebugAccesses\n\t\t\taccesses.push(access)\n\t\t} else\n\t\t\tthis.fail(access.loc,\n\t\t\t\t`Could not find local or global ${code(name)}.\\n` +\n\t\t\t\t'Available locals are:\\n' +\n\t\t\t\t`${code(toArray(this.allLocalNames()).join(' '))}.`)\n\t}\n}\n"],"sourceRoot":"/src"}