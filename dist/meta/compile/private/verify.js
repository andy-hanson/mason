if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module', '../CompileError', '../Expression', './util', './VerifyResults'], function (exports, module, _CompileError, _Expression, _util, _VerifyResults) {
	'use strict';

	module.exports = verify;

	function _interopRequire(obj) { return obj && obj.__esModule ? obj['default'] : obj; }

	function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

	var _VerifyResults2 = _interopRequire(_VerifyResults);

	const vm = function (es) {
		return es.forEach(function (e) {
			return e.verify();
		});
	};
	const vop = function (op) {
		return (0, _util.opEach)(op, function (_) {
			return _.verify();
		});
	};

	let cx, locals,
	// Locals for this block.
	// Replaces `locals` when entering into sub-function.
	pendingBlockLocals, isInDebug, isInGenerator, opLoop, vr;

	const init = function (_cx) {
		cx = _cx;
		locals = new Map();
		pendingBlockLocals = [];
		isInDebug = false;
		isInGenerator = false;
		opLoop = null;
		vr = new _VerifyResults2();
	},
	     
	// Release for garbage collection
	uninit = function () {
		locals = pendingBlockLocals = opLoop = vr = undefined;
	},
	      withInGenerator = function (_isInGenerator, fun) {
		const g = isInGenerator;
		isInGenerator = _isInGenerator;
		fun();
		isInGenerator = g;
	},
	      plusLocals = function (addedLocals, fun) {
		const shadowed = new Map();
		addedLocals.forEach(function (l) {
			const got = locals.get(l.name);
			if (got !== undefined) shadowed.set(l.name, got);
			locals.set(l.name, l);
		});
		fun();
		addedLocals.forEach(function (l) {
			const s = shadowed.get(l.name);
			if (s === undefined) locals.delete(l.name);else locals.set(l.name, s);
		});
	},
	      plusPendingBlockLocals = function (pending, fun) {
		const oldLength = pendingBlockLocals.length;
		pendingBlockLocals.push.apply(pendingBlockLocals, _toConsumableArray(pending));
		fun();
		while (pendingBlockLocals.length > oldLength) pendingBlockLocals.pop();
	},
	      withInLoop = function (loop, fun) {
		const l = opLoop;
		opLoop = loop;
		fun();
		opLoop = l;
	},
	      withInDebug = function (_isInDebug, fun) {
		const d = isInDebug;
		isInDebug = _isInDebug;
		fun();
		isInDebug = d;
	},
	      withBlockLocals = function (fun) {
		const bl = pendingBlockLocals;
		pendingBlockLocals = [];
		plusLocals(bl, fun);
		pendingBlockLocals = bl;
	},
	      accessLocal = function (declare, access, isDebugAccess) {
		return _addAccess(vr.localToInfo.get(declare), access, isDebugAccess);
	},
	      accessLocalForReturn = function (declare, access) {
		const info = vr.localToInfo.get(declare);
		_addAccess(info, access, info.isInDebug);
	},
	      _addAccess = function (localInfo, access, isDebugAccess) {
		return (isDebugAccess ? localInfo.debugAccesses : localInfo.nonDebugAccesses).push(access);
	},
	     

	// Vr setters
	setEndLoop = function (endLoop, loop) {
		vr.endLoopToLoop.set(endLoop, loop);
	},
	      registerLocal = function (local) {
		vr.localToInfo.set(local, (0, _VerifyResults.LocalInfo)(isInDebug, [], []));
	},
	      setEntryIndex = function (listMapEntry, index) {
		vr.entryToIndex.set(listMapEntry, index);
	};

	function verify(cx, e) {
		init(cx);
		e.verify();
		verifyLocalUse();
		const out = vr;
		uninit();
		return out;
	}

	const verifyLocalUse = function () {
		vr.localToInfo.forEach(function (info, local) {
			if (!(local instanceof _Expression.LocalDeclareRes)) {
				const noNonDebug = (0, _util.isEmpty)(info.nonDebugAccesses);
				if (noNonDebug && (0, _util.isEmpty)(info.debugAccesses)) cx.warn(local.loc, function () {
					return 'Unused local variable ' + (0, _CompileError.code)(local.name) + '.';
				});else if (info.isInDebug) cx.warnIf(!noNonDebug, function () {
					return (0, _util.head)(info.nonDebugAccesses).loc;
				}, function () {
					return 'Debug-only local ' + (0, _CompileError.code)(local.name) + ' used outside of debug.';
				});else cx.warnIf(noNonDebug, local.loc, function () {
					return 'Local ' + (0, _CompileError.code)(local.name) + ' used only in debug.';
				});
			}
		});
	};

	(0, _util.implementMany)(_Expression, 'verify', {
		Assign: function () {
			var _this = this;

			const doV = function () {
				_this.assignee.verify();
				_this.value.verify();
			};
			if (this.assignee.isLazy()) withBlockLocals(doV);else doV();
		},

		AssignDestructure: function () {
			this.value.verify();
			vm(this.assignees);
		},

		AssignMutate: function () {
			var _this2 = this;

			const declare = getLocalDeclare(this.name, this.loc);
			cx.check(declare.isMutable(), this.loc, function () {
				return '' + (0, _CompileError.code)(_this2.name) + ' is not mutable.';
			});
			// TODO: Track assignments. Mutable local must be mutated somewhere.
			this.value.verify();
		},

		BagEntry: function () {
			this.value.verify();
		},

		BagSimple: function () {
			vm(this.parts);
		},

		BlockDo: function () {
			verifyLines(this.lines);
		},

		BlockWithReturn: function () {
			var _this3 = this;

			var _verifyLines = verifyLines(this.lines);

			const newLocals = _verifyLines.newLocals;

			plusLocals(newLocals, function () {
				return _this3.returned.verify();
			});
		},

		BlockObj: function () {
			var _this4 = this;

			var _verifyLines2 = verifyLines(this.lines);

			const newLocals = _verifyLines2.newLocals;

			this.keys.forEach(function (_) {
				return accessLocalForReturn(_, _this4);
			});
			(0, _util.opEach)(this.opObjed, function (_) {
				return plusLocals(newLocals, function () {
					return _.verify();
				});
			});
		},

		BlockBag: blockBagOrMap,
		BlockMap: blockBagOrMap,

		BlockWrap: function () {
			this.block.verify();
		},

		Call: function () {
			this.called.verify();
			vm(this.args);
		},

		CaseDo: verifyCase,
		CaseDoPart: verifyCasePart,
		CaseVal: verifyCase,
		CaseValPart: verifyCasePart,

		// Only reach here for in/out condition
		Debug: function () {
			verifyLines([this]);
		},

		EndLoop: function () {
			var _this5 = this;

			(0, _util.ifElse)(opLoop, function (_) {
				return setEndLoop(_this5, _);
			}, function () {
				return cx.fail(_this5.loc, 'Not in a loop.');
			});
		},

		Fun: function () {
			var _this6 = this;

			withBlockLocals(function () {
				cx.check(_this6.opResDeclare === null || _this6.block instanceof _Expression.BlockVal, _this6.loc, 'Function with return condition must return something.');
				_this6.args.forEach(function (arg) {
					return vop(arg.opType);
				});
				withInGenerator(_this6.isGenerator, function () {
					const allArgs = (0, _util.cat)(_this6.args, _this6.opRestArg);
					allArgs.forEach(function (_) {
						return registerLocal(_);
					});
					plusLocals(allArgs, function () {
						vop(_this6.opIn);
						_this6.block.verify();
						(0, _util.opEach)(_this6.opResDeclare, function (_) {
							_.verify();
							registerLocal(_);
						});
						const verifyOut = function () {
							return (0, _util.opEach)(_this6.opOut, function (_) {
								return _.verify();
							});
						};
						(0, _util.ifElse)(_this6.opResDeclare, function (rd) {
							return plusLocals([rd], verifyOut);
						}, verifyOut);
					});
				});
			});
		},

		GlobalAccess: function () {},

		IfDo: function () {
			this.test.verify();
			this.result.verify();
		},

		Lazy: function () {
			var _this7 = this;

			withBlockLocals(function () {
				return _this7.value.verify();
			});
		},

		LocalAccess: function () {
			const declare = getLocalDeclare(this.name, this.loc);
			vr.accessToLocal.set(this, declare);
			accessLocal(declare, this, isInDebug);
		},

		Loop: function () {
			var _this8 = this;

			withInLoop(this, function () {
				return _this8.block.verify();
			});
		},

		// Adding LocalDeclares to the available locals is done by Fun or lineNewLocals.
		LocalDeclare: function () {
			vop(this.opType);
		},

		NumberLiteral: function () {},

		MapEntry: function () {
			this.key.verify();
			this.val.verify();
		},

		Member: function () {
			this.object.verify();
		},

		Module: function () {
			var _this9 = this;

			// No need to verify this.doUses.
			const useLocals = verifyUses(this.uses, this.debugUses);
			plusLocals(useLocals, function () {
				var _verifyLines3 = verifyLines(_this9.lines);

				const newLocals = _verifyLines3.newLocals;

				_this9.exports.forEach(function (ex) {
					return accessLocalForReturn(ex, _this9);
				});
				(0, _util.opEach)(_this9.opDefaultExport, function (_) {
					return plusLocals(newLocals, function () {
						return _.verify();
					});
				});
			});

			const exports = (0, _util.newSet)(this.exports);
			const markExportLines = function (line) {
				if (line instanceof _Expression.Assign && exports.has(line.assignee) || line instanceof _Expression.AssignDestructure && line.assignees.some(function (_) {
					return exports.has(_);
				})) vr.exportAssigns.add(line);else if (line instanceof _Expression.Debug) line.lines.forEach(markExportLines);
			};
			this.lines.forEach(markExportLines);
		},

		ObjSimple: function () {
			const keys = new Set();
			this.pairs.forEach(function (pair) {
				cx.check(!keys.has(pair.key), pair.loc, function () {
					return 'Duplicate key ' + pair.key;
				});
				keys.add(pair.key);
				pair.value.verify();
			});
		},

		Quote: function () {
			this.parts.forEach(function (_) {
				if (typeof _ !== 'string') _.verify();
			});
		},

		SpecialDo: function () {},

		SpecialVal: function () {},

		Splat: function () {
			this.splatted.verify();
		},

		Yield: function () {
			cx.check(isInGenerator, this.loc, 'Cannot yield outside of generator context');
			this.yielded.verify();
		},

		YieldTo: function () {
			cx.check(isInGenerator, this.loc, 'Cannot yield outside of generator context');
			this.yieldedTo.verify();
		}
	});

	function blockBagOrMap() {
		var _verifyLines4 = verifyLines(this.lines);

		const listMapLength = _verifyLines4.listMapLength;

		vr.blockToLength.set(this, listMapLength);
	}

	function verifyCase() {
		var _this10 = this;

		const newLocals = [];
		(0, _util.opEach)(this.opCased, function (_) {
			registerLocal(_.assignee);
			_.verify();
			newLocals.push(_.assignee);
		});
		plusLocals(newLocals, function () {
			vm(_this10.parts);
			vop(_this10.opElse);
		});
	}

	function verifyCasePart() {
		var _this11 = this;

		if (this.test instanceof _Expression.Pattern) {
			this.test.type.verify();
			this.test.patterned.verify();
			vm(this.test.locals);
			this.test.locals.forEach(registerLocal);
			plusLocals(this.test.locals, function () {
				return _this11.result.verify();
			});
		} else {
			this.test.verify();
			this.result.verify();
		}
	}

	const getLocalDeclare = function (name, accessLoc) {
		const declare = locals.get(name);
		cx.check(declare !== undefined, accessLoc, function () {
			return 'No such local ' + (0, _CompileError.code)(name) + '.\nLocals are:\n' + (0, _CompileError.code)((0, _util.mapKeys)(locals).join(' ')) + '.';
		});
		return declare;
	},
	      lineNewLocals = function (line) {
		return line instanceof _Expression.Assign ? [line.assignee] : line instanceof _Expression.AssignDestructure ? line.assignees : [];
	},
	      verifyUses = function (uses, debugUses) {
		const useLocals = [];
		const verifyUse = function (use) {
			use.used.forEach(useLocal);
			(0, _util.opEach)(use.opUseDefault, useLocal);
		},
		      useLocal = function (_) {
			registerLocal(_);
			useLocals.push(_);
		};
		uses.forEach(verifyUse);
		withInDebug(true, function () {
			return debugUses.forEach(verifyUse);
		});
		return useLocals;
	},
	      verifyLines = function (lines) {
		const newLocals = [];
		// First, get locals for the whole block.
		const getLineLocals = function (line) {
			if (line instanceof _Expression.Debug) withInDebug(true, function () {
				return line.lines.forEach(getLineLocals);
			});else {
				const news = lineNewLocals(line);
				news.forEach(registerLocal);
				newLocals.push.apply(newLocals, _toConsumableArray(news));
			}
		};

		lines.forEach(getLineLocals);

		const thisBlockLocalNames = new Set();
		const shadowed = new Map();

		let listMapLength = 0;

		const verifyLine = function (line) {
			if (line instanceof _Expression.Debug)
				// TODO: Do anything in this situation?
				// cx.check(!inDebug, line.loc, 'Redundant `debug`.')
				withInDebug(true, function () {
					return line.lines.forEach(verifyLine);
				});else {
				verifyIsStatement(line);
				lineNewLocals(line).forEach(function (l) {
					const got = locals.get(l.name);
					if (got !== undefined) {
						cx.check(!thisBlockLocalNames.has(l.name), l.loc, function () {
							return 'A local ' + (0, _CompileError.code)(l.name) + ' is already in this block.';
						});
						shadowed.set(l.name, got);
					}
					locals.set(l.name, l);
					thisBlockLocalNames.add(l.name);
				});
				if (line instanceof _Expression.BagEntry || line instanceof _Expression.MapEntry) {
					setEntryIndex(line, listMapLength);
					listMapLength = listMapLength + 1;
				}
				line.verify();
			}
		};

		plusPendingBlockLocals(newLocals, function () {
			return lines.forEach(verifyLine);
		});

		newLocals.forEach(function (l) {
			const s = shadowed.get(l.name);
			if (s === undefined) locals.delete(l.name);else locals.set(l.name, s);
		});

		return { newLocals: newLocals, listMapLength: listMapLength };
	},
	      verifyIsStatement = function (line) {
		const isStatement = line instanceof _Expression.Do || line instanceof _Expression.Call || line instanceof _Expression.Yield || line instanceof _Expression.YieldTo || line instanceof _Expression.BagEntry || line instanceof _Expression.MapEntry || line instanceof _Expression.SpecialDo;
		cx.check(isStatement, line.loc, 'Expression in statement position.');
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1ldGEvY29tcGlsZS9wcml2YXRlL3ZlcmlmeS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7a0JBaUh3QixNQUFNOzs7Ozs7OztBQTFHOUIsT0FBTSxFQUFFLEdBQUcsVUFBQSxFQUFFO1NBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7VUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFO0dBQUEsQ0FBQztFQUFBLENBQUE7QUFDNUMsT0FBTSxHQUFHLEdBQUcsVUFBQSxFQUFFO1NBQUksVUFKbUQsTUFBTSxFQUlsRCxFQUFFLEVBQUUsVUFBQSxDQUFDO1VBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRTtHQUFBLENBQUM7RUFBQSxDQUFBOztBQUU3QyxLQUNDLEVBQUUsRUFDRixNQUFNOzs7QUFHTixtQkFBa0IsRUFDbEIsU0FBUyxFQUNULGFBQWEsRUFDYixNQUFNLEVBQ04sRUFBRSxDQUFBOztBQUVILE9BQ0MsSUFBSSxHQUFHLFVBQUEsR0FBRyxFQUFJO0FBQ2IsSUFBRSxHQUFHLEdBQUcsQ0FBQTtBQUNSLFFBQU0sR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFBO0FBQ2xCLG9CQUFrQixHQUFHLEVBQUUsQ0FBQTtBQUN2QixXQUFTLEdBQUcsS0FBSyxDQUFBO0FBQ2pCLGVBQWEsR0FBRyxLQUFLLENBQUE7QUFDckIsUUFBTSxHQUFHLElBQUksQ0FBQTtBQUNiLElBQUUsR0FBRyxxQkFBbUIsQ0FBQTtFQUN4Qjs7O0FBRUQsT0FBTSxHQUFHLFlBQU07QUFDZCxRQUFNLEdBQUcsa0JBQWtCLEdBQUcsTUFBTSxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUE7RUFDckQ7T0FFRCxlQUFlLEdBQUcsVUFBQyxjQUFjLEVBQUUsR0FBRyxFQUFLO0FBQzFDLFFBQU0sQ0FBQyxHQUFHLGFBQWEsQ0FBQTtBQUN2QixlQUFhLEdBQUcsY0FBYyxDQUFBO0FBQzlCLEtBQUcsRUFBRSxDQUFBO0FBQ0wsZUFBYSxHQUFHLENBQUMsQ0FBQTtFQUNqQjtPQUVELFVBQVUs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QixDQUFBO0FBQzFCLElBQUUsQ0FBQyxLQUFLLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsbUNBQW1DLENBQUMsQ0FBQTtFQUNwRSxDQUFBIiwiZmlsZSI6Im1ldGEvY29tcGlsZS9wcml2YXRlL3ZlcmlmeS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvZGUgfSBmcm9tICcuLi9Db21waWxlRXJyb3InXG5pbXBvcnQgKiBhcyBFRXhwb3J0cyBmcm9tICcuLi9FeHByZXNzaW9uJ1xuaW1wb3J0IHsgQXNzaWduLCBBc3NpZ25EZXN0cnVjdHVyZSwgQmxvY2tWYWwsIENhbGwsIERlYnVnLCBEbywgQmFnRW50cnksXG5cdExvY2FsRGVjbGFyZVJlcywgTWFwRW50cnksIFBhdHRlcm4sIFNwZWNpYWxEbywgWWllbGQsIFlpZWxkVG8gfSBmcm9tICcuLi9FeHByZXNzaW9uJ1xuaW1wb3J0IHsgY2F0LCBoZWFkLCBpZkVsc2UsIGltcGxlbWVudE1hbnksIGlzRW1wdHksIG1hcEtleXMsIG5ld1NldCwgb3BFYWNoIH0gZnJvbSAnLi91dGlsJ1xuaW1wb3J0IFZlcmlmeVJlc3VsdHMsIHsgTG9jYWxJbmZvIH0gZnJvbSAnLi9WZXJpZnlSZXN1bHRzJ1xuXG5jb25zdCB2bSA9IGVzID0+IGVzLmZvckVhY2goZSA9PiBlLnZlcmlmeSgpKVxuY29uc3Qgdm9wID0gb3AgPT4gb3BFYWNoKG9wLCBfID0+IF8udmVyaWZ5KCkpXG5cbmxldFxuXHRjeCxcblx0bG9jYWxzLFxuXHQvLyBMb2NhbHMgZm9yIHRoaXMgYmxvY2suXG5cdC8vIFJlcGxhY2VzIGBsb2NhbHNgIHdoZW4gZW50ZXJpbmcgaW50byBzdWItZnVuY3Rpb24uXG5cdHBlbmRpbmdCbG9ja0xvY2Fscyxcblx0aXNJbkRlYnVnLFxuXHRpc0luR2VuZXJhdG9yLFxuXHRvcExvb3AsXG5cdHZyXG5cbmNvbnN0XG5cdGluaXQgPSBfY3ggPT4ge1xuXHRcdGN4ID0gX2N4XG5cdFx0bG9jYWxzID0gbmV3IE1hcCgpXG5cdFx0cGVuZGluZ0Jsb2NrTG9jYWxzID0gW11cblx0XHRpc0luRGVidWcgPSBmYWxzZVxuXHRcdGlzSW5HZW5lcmF0b3IgPSBmYWxzZVxuXHRcdG9wTG9vcCA9IG51bGxcblx0XHR2ciA9IG5ldyBWZXJpZnlSZXN1bHRzKClcblx0fSxcblx0Ly8gUmVsZWFzZSBmb3IgZ2FyYmFnZSBjb2xsZWN0aW9uXG5cdHVuaW5pdCA9ICgpID0+IHtcblx0XHRsb2NhbHMgPSBwZW5kaW5nQmxvY2tMb2NhbHMgPSBvcExvb3AgPSB2ciA9IHVuZGVmaW5lZFxuXHR9LFxuXG5cdHdpdGhJbkdlbmVyYXRvciA9IChfaXNJbkdlbmVyYXRvciwgZnVuKSA9PiB7XG5cdFx0Y29uc3QgZyA9IGlzSW5HZW5lcmF0b3Jcblx0XHRpc0luR2VuZXJhdG9yID0gX2lzSW5HZW5lcmF0b3Jcblx0XHRmdW4oKVxuXHRcdGlzSW5HZW5lcmF0b3IgPSBnXG5cdH0sXG5cblx0cGx1c0xvY2FscyA9IChhZGRlZExvY2FscywgZnVuKSA9PiB7XG5cdFx0Y29uc3Qgc2hhZG93ZWQgPSBuZXcgTWFwKClcblx0XHRhZGRlZExvY2Fscy5mb3JFYWNoKGwgPT4ge1xuXHRcdFx0Y29uc3QgZ290ID0gbG9jYWxzLmdldChsLm5hbWUpXG5cdFx0XHRpZiAoZ290ICE9PSB1bmRlZmluZWQpXG5cdFx0XHRcdHNoYWRvd2VkLnNldChsLm5hbWUsIGdvdClcblx0XHRcdGxvY2Fscy5zZXQobC5uYW1lLCBsKVxuXHRcdH0pXG5cdFx0ZnVuKClcblx0XHRhZGRlZExvY2Fscy5mb3JFYWNoKGwgPT4ge1xuXHRcdFx0Y29uc3QgcyA9IHNoYWRvd2VkLmdldChsLm5hbWUpXG5cdFx0XHRpZiAocyA9PT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRsb2NhbHMuZGVsZXRlKGwubmFtZSlcblx0XHRcdGVsc2Vcblx0XHRcdFx0bG9jYWxzLnNldChsLm5hbWUsIHMpXG5cdFx0fSlcblx0fSxcblxuXHRwbHVzUGVuZGluZ0Jsb2NrTG9jYWxzID0gKHBlbmRpbmcsIGZ1bikgPT4ge1xuXHRcdGNvbnN0IG9sZExlbmd0aCA9IHBlbmRpbmdCbG9ja0xvY2Fscy5sZW5ndGhcblx0XHRwZW5kaW5nQmxvY2tMb2NhbHMucHVzaCguLi5wZW5kaW5nKVxuXHRcdGZ1bigpXG5cdFx0d2hpbGUgKHBlbmRpbmdCbG9ja0xvY2Fscy5sZW5ndGggPiBvbGRMZW5ndGgpXG5cdFx0XHRwZW5kaW5nQmxvY2tMb2NhbHMucG9wKClcblx0fSxcblxuXHR3aXRoSW5Mb29wID0gKGxvb3AsIGZ1bikgPT4ge1xuXHRcdGNvbnN0IGwgPSBvcExvb3Bcblx0XHRvcExvb3AgPSBsb29wXG5cdFx0ZnVuKClcblx0XHRvcExvb3AgPSBsXG5cdH0sXG5cblx0d2l0aEluRGVidWcgPSAoX2lzSW5EZWJ1ZywgZnVuKSA9PiB7XG5cdFx0Y29uc3QgZCA9IGlzSW5EZWJ1Z1xuXHRcdGlzSW5EZWJ1ZyA9IF9pc0luRGVidWdcblx0XHRmdW4oKVxuXHRcdGlzSW5EZWJ1ZyA9IGRcblx0fSxcblxuXHR3aXRoQmxvY2tMb2NhbHMgPSBmdW4gPT4ge1xuXHRcdGNvbnN0IGJsID0gcGVuZGluZ0Jsb2NrTG9jYWxzXG5cdFx0cGVuZGluZ0Jsb2NrTG9jYWxzID0gW11cblx0XHRwbHVzTG9jYWxzKGJsLCBmdW4pXG5cdFx0cGVuZGluZ0Jsb2NrTG9jYWxzID0gYmxcblx0fSxcblxuXHRhY2Nlc3NMb2NhbCA9IChkZWNsYXJlLCBhY2Nlc3MsIGlzRGVidWdBY2Nlc3MpID0+XG5cdFx0X2FkZEFjY2Vzcyh2ci5sb2NhbFRvSW5mby5nZXQoZGVjbGFyZSksIGFjY2VzcywgaXNEZWJ1Z0FjY2VzcyksXG5cdGFjY2Vzc0xvY2FsRm9yUmV0dXJuID0gKGRlY2xhcmUsIGFjY2VzcykgPT4ge1xuXHRcdGNvbnN0IGluZm8gPSB2ci5sb2NhbFRvSW5mby5nZXQoZGVjbGFyZSlcblx0XHRfYWRkQWNjZXNzKGluZm8sIGFjY2VzcywgaW5mby5pc0luRGVidWcpXG5cdH0sXG5cdF9hZGRBY2Nlc3MgPSAobG9jYWxJbmZvLCBhY2Nlc3MsIGlzRGVidWdBY2Nlc3MpID0+XG5cdFx0KGlzRGVidWdBY2Nlc3MgPyBsb2NhbEluZm8uZGVidWdBY2Nlc3NlcyA6IGxvY2FsSW5mby5ub25EZWJ1Z0FjY2Vzc2VzKS5wdXNoKGFjY2VzcyksXG5cblxuXHQvLyBWciBzZXR0ZXJzXG5cdHNldEVuZExvb3AgPSAoZW5kTG9vcCwgbG9vcCkgPT4ge1xuXHRcdHZyLmVuZExvb3BUb0xvb3Auc2V0KGVuZExvb3AsIGxvb3ApXG5cdH0sXG5cblx0cmVnaXN0ZXJMb2NhbCA9IGxvY2FsID0+IHtcblx0XHR2ci5sb2NhbFRvSW5mby5zZXQobG9jYWwsIExvY2FsSW5mbyhpc0luRGVidWcsIFtdLCBbXSkpXG5cdH0sXG5cblx0c2V0RW50cnlJbmRleCA9IChsaXN0TWFwRW50cnksIGluZGV4KSA9PiB7XG5cdFx0dnIuZW50cnlUb0luZGV4LnNldChsaXN0TWFwRW50cnksIGluZGV4KVxuXHR9XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHZlcmlmeShjeCwgZSkge1xuXHRpbml0KGN4KVxuXHRlLnZlcmlmeSgpXG5cdHZlcmlmeUxvY2FsVXNlKClcblx0Y29uc3Qgb3V0ID0gdnJcblx0dW5pbml0KClcblx0cmV0dXJuIG91dFxufVxuXG5jb25zdCB2ZXJpZnlMb2NhbFVzZSA9ICgpID0+IHtcblx0dnIubG9jYWxUb0luZm8uZm9yRWFjaCgoaW5mbywgbG9jYWwpID0+IHtcblx0XHRpZiAoIShsb2NhbCBpbnN0YW5jZW9mIExvY2FsRGVjbGFyZVJlcykpIHtcblx0XHRcdGNvbnN0IG5vTm9uRGVidWcgPSBpc0VtcHR5KGluZm8ubm9uRGVidWdBY2Nlc3Nlcylcblx0XHRcdGlmIChub05vbkRlYnVnICYmIGlzRW1wdHkoaW5mby5kZWJ1Z0FjY2Vzc2VzKSlcblx0XHRcdFx0Y3gud2Fybihsb2NhbC5sb2MsICgpID0+IGBVbnVzZWQgbG9jYWwgdmFyaWFibGUgJHtjb2RlKGxvY2FsLm5hbWUpfS5gKVxuXHRcdFx0ZWxzZSBpZiAoaW5mby5pc0luRGVidWcpXG5cdFx0XHRcdGN4Lndhcm5JZighbm9Ob25EZWJ1ZywgKCkgPT4gaGVhZChpbmZvLm5vbkRlYnVnQWNjZXNzZXMpLmxvYywgKCkgPT5cblx0XHRcdFx0XHRgRGVidWctb25seSBsb2NhbCAke2NvZGUobG9jYWwubmFtZSl9IHVzZWQgb3V0c2lkZSBvZiBkZWJ1Zy5gKVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRjeC53YXJuSWYobm9Ob25EZWJ1ZywgbG9jYWwubG9jLCAoKSA9PlxuXHRcdFx0XHRcdGBMb2NhbCAke2NvZGUobG9jYWwubmFtZSl9IHVzZWQgb25seSBpbiBkZWJ1Zy5gKVxuXHRcdH1cblx0fSlcbn1cblxuaW1wbGVtZW50TWFueShFRXhwb3J0cywgJ3ZlcmlmeScsIHtcblx0QXNzaWduKCkge1xuXHRcdGNvbnN0IGRvViA9ICgpID0+IHtcblx0XHRcdHRoaXMuYXNzaWduZWUudmVyaWZ5KClcblx0XHRcdHRoaXMudmFsdWUudmVyaWZ5KClcblx0XHR9XG5cdFx0aWYgKHRoaXMuYXNzaWduZWUuaXNMYXp5KCkpXG5cdFx0XHR3aXRoQmxvY2tMb2NhbHMoZG9WKVxuXHRcdGVsc2Vcblx0XHRcdGRvVigpXG5cdH0sXG5cblx0QXNzaWduRGVzdHJ1Y3R1cmUoKSB7XG5cdFx0dGhpcy52YWx1ZS52ZXJpZnkoKVxuXHRcdHZtKHRoaXMuYXNzaWduZWVzKVxuXHR9LFxuXG5cdEFzc2lnbk11dGF0ZSgpIHtcblx0XHRjb25zdCBkZWNsYXJlID0gZ2V0TG9jYWxEZWNsYXJlKHRoaXMubmFtZSwgdGhpcy5sb2MpXG5cdFx0Y3guY2hlY2soZGVjbGFyZS5pc011dGFibGUoKSwgdGhpcy5sb2MsICgpID0+IGAke2NvZGUodGhpcy5uYW1lKX0gaXMgbm90IG11dGFibGUuYClcblx0XHQvLyBUT0RPOiBUcmFjayBhc3NpZ25tZW50cy4gTXV0YWJsZSBsb2NhbCBtdXN0IGJlIG11dGF0ZWQgc29tZXdoZXJlLlxuXHRcdHRoaXMudmFsdWUudmVyaWZ5KClcblx0fSxcblxuXHRCYWdFbnRyeSgpIHsgdGhpcy52YWx1ZS52ZXJpZnkoKSB9LFxuXG5cdEJhZ1NpbXBsZSgpIHsgdm0odGhpcy5wYXJ0cykgfSxcblxuXHRCbG9ja0RvKCkgeyB2ZXJpZnlMaW5lcyh0aGlzLmxpbmVzKSB9LFxuXG5cdEJsb2NrV2l0aFJldHVybigpIHtcblx0XHRjb25zdCB7IG5ld0xvY2FscyB9ID0gdmVyaWZ5TGluZXModGhpcy5saW5lcylcblx0XHRwbHVzTG9jYWxzKG5ld0xvY2FscywgKCkgPT4gdGhpcy5yZXR1cm5lZC52ZXJpZnkoKSlcblx0fSxcblxuXHRCbG9ja09iaigpIHtcblx0XHRjb25zdCB7IG5ld0xvY2FscyB9ID0gdmVyaWZ5TGluZXModGhpcy5saW5lcylcblx0XHR0aGlzLmtleXMuZm9yRWFjaChfID0+IGFjY2Vzc0xvY2FsRm9yUmV0dXJuKF8sIHRoaXMpKVxuXHRcdG9wRWFjaCh0aGlzLm9wT2JqZWQsIF8gPT4gcGx1c0xvY2FscyhuZXdMb2NhbHMsICgpID0+IF8udmVyaWZ5KCkpKVxuXHR9LFxuXG5cdEJsb2NrQmFnOiBibG9ja0JhZ09yTWFwLFxuXHRCbG9ja01hcDogYmxvY2tCYWdPck1hcCxcblxuXHRCbG9ja1dyYXAoKSB7XG5cdFx0dGhpcy5ibG9jay52ZXJpZnkoKVxuXHR9LFxuXG5cdENhbGwoKSB7XG5cdFx0dGhpcy5jYWxsZWQudmVyaWZ5KClcblx0XHR2bSh0aGlzLmFyZ3MpXG5cdH0sXG5cblx0Q2FzZURvOiB2ZXJpZnlDYXNlLFxuXHRDYXNlRG9QYXJ0OiB2ZXJpZnlDYXNlUGFydCxcblx0Q2FzZVZhbDogdmVyaWZ5Q2FzZSxcblx0Q2FzZVZhbFBhcnQ6IHZlcmlmeUNhc2VQYXJ0LFxuXG5cdC8vIE9ubHkgcmVhY2ggaGVyZSBmb3IgaW4vb3V0IGNvbmRpdGlvblxuXHREZWJ1ZygpIHsgdmVyaWZ5TGluZXMoWyB0aGlzIF0pIH0sXG5cblx0RW5kTG9vcCgpIHtcblx0XHRpZkVsc2Uob3BMb29wLCBfID0+IHNldEVuZExvb3AodGhpcywgXyksICgpID0+IGN4LmZhaWwodGhpcy5sb2MsICdOb3QgaW4gYSBsb29wLicpKVxuXHR9LFxuXG5cdEZ1bigpIHtcblx0XHR3aXRoQmxvY2tMb2NhbHMoKCkgPT4ge1xuXHRcdFx0Y3guY2hlY2sodGhpcy5vcFJlc0RlY2xhcmUgPT09IG51bGwgfHwgdGhpcy5ibG9jayBpbnN0YW5jZW9mIEJsb2NrVmFsLCB0aGlzLmxvYyxcblx0XHRcdFx0J0Z1bmN0aW9uIHdpdGggcmV0dXJuIGNvbmRpdGlvbiBtdXN0IHJldHVybiBzb21ldGhpbmcuJylcblx0XHRcdHRoaXMuYXJncy5mb3JFYWNoKGFyZyA9PiB2b3AoYXJnLm9wVHlwZSkpXG5cdFx0XHR3aXRoSW5HZW5lcmF0b3IodGhpcy5pc0dlbmVyYXRvciwgKCkgPT4ge1xuXHRcdFx0XHRjb25zdCBhbGxBcmdzID0gY2F0KHRoaXMuYXJncywgdGhpcy5vcFJlc3RBcmcpXG5cdFx0XHRcdGFsbEFyZ3MuZm9yRWFjaChfID0+IHJlZ2lzdGVyTG9jYWwoXykpXG5cdFx0XHRcdHBsdXNMb2NhbHMoYWxsQXJncywgKCkgPT4ge1xuXHRcdFx0XHRcdHZvcCh0aGlzLm9wSW4pXG5cdFx0XHRcdFx0dGhpcy5ibG9jay52ZXJpZnkoKVxuXHRcdFx0XHRcdG9wRWFjaCh0aGlzLm9wUmVzRGVjbGFyZSwgXyA9PiB7XG5cdFx0XHRcdFx0XHRfLnZlcmlmeSgpXG5cdFx0XHRcdFx0XHRyZWdpc3RlckxvY2FsKF8pXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRjb25zdCB2ZXJpZnlPdXQgPSAoKSA9PiBvcEVhY2godGhpcy5vcE91dCwgXyA9PiBfLnZlcmlmeSgpKVxuXHRcdFx0XHRcdGlmRWxzZSh0aGlzLm9wUmVzRGVjbGFyZSwgcmQgPT4gcGx1c0xvY2FscyhbIHJkIF0sIHZlcmlmeU91dCksIHZlcmlmeU91dClcblx0XHRcdFx0fSlcblx0XHRcdH0pXG5cdFx0fSlcblx0fSxcblxuXHRHbG9iYWxBY2Nlc3MoKSB7IH0sXG5cblx0SWZEbygpIHtcblx0XHR0aGlzLnRlc3QudmVyaWZ5KClcblx0XHR0aGlzLnJlc3VsdC52ZXJpZnkoKVxuXHR9LFxuXG5cdExhenkoKSB7IHdpdGhCbG9ja0xvY2FscygoKSA9PiB0aGlzLnZhbHVlLnZlcmlmeSgpKSB9LFxuXG5cdExvY2FsQWNjZXNzKCkge1xuXHRcdGNvbnN0IGRlY2xhcmUgPSBnZXRMb2NhbERlY2xhcmUodGhpcy5uYW1lLCB0aGlzLmxvYylcblx0XHR2ci5hY2Nlc3NUb0xvY2FsLnNldCh0aGlzLCBkZWNsYXJlKVxuXHRcdGFjY2Vzc0xvY2FsKGRlY2xhcmUsIHRoaXMsIGlzSW5EZWJ1Zylcblx0fSxcblxuXHRMb29wKCkgeyB3aXRoSW5Mb29wKHRoaXMsICgpID0+IHRoaXMuYmxvY2sudmVyaWZ5KCkpIH0sXG5cblx0Ly8gQWRkaW5nIExvY2FsRGVjbGFyZXMgdG8gdGhlIGF2YWlsYWJsZSBsb2NhbHMgaXMgZG9uZSBieSBGdW4gb3IgbGluZU5ld0xvY2Fscy5cblx0TG9jYWxEZWNsYXJlKCkgeyB2b3AodGhpcy5vcFR5cGUpIH0sXG5cblx0TnVtYmVyTGl0ZXJhbCgpIHsgfSxcblxuXHRNYXBFbnRyeSgpIHtcblx0XHR0aGlzLmtleS52ZXJpZnkoKVxuXHRcdHRoaXMudmFsLnZlcmlmeSgpXG5cdH0sXG5cblx0TWVtYmVyKCkgeyB0aGlzLm9iamVjdC52ZXJpZnkoKSB9LFxuXG5cdE1vZHVsZSgpIHtcblx0XHQvLyBObyBuZWVkIHRvIHZlcmlmeSB0aGlzLmRvVXNlcy5cblx0XHRjb25zdCB1c2VMb2NhbHMgPSB2ZXJpZnlVc2VzKHRoaXMudXNlcywgdGhpcy5kZWJ1Z1VzZXMpXG5cdFx0cGx1c0xvY2Fscyh1c2VMb2NhbHMsICgpID0+IHtcblx0XHRcdGNvbnN0IHsgbmV3TG9jYWxzIH0gPSB2ZXJpZnlMaW5lcyh0aGlzLmxpbmVzKVxuXHRcdFx0dGhpcy5leHBvcnRzLmZvckVhY2goZXggPT4gYWNjZXNzTG9jYWxGb3JSZXR1cm4oZXgsIHRoaXMpKVxuXHRcdFx0b3BFYWNoKHRoaXMub3BEZWZhdWx0RXhwb3J0LCBfID0+IHBsdXNMb2NhbHMobmV3TG9jYWxzLCAoKSA9PiBfLnZlcmlmeSgpKSlcblx0XHR9KVxuXG5cdFx0Y29uc3QgZXhwb3J0cyA9IG5ld1NldCh0aGlzLmV4cG9ydHMpXG5cdFx0Y29uc3QgbWFya0V4cG9ydExpbmVzID0gbGluZSA9PiB7XG5cdFx0XHRpZiAobGluZSBpbnN0YW5jZW9mIEFzc2lnbiAmJiBleHBvcnRzLmhhcyhsaW5lLmFzc2lnbmVlKSB8fFxuXHRcdFx0XHRsaW5lIGluc3RhbmNlb2YgQXNzaWduRGVzdHJ1Y3R1cmUgJiYgbGluZS5hc3NpZ25lZXMuc29tZShfID0+IGV4cG9ydHMuaGFzKF8pKSlcblx0XHRcdFx0dnIuZXhwb3J0QXNzaWducy5hZGQobGluZSlcblx0XHRcdGVsc2UgaWYgKGxpbmUgaW5zdGFuY2VvZiBEZWJ1Zylcblx0XHRcdFx0bGluZS5saW5lcy5mb3JFYWNoKG1hcmtFeHBvcnRMaW5lcylcblx0XHR9XG5cdFx0dGhpcy5saW5lcy5mb3JFYWNoKG1hcmtFeHBvcnRMaW5lcylcblx0fSxcblxuXHRPYmpTaW1wbGUoKSB7XG5cdFx0Y29uc3Qga2V5cyA9IG5ldyBTZXQoKVxuXHRcdHRoaXMucGFpcnMuZm9yRWFjaChwYWlyID0+IHtcblx0XHRcdGN4LmNoZWNrKCFrZXlzLmhhcyhwYWlyLmtleSksIHBhaXIubG9jLCAoKSA9PiBgRHVwbGljYXRlIGtleSAke3BhaXIua2V5fWApXG5cdFx0XHRrZXlzLmFkZChwYWlyLmtleSlcblx0XHRcdHBhaXIudmFsdWUudmVyaWZ5KClcblx0XHR9KVxuXHR9LFxuXG5cdFF1b3RlKCkge1xuXHRcdHRoaXMucGFydHMuZm9yRWFjaChfID0+IHtcblx0XHRcdGlmICh0eXBlb2YgXyAhPT0gJ3N0cmluZycpXG5cdFx0XHRcdF8udmVyaWZ5KClcblx0XHR9KVxuXHR9LFxuXG5cdFNwZWNpYWxEbygpIHsgfSxcblxuXHRTcGVjaWFsVmFsKCkgeyB9LFxuXG5cdFNwbGF0KCkgeyB0aGlzLnNwbGF0dGVkLnZlcmlmeSgpIH0sXG5cblx0WWllbGQoKSB7XG5cdFx0Y3guY2hlY2soaXNJbkdlbmVyYXRvciwgdGhpcy5sb2MsICdDYW5ub3QgeWllbGQgb3V0c2lkZSBvZiBnZW5lcmF0b3IgY29udGV4dCcpXG5cdFx0dGhpcy55aWVsZGVkLnZlcmlmeSgpXG5cdH0sXG5cblx0WWllbGRUbygpIHtcblx0XHRjeC5jaGVjayhpc0luR2VuZXJhdG9yLCB0aGlzLmxvYywgJ0Nhbm5vdCB5aWVsZCBvdXRzaWRlIG9mIGdlbmVyYXRvciBjb250ZXh0Jylcblx0XHR0aGlzLnlpZWxkZWRUby52ZXJpZnkoKVxuXHR9XG59KVxuXG5mdW5jdGlvbiBibG9ja0JhZ09yTWFwKCkge1xuXHRjb25zdCB7IGxpc3RNYXBMZW5ndGggfSA9IHZlcmlmeUxpbmVzKHRoaXMubGluZXMpXG5cdHZyLmJsb2NrVG9MZW5ndGguc2V0KHRoaXMsIGxpc3RNYXBMZW5ndGgpXG59XG5cbmZ1bmN0aW9uIHZlcmlmeUNhc2UoKSB7XG5cdGNvbnN0IG5ld0xvY2FscyA9IFtdXG5cdG9wRWFjaCh0aGlzLm9wQ2FzZWQsIF8gPT4ge1xuXHRcdHJlZ2lzdGVyTG9jYWwoXy5hc3NpZ25lZSlcblx0XHRfLnZlcmlmeSgpXG5cdFx0bmV3TG9jYWxzLnB1c2goXy5hc3NpZ25lZSlcblx0fSlcblx0cGx1c0xvY2FscyhuZXdMb2NhbHMsICgpID0+IHtcblx0XHR2bSh0aGlzLnBhcnRzKVxuXHRcdHZvcCh0aGlzLm9wRWxzZSlcblx0fSlcbn1cblxuZnVuY3Rpb24gdmVyaWZ5Q2FzZVBhcnQoKSB7XG5cdGlmICh0aGlzLnRlc3QgaW5zdGFuY2VvZiBQYXR0ZXJuKSB7XG5cdFx0dGhpcy50ZXN0LnR5cGUudmVyaWZ5KClcblx0XHR0aGlzLnRlc3QucGF0dGVybmVkLnZlcmlmeSgpXG5cdFx0dm0odGhpcy50ZXN0LmxvY2Fscylcblx0XHR0aGlzLnRlc3QubG9jYWxzLmZvckVhY2gocmVnaXN0ZXJMb2NhbClcblx0XHRwbHVzTG9jYWxzKHRoaXMudGVzdC5sb2NhbHMsICgpID0+IHRoaXMucmVzdWx0LnZlcmlmeSgpKVxuXHR9IGVsc2Uge1xuXHRcdHRoaXMudGVzdC52ZXJpZnkoKVxuXHRcdHRoaXMucmVzdWx0LnZlcmlmeSgpXG5cdH1cbn1cblxuY29uc3Rcblx0Z2V0TG9jYWxEZWNsYXJlID0gKG5hbWUsIGFjY2Vzc0xvYykgPT4ge1xuXHRcdGNvbnN0IGRlY2xhcmUgPSBsb2NhbHMuZ2V0KG5hbWUpXG5cdFx0Y3guY2hlY2soZGVjbGFyZSAhPT0gdW5kZWZpbmVkLCBhY2Nlc3NMb2MsICgpID0+XG5cdFx0XHRgTm8gc3VjaCBsb2NhbCAke2NvZGUobmFtZSl9LlxcbkxvY2FscyBhcmU6XFxuJHtjb2RlKG1hcEtleXMobG9jYWxzKS5qb2luKCcgJykpfS5gKVxuXHRcdHJldHVybiBkZWNsYXJlXG5cdH0sXG5cblx0bGluZU5ld0xvY2FscyA9IGxpbmUgPT5cblx0XHRsaW5lIGluc3RhbmNlb2YgQXNzaWduID9cblx0XHRcdFsgbGluZS5hc3NpZ25lZSBdIDpcblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBBc3NpZ25EZXN0cnVjdHVyZSA/XG5cdFx0XHRsaW5lLmFzc2lnbmVlcyA6XG5cdFx0XHRbIF0sXG5cblx0dmVyaWZ5VXNlcyA9ICh1c2VzLCBkZWJ1Z1VzZXMpID0+IHtcblx0XHRjb25zdCB1c2VMb2NhbHMgPSBbXVxuXHRcdGNvbnN0XG5cdFx0XHR2ZXJpZnlVc2UgPSB1c2UgPT4ge1xuXHRcdFx0XHR1c2UudXNlZC5mb3JFYWNoKHVzZUxvY2FsKVxuXHRcdFx0XHRvcEVhY2godXNlLm9wVXNlRGVmYXVsdCwgdXNlTG9jYWwpXG5cdFx0XHR9LFxuXHRcdFx0dXNlTG9jYWwgPSBfID0+IHtcblx0XHRcdFx0cmVnaXN0ZXJMb2NhbChfKVxuXHRcdFx0XHR1c2VMb2NhbHMucHVzaChfKVxuXHRcdFx0fVxuXHRcdHVzZXMuZm9yRWFjaCh2ZXJpZnlVc2UpXG5cdFx0d2l0aEluRGVidWcodHJ1ZSwgKCkgPT4gZGVidWdVc2VzLmZvckVhY2godmVyaWZ5VXNlKSlcblx0XHRyZXR1cm4gdXNlTG9jYWxzXG5cdH0sXG5cblx0dmVyaWZ5TGluZXMgPSBsaW5lcyA9PiB7XG5cdFx0Y29uc3QgbmV3TG9jYWxzID0gWyBdXG5cdFx0Ly8gRmlyc3QsIGdldCBsb2NhbHMgZm9yIHRoZSB3aG9sZSBibG9jay5cblx0XHRjb25zdCBnZXRMaW5lTG9jYWxzID0gbGluZSA9PiB7XG5cdFx0XHRpZiAobGluZSBpbnN0YW5jZW9mIERlYnVnKVxuXHRcdFx0XHR3aXRoSW5EZWJ1Zyh0cnVlLCAoKSA9PiBsaW5lLmxpbmVzLmZvckVhY2goZ2V0TGluZUxvY2FscykpXG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0Y29uc3QgbmV3cyA9IGxpbmVOZXdMb2NhbHMobGluZSlcblx0XHRcdFx0bmV3cy5mb3JFYWNoKHJlZ2lzdGVyTG9jYWwpXG5cdFx0XHRcdG5ld0xvY2Fscy5wdXNoKC4uLm5ld3MpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0bGluZXMuZm9yRWFjaChnZXRMaW5lTG9jYWxzKVxuXG5cdFx0Y29uc3QgdGhpc0Jsb2NrTG9jYWxOYW1lcyA9IG5ldyBTZXQoKVxuXHRcdGNvbnN0IHNoYWRvd2VkID0gbmV3IE1hcCgpXG5cblx0XHRsZXQgbGlzdE1hcExlbmd0aCA9IDBcblxuXHRcdGNvbnN0IHZlcmlmeUxpbmUgPSBsaW5lID0+IHtcblx0XHRcdGlmIChsaW5lIGluc3RhbmNlb2YgRGVidWcpXG5cdFx0XHRcdC8vIFRPRE86IERvIGFueXRoaW5nIGluIHRoaXMgc2l0dWF0aW9uP1xuXHRcdFx0XHQvLyBjeC5jaGVjayghaW5EZWJ1ZywgbGluZS5sb2MsICdSZWR1bmRhbnQgYGRlYnVnYC4nKVxuXHRcdFx0XHR3aXRoSW5EZWJ1Zyh0cnVlLCAoKSA9PiBsaW5lLmxpbmVzLmZvckVhY2godmVyaWZ5TGluZSkpXG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0dmVyaWZ5SXNTdGF0ZW1lbnQobGluZSlcblx0XHRcdFx0bGluZU5ld0xvY2FscyhsaW5lKS5mb3JFYWNoKGwgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IGdvdCA9IGxvY2Fscy5nZXQobC5uYW1lKVxuXHRcdFx0XHRcdGlmIChnb3QgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRcdFx0Y3guY2hlY2soIXRoaXNCbG9ja0xvY2FsTmFtZXMuaGFzKGwubmFtZSksIGwubG9jLFxuXHRcdFx0XHRcdFx0XHQoKSA9PiBgQSBsb2NhbCAke2NvZGUobC5uYW1lKX0gaXMgYWxyZWFkeSBpbiB0aGlzIGJsb2NrLmApXG5cdFx0XHRcdFx0XHRzaGFkb3dlZC5zZXQobC5uYW1lLCBnb3QpXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGxvY2Fscy5zZXQobC5uYW1lLCBsKVxuXHRcdFx0XHRcdHRoaXNCbG9ja0xvY2FsTmFtZXMuYWRkKGwubmFtZSlcblx0XHRcdFx0fSlcblx0XHRcdFx0aWYgKGxpbmUgaW5zdGFuY2VvZiBCYWdFbnRyeSB8fCBsaW5lIGluc3RhbmNlb2YgTWFwRW50cnkpIHtcblx0XHRcdFx0XHRzZXRFbnRyeUluZGV4KGxpbmUsIGxpc3RNYXBMZW5ndGgpXG5cdFx0XHRcdFx0bGlzdE1hcExlbmd0aCA9IGxpc3RNYXBMZW5ndGggKyAxXG5cdFx0XHRcdH1cblx0XHRcdFx0bGluZS52ZXJpZnkoKVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHBsdXNQZW5kaW5nQmxvY2tMb2NhbHMobmV3TG9jYWxzLCAoKSA9PiBsaW5lcy5mb3JFYWNoKHZlcmlmeUxpbmUpKVxuXG5cdFx0bmV3TG9jYWxzLmZvckVhY2gobCA9PiB7XG5cdFx0XHRjb25zdCBzID0gc2hhZG93ZWQuZ2V0KGwubmFtZSlcblx0XHRcdGlmIChzID09PSB1bmRlZmluZWQpXG5cdFx0XHRcdGxvY2Fscy5kZWxldGUobC5uYW1lKVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRsb2NhbHMuc2V0KGwubmFtZSwgcylcblx0XHR9KVxuXG5cdFx0cmV0dXJuIHsgbmV3TG9jYWxzLCBsaXN0TWFwTGVuZ3RoIH1cblx0fSxcblxuXHR2ZXJpZnlJc1N0YXRlbWVudCA9IGxpbmUgPT4ge1xuXHRcdGNvbnN0IGlzU3RhdGVtZW50ID1cblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBEbyB8fFxuXHRcdFx0bGluZSBpbnN0YW5jZW9mIENhbGwgfHxcblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBZaWVsZCB8fFxuXHRcdFx0bGluZSBpbnN0YW5jZW9mIFlpZWxkVG8gfHxcblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBCYWdFbnRyeSB8fFxuXHRcdFx0bGluZSBpbnN0YW5jZW9mIE1hcEVudHJ5IHx8XG5cdFx0XHRsaW5lIGluc3RhbmNlb2YgU3BlY2lhbERvXG5cdFx0Y3guY2hlY2soaXNTdGF0ZW1lbnQsIGxpbmUubG9jLCAnRXhwcmVzc2lvbiBpbiBzdGF0ZW1lbnQgcG9zaXRpb24uJylcblx0fVxuIl0sInNvdXJjZVJvb3QiOiIvc3JjIn0=