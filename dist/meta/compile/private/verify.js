if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module', '../CompileError', '../Expression', './U/Bag', './U/op', './U/util', './VerifyResults'], function (exports, module, _CompileError, _Expression, _UBag, _UOp, _UUtil, _VerifyResults) {
	'use strict';

	module.exports = verify;

	function _interopRequire(obj) { return obj && obj.__esModule ? obj['default'] : obj; }

	function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

	var _VerifyResults2 = _interopRequire(_VerifyResults);

	const vm = function (es) {
		return es.forEach(function (e) {
			return e.verify();
		});
	};
	const vop = function (op) {
		return _UOp.opEach(op, function (_) {
			return _.verify();
		});
	};

	let cx, locals,
	// Locals for this block.
	// Replaces `locals` when entering into sub-function.
	pendingBlockLocals, isInDebug, isInGenerator, opLoop, vr;

	const init = function (_cx) {
		cx = _cx;
		locals = new Map();
		pendingBlockLocals = [];
		isInDebug = false;
		isInGenerator = false;
		opLoop = null;
		vr = new _VerifyResults2();
	},
	     
	// Release for garbage collection
	uninit = function () {
		locals = pendingBlockLocals = opLoop = vr = undefined;
	},
	      withInGenerator = function (_isInGenerator, fun) {
		const g = isInGenerator;
		isInGenerator = _isInGenerator;
		fun();
		isInGenerator = g;
	},
	      plusLocals = function (addedLocals, fun) {
		const shadowed = new Map();
		addedLocals.forEach(function (l) {
			const got = locals.get(l.name);
			if (got !== undefined) shadowed.set(l.name, got);
			locals.set(l.name, l);
		});
		fun();
		addedLocals.forEach(function (l) {
			const s = shadowed.get(l.name);
			if (s === undefined) locals.delete(l.name);else locals.set(l.name, s);
		});
	},
	      plusPendingBlockLocals = function (pending, fun) {
		const oldLength = pendingBlockLocals.length;
		pendingBlockLocals.push.apply(pendingBlockLocals, _toConsumableArray(pending));
		fun();
		while (pendingBlockLocals.length > oldLength) pendingBlockLocals.pop();
	},
	      withInLoop = function (loop, fun) {
		const l = opLoop;
		opLoop = loop;
		fun();
		opLoop = l;
	},
	      withInDebug = function (_isInDebug, fun) {
		const d = isInDebug;
		isInDebug = _isInDebug;
		fun();
		isInDebug = d;
	},
	      withBlockLocals = function (fun) {
		const bl = pendingBlockLocals;
		pendingBlockLocals = [];
		plusLocals(bl, fun);
		pendingBlockLocals = bl;
	},
	      accessLocal = function (declare, access, isDebugAccess) {
		return _addAccess(vr.localToInfo.get(declare), access, isDebugAccess);
	},
	      accessLocalForReturn = function (declare, access) {
		const info = vr.localToInfo.get(declare);
		_addAccess(info, access, info.isInDebug);
	},
	      _addAccess = function (localInfo, access, isDebugAccess) {
		return (isDebugAccess ? localInfo.debugAccesses : localInfo.nonDebugAccesses).push(access);
	},
	     

	// Vr setters
	setEndLoop = function (endLoop, loop) {
		vr.endLoopToLoop.set(endLoop, loop);
	},
	      registerLocal = function (local) {
		vr.localToInfo.set(local, _VerifyResults.LocalInfo(isInDebug, [], []));
	},
	      setEntryIndex = function (listMapEntry, index) {
		vr.entryToIndex.set(listMapEntry, index);
	};

	function verify(cx, e) {
		init(cx);
		e.verify();
		verifyLocalUse();
		const out = vr;
		uninit();
		return out;
	}

	const verifyLocalUse = function () {
		vr.localToInfo.forEach(function (info, local) {
			if (!(local instanceof _Expression.LocalDeclareRes)) {
				const noNonDebug = _UBag.isEmpty(info.nonDebugAccesses);
				if (noNonDebug && _UBag.isEmpty(info.debugAccesses)) cx.warn(local.loc, function () {
					return 'Unused local variable ' + _CompileError.code(local.name) + '.';
				});else if (info.isInDebug) cx.warnIf(!noNonDebug, function () {
					return _UBag.head(info.nonDebugAccesses).loc;
				}, function () {
					return 'Debug-only local ' + _CompileError.code(local.name) + ' used outside of debug.';
				});else cx.warnIf(noNonDebug, local.loc, function () {
					return 'Local ' + _CompileError.code(local.name) + ' used only in debug.';
				});
			}
		});
	};

	_UUtil.implementMany(_Expression, 'verify', {
		Assign: function () {
			var _this = this;

			const doV = function () {
				_this.assignee.verify();
				_this.value.verify();
			};
			if (this.assignee.isLazy) withBlockLocals(doV);else doV();
		},
		BlockDo: function () {
			verifyLines(this.lines);
		},
		BlockWithReturn: function () {
			var _this2 = this;

			var _verifyLines = verifyLines(this.lines);

			const newLocals = _verifyLines.newLocals;

			plusLocals(newLocals, function () {
				return _this2.returned.verify();
			});
		},
		BlockObj: function () {
			var _this3 = this;

			var _verifyLines2 = verifyLines(this.lines);

			const newLocals = _verifyLines2.newLocals;

			this.keys.forEach(function (_) {
				return accessLocalForReturn(_, _this3);
			});
			_UOp.opEach(this.opObjed, function (_) {
				return plusLocals(newLocals, function () {
					return _.verify();
				});
			});
		},
		BlockBag: blockBagOrMap,
		BlockMap: blockBagOrMap,
		BlockWrap: function () {
			this.block.verify();
		},
		CaseDo: verifyCase,
		CaseVal: verifyCase,
		// Only reach here for in/out condition
		Debug: function () {
			verifyLines([this]);
		},
		EndLoop: function () {
			var _this4 = this;

			_UOp.ifElse(opLoop, function (_) {
				return setEndLoop(_this4, _);
			}, function () {
				return cx.fail(_this4.loc, 'Not in a loop.');
			});
		},
		Fun: function () {
			var _this5 = this;

			withBlockLocals(function () {
				cx.check(_this5.opResDeclare === null || _this5.block instanceof _Expression.BlockVal, _this5.loc, 'Function with return condition must return something.');
				_this5.args.forEach(function (arg) {
					return vop(arg.opType);
				});
				withInGenerator(_this5.isGenerator, function () {
					const allArgs = _UBag.cat(_this5.args, _this5.opRestArg);
					allArgs.forEach(function (_) {
						return registerLocal(_);
					});
					plusLocals(allArgs, function () {
						vop(_this5.opIn);
						_this5.block.verify();
						_UOp.opEach(_this5.opResDeclare, function (_) {
							_.verify();
							registerLocal(_);
						});
						const verifyOut = function () {
							return _UOp.opEach(_this5.opOut, function (_) {
								return _.verify();
							});
						};
						_UOp.ifElse(_this5.opResDeclare, function (rd) {
							return plusLocals([rd], verifyOut);
						}, verifyOut);
					});
				});
			});
		},
		LocalAccess: function () {
			var _this6 = this;

			const declare = locals.get(this.name);
			cx.check(declare !== undefined, this.loc, function () {
				return 'No such local ' + _CompileError.code(_this6.name) + '.\nLocals are:\n' + _CompileError.code(_UUtil.mapKeys(locals).join(' ')) + '.';
			});
			vr.accessToLocal.set(this, declare);
			accessLocal(declare, this, isInDebug);
		},
		Loop: function () {
			var _this7 = this;

			withInLoop(this, function () {
				return _this7.block.verify();
			});
		},
		// Adding LocalDeclares to the available locals is done by Fun or lineNewLocals.
		LocalDeclare: function () {
			vop(this.opType);
		},
		MapEntry: function () {
			this.key.verify();
			this.val.verify();
		},
		Module: function () {
			var _this8 = this;

			const useLocals = verifyUses(this.uses, this.debugUses);
			plusLocals(useLocals, function () {
				var _verifyLines3 = verifyLines(_this8.lines);

				const newLocals = _verifyLines3.newLocals;

				_this8.exports.forEach(function (ex) {
					return accessLocalForReturn(ex, _this8);
				});
				_UOp.opEach(_this8.opDefaultExport, function (_) {
					return plusLocals(newLocals, function () {
						return _.verify();
					});
				});
			});

			const exports = _UUtil.newSet(this.exports);
			const markExportLines = function (line) {
				if (line instanceof _Expression.Assign && exports.has(line.assignee) || line instanceof _Expression.AssignDestructure && line.assignees.some(function (_) {
					return exports.has(_);
				})) vr.exportAssigns.add(line);else if (line instanceof _Expression.Debug) line.lines.forEach(markExportLines);
			};
			this.lines.forEach(markExportLines);
		},
		Yield: function () {
			cx.check(isInGenerator, this.loc, 'Cannot yield outside of generator context');
			this.yielded.verify();
		},
		YieldTo: function () {
			cx.check(isInGenerator, this.loc, 'Cannot yield outside of generator context');
			this.yieldedTo.verify();
		},

		// These ones just recurse to their children.
		AssignDestructure: function () {
			this.value.verify();
			vm(this.assignees);
		},
		Call: function () {
			this.called.verify();
			vm(this.args);
		},
		CaseDoPart: verifyCasePart,
		CaseValPart: verifyCasePart,
		GlobalAccess: function () {},
		ObjSimple: function () {
			const keys = new Set();
			this.pairs.forEach(function (pair) {
				cx.check(!keys.has(pair.key), pair.loc, function () {
					return 'Duplicate key ' + pair.key;
				});
				keys.add(pair.key);
				pair.value.verify();
			});
		},
		Lazy: function () {
			var _this9 = this;

			withBlockLocals(function () {
				return _this9.value.verify();
			});
		},
		BagEntry: function () {
			this.value.verify();
		},
		ListSimple: function () {
			vm(this.parts);
		},
		NumberLiteral: function () {},
		Member: function () {
			this.object.verify();
		},
		Quote: function () {
			this.parts.forEach(function (_) {
				if (typeof _ !== 'string') _.verify();
			});
		},
		Special: function () {},
		Splat: function () {
			this.splatted.verify();
		}
	});

	function blockBagOrMap() {
		var _verifyLines4 = verifyLines(this.lines);

		const listMapLength = _verifyLines4.listMapLength;

		vr.blockToLength.set(this, listMapLength);
	}

	function verifyCase() {
		var _this10 = this;

		const newLocals = [];
		_UOp.opEach(this.opCased, function (_) {
			registerLocal(_.assignee);
			_.verify();
			newLocals.push(_.assignee);
		});
		plusLocals(newLocals, function () {
			vm(_this10.parts);
			vop(_this10.opElse);
		});
	}

	function verifyCasePart() {
		var _this11 = this;

		if (this.test instanceof _Expression.Pattern) {
			this.test.type.verify();
			this.test.patterned.verify();
			vm(this.test.locals);
			this.test.locals.forEach(registerLocal);
			plusLocals(this.test.locals, function () {
				return _this11.result.verify();
			});
		} else {
			this.test.verify();
			this.result.verify();
		}
	}

	const verifyUses = function (uses, debugUses) {
		const useLocals = [];
		const verifyUse = function (use) {
			use.used.forEach(useLocal);
			_UOp.opEach(use.opUseDefault, useLocal);
		},
		      useLocal = function (_) {
			registerLocal(_);
			useLocals.push(_);
		};
		uses.forEach(function (use) {
			if (!(use instanceof _Expression.UseDo)) verifyUse(use);
		});
		withInDebug(true, function () {
			return debugUses.forEach(verifyUse);
		});
		return useLocals;
	},
	      verifyLines = function (lines) {
		const newLocals = [];
		// First, get locals for the whole block.
		const getLineLocals = function (line) {
			if (line instanceof _Expression.Debug) withInDebug(true, function () {
				return line.lines.forEach(getLineLocals);
			});else {
				const news = lineNewLocals(line);
				news.forEach(registerLocal);
				newLocals.push.apply(newLocals, _toConsumableArray(news));
			}
		};

		lines.forEach(getLineLocals);

		const thisBlockLocalNames = new Set();
		const shadowed = new Map();

		let listMapLength = 0;

		const verifyLine = function (line) {
			if (line instanceof _Expression.Debug)
				// TODO: Do anything in this situation?
				// cx.check(!inDebug, line.loc, 'Redundant `debug`.')
				withInDebug(true, function () {
					return line.lines.forEach(verifyLine);
				});else {
				verifyIsStatement(line);
				lineNewLocals(line).forEach(function (l) {
					const got = locals.get(l.name);
					if (got !== undefined) {
						cx.check(!thisBlockLocalNames.has(l.name), l.loc, function () {
							return 'A local ' + _CompileError.code(l.name) + ' is already in this block.';
						});
						shadowed.set(l.name, got);
					}
					locals.set(l.name, l);
					thisBlockLocalNames.add(l.name);
				});
				if (line instanceof _Expression.BagEntry || line instanceof _Expression.MapEntry) {
					setEntryIndex(line, listMapLength);
					listMapLength = listMapLength + 1;
				}
				line.verify();
			}
		};

		plusPendingBlockLocals(newLocals, function () {
			return lines.forEach(verifyLine);
		});

		newLocals.forEach(function (l) {
			const s = shadowed.get(l.name);
			if (s === undefined) locals.delete(l.name);else locals.set(l.name, s);
		});

		return { newLocals: newLocals, listMapLength: listMapLength };
	},
	      verifyIsStatement = function (line) {
		const isStatement = line instanceof _Expression.Do || line instanceof _Expression.Call || line instanceof _Expression.Yield || line instanceof _Expression.YieldTo || line instanceof _Expression.BagEntry || line instanceof _Expression.MapEntry || line instanceof _Expression.Special && line.kind === _Expression.SP_Debugger ||
		// OK, used to mean `pass`
		line instanceof _Expression.GlobalAccess && line.name === 'null';
		cx.check(isStatement, line.loc, 'Expression in statement position.');
	},
	      lineNewLocals = function (line) {
		return line instanceof _Expression.Assign ? [line.assignee] : line instanceof _Expression.AssignDestructure ? line.assignees : [];
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1ldGEvY29tcGlsZS9wcml2YXRlL3ZlcmlmeS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7a0JBb0h3QixNQUFNOzs7Ozs7OztBQTFHOUIsT0FBTSxFQUFFLEdBQUcsVUFBQSxFQUFFO1NBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7VUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFO0dBQUEsQ0FBQztFQUFBLENBQUE7QUFDNUMsT0FBTSxHQUFHLEdBQUcsVUFBQSxFQUFFO1NBQUksS0FMRCxNQUFNLENBS0UsRUFBRSxFQUFFLFVBQUEsQ0FBQztVQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUU7R0FBQSxDQUFDO0VBQUEsQ0FBQTs7QUFFN0MsS0FDQyxFQUFFLEVBQ0YsTUFBTTs7O0FBR04sbUJBQWtCLEVBQ2xCLFNBQVMsRUFDVCxhQUFhLEVBQ2IsTUFBTSxFQUNOLEVBQUUsQ0FBQTs7QUFFSCxPQUNDLElBQUksR0FBRyxVQUFBLEdBQUcsRUFBSTtBQUNiLElBQUUsR0FBRyxHQUFHLENBQUE7QUFDUixRQUFNLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQTtBQUNsQixvQkFBa0IsR0FBRyxFQUFFLENBQUE7QUFDdkIsV0FBUyxHQUFHLEtBQUssQ0FBQTtBQUNqQixlQUFhLEdBQUcsS0FBSyxDQUFBO0FBQ3JCLFFBQU0sR0FBRyxJQUFJLENBQUE7QUFDYixJQUFFLEdBQUcscUJBQW1CLENBQUE7RUFDeEI7OztBQUVELE9BQU0sR0FBRyxZQUFNO0FBQ2QsUUFBTSxHQUFHLGtCQUFrQixHQUFHLE1BQU0sR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFBO0VBQ3JEO09BRUQsZUFBZSxHQUFHLFVBQUMsY0FBYyxFQUFFLEdBQUcsRUFBSztBQUMxQyxRQUFNLENBQUMsR0FBRyxhQUFhLENBQUE7QUFDdkIsZUFBYSxHQUFHLGNBQWMsQ0FBQTtBQUM5QixLQUFHLEVBQUUsQ0FBQTtBQUNMLGVBQWEsR0FBRyxDQUFDLENBQUE7RUFDakI7T0FFRCxVQUFVLEdB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QWlCLEdBQUcsVUFBQSxJQUFJLEVBQUk7QUFDM0IsUUFBTSxXQUFXLEdBQ2hCLElBQUksd0JBM1hvRCxFQUFFLEFBMlh4QyxJQUNsQixJQUFJLHdCQTVYdUMsSUFBSSxBQTRYM0IsSUFDcEIsSUFBSSx3QkE1WDJELEtBQUssQUE0WC9DLElBQ3JCLElBQUksd0JBN1hrRSxPQUFPLEFBNlh0RCxJQUN2QixJQUFJLHdCQS9Yc0UsUUFBUSxBQStYMUQsSUFDeEIsSUFBSSx3QkEvWFcsUUFBUSxBQStYQyxJQUN4QixJQUFJLHdCQWhZOEIsT0FBTyxBQWdZbEIsSUFBSSxJQUFJLENBQUMsSUFBSSxpQkFoWU8sV0FBVyxBQWdZRjs7QUFFcEQsTUFBSSx3QkFuWXdELFlBQVksQUFtWTVDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUE7QUFDckQsSUFBRSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxtQ0FBbUMsQ0FBQyxDQUFBO0VBQ3BFO09BRUQsYUFBYSxHQUFHLFVBQUEsSUFBSTtTQUNuQixJQUFJLHdCQXhZRyxNQUFNLEFBd1lTLEdBQ3JCLENBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBRSxHQUNqQixJQUFJLHdCQTFZVSxpQkFBaUIsQUEwWUUsR0FDakMsSUFBSSxDQUFDLFNBQVMsR0FDZCxFQUFHO0VBQUEsQ0FBQSIsImZpbGUiOiJtZXRhL2NvbXBpbGUvcHJpdmF0ZS92ZXJpZnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb2RlIH0gZnJvbSAnLi4vQ29tcGlsZUVycm9yJ1xuaW1wb3J0ICogYXMgRUV4cG9ydHMgZnJvbSAnLi4vRXhwcmVzc2lvbidcbmltcG9ydCB7IEFzc2lnbiwgQXNzaWduRGVzdHJ1Y3R1cmUsIEJsb2NrVmFsLCBDYWxsLCBEZWJ1ZywgRG8sIEdsb2JhbEFjY2VzcywgQmFnRW50cnksXG5cdExvY2FsRGVjbGFyZVJlcywgTWFwRW50cnksIFBhdHRlcm4sIFNwZWNpYWwsIFNQX0RlYnVnZ2VyLCBVc2VEbywgWWllbGQsIFlpZWxkVG9cblx0fSBmcm9tICcuLi9FeHByZXNzaW9uJ1xuaW1wb3J0IHsgY2F0LCBoZWFkLCBpc0VtcHR5IH0gZnJvbSAnLi9VL0JhZydcbmltcG9ydCB7IGlmRWxzZSwgb3BFYWNoIH0gZnJvbSAnLi9VL29wJ1xuaW1wb3J0IHsgaW1wbGVtZW50TWFueSwgbWFwS2V5cywgbmV3U2V0IH0gZnJvbSAnLi9VL3V0aWwnXG5pbXBvcnQgVmVyaWZ5UmVzdWx0cywgeyBMb2NhbEluZm8gfSBmcm9tICcuL1ZlcmlmeVJlc3VsdHMnXG5cbmNvbnN0IHZtID0gZXMgPT4gZXMuZm9yRWFjaChlID0+IGUudmVyaWZ5KCkpXG5jb25zdCB2b3AgPSBvcCA9PiBvcEVhY2gob3AsIF8gPT4gXy52ZXJpZnkoKSlcblxubGV0XG5cdGN4LFxuXHRsb2NhbHMsXG5cdC8vIExvY2FscyBmb3IgdGhpcyBibG9jay5cblx0Ly8gUmVwbGFjZXMgYGxvY2Fsc2Agd2hlbiBlbnRlcmluZyBpbnRvIHN1Yi1mdW5jdGlvbi5cblx0cGVuZGluZ0Jsb2NrTG9jYWxzLFxuXHRpc0luRGVidWcsXG5cdGlzSW5HZW5lcmF0b3IsXG5cdG9wTG9vcCxcblx0dnJcblxuY29uc3Rcblx0aW5pdCA9IF9jeCA9PiB7XG5cdFx0Y3ggPSBfY3hcblx0XHRsb2NhbHMgPSBuZXcgTWFwKClcblx0XHRwZW5kaW5nQmxvY2tMb2NhbHMgPSBbXVxuXHRcdGlzSW5EZWJ1ZyA9IGZhbHNlXG5cdFx0aXNJbkdlbmVyYXRvciA9IGZhbHNlXG5cdFx0b3BMb29wID0gbnVsbFxuXHRcdHZyID0gbmV3IFZlcmlmeVJlc3VsdHMoKVxuXHR9LFxuXHQvLyBSZWxlYXNlIGZvciBnYXJiYWdlIGNvbGxlY3Rpb25cblx0dW5pbml0ID0gKCkgPT4ge1xuXHRcdGxvY2FscyA9IHBlbmRpbmdCbG9ja0xvY2FscyA9IG9wTG9vcCA9IHZyID0gdW5kZWZpbmVkXG5cdH0sXG5cblx0d2l0aEluR2VuZXJhdG9yID0gKF9pc0luR2VuZXJhdG9yLCBmdW4pID0+IHtcblx0XHRjb25zdCBnID0gaXNJbkdlbmVyYXRvclxuXHRcdGlzSW5HZW5lcmF0b3IgPSBfaXNJbkdlbmVyYXRvclxuXHRcdGZ1bigpXG5cdFx0aXNJbkdlbmVyYXRvciA9IGdcblx0fSxcblxuXHRwbHVzTG9jYWxzID0gKGFkZGVkTG9jYWxzLCBmdW4pID0+IHtcblx0XHRjb25zdCBzaGFkb3dlZCA9IG5ldyBNYXAoKVxuXHRcdGFkZGVkTG9jYWxzLmZvckVhY2gobCA9PiB7XG5cdFx0XHRjb25zdCBnb3QgPSBsb2NhbHMuZ2V0KGwubmFtZSlcblx0XHRcdGlmIChnb3QgIT09IHVuZGVmaW5lZClcblx0XHRcdFx0c2hhZG93ZWQuc2V0KGwubmFtZSwgZ290KVxuXHRcdFx0bG9jYWxzLnNldChsLm5hbWUsIGwpXG5cdFx0fSlcblx0XHRmdW4oKVxuXHRcdGFkZGVkTG9jYWxzLmZvckVhY2gobCA9PiB7XG5cdFx0XHRjb25zdCBzID0gc2hhZG93ZWQuZ2V0KGwubmFtZSlcblx0XHRcdGlmIChzID09PSB1bmRlZmluZWQpXG5cdFx0XHRcdGxvY2Fscy5kZWxldGUobC5uYW1lKVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRsb2NhbHMuc2V0KGwubmFtZSwgcylcblx0XHR9KVxuXHR9LFxuXG5cdHBsdXNQZW5kaW5nQmxvY2tMb2NhbHMgPSAocGVuZGluZywgZnVuKSA9PiB7XG5cdFx0Y29uc3Qgb2xkTGVuZ3RoID0gcGVuZGluZ0Jsb2NrTG9jYWxzLmxlbmd0aFxuXHRcdHBlbmRpbmdCbG9ja0xvY2Fscy5wdXNoKC4uLnBlbmRpbmcpXG5cdFx0ZnVuKClcblx0XHR3aGlsZSAocGVuZGluZ0Jsb2NrTG9jYWxzLmxlbmd0aCA+IG9sZExlbmd0aClcblx0XHRcdHBlbmRpbmdCbG9ja0xvY2Fscy5wb3AoKVxuXHR9LFxuXG5cdHdpdGhJbkxvb3AgPSAobG9vcCwgZnVuKSA9PiB7XG5cdFx0Y29uc3QgbCA9IG9wTG9vcFxuXHRcdG9wTG9vcCA9IGxvb3Bcblx0XHRmdW4oKVxuXHRcdG9wTG9vcCA9IGxcblx0fSxcblxuXHR3aXRoSW5EZWJ1ZyA9IChfaXNJbkRlYnVnLCBmdW4pID0+IHtcblx0XHRjb25zdCBkID0gaXNJbkRlYnVnXG5cdFx0aXNJbkRlYnVnID0gX2lzSW5EZWJ1Z1xuXHRcdGZ1bigpXG5cdFx0aXNJbkRlYnVnID0gZFxuXHR9LFxuXG5cdHdpdGhCbG9ja0xvY2FscyA9IGZ1biA9PiB7XG5cdFx0Y29uc3QgYmwgPSBwZW5kaW5nQmxvY2tMb2NhbHNcblx0XHRwZW5kaW5nQmxvY2tMb2NhbHMgPSBbXVxuXHRcdHBsdXNMb2NhbHMoYmwsIGZ1bilcblx0XHRwZW5kaW5nQmxvY2tMb2NhbHMgPSBibFxuXHR9LFxuXG5cdGFjY2Vzc0xvY2FsID0gKGRlY2xhcmUsIGFjY2VzcywgaXNEZWJ1Z0FjY2VzcykgPT5cblx0XHRfYWRkQWNjZXNzKHZyLmxvY2FsVG9JbmZvLmdldChkZWNsYXJlKSwgYWNjZXNzLCBpc0RlYnVnQWNjZXNzKSxcblx0YWNjZXNzTG9jYWxGb3JSZXR1cm4gPSAoZGVjbGFyZSwgYWNjZXNzKSA9PiB7XG5cdFx0Y29uc3QgaW5mbyA9IHZyLmxvY2FsVG9JbmZvLmdldChkZWNsYXJlKVxuXHRcdF9hZGRBY2Nlc3MoaW5mbywgYWNjZXNzLCBpbmZvLmlzSW5EZWJ1Zylcblx0fSxcblx0X2FkZEFjY2VzcyA9IChsb2NhbEluZm8sIGFjY2VzcywgaXNEZWJ1Z0FjY2VzcykgPT5cblx0XHQoaXNEZWJ1Z0FjY2VzcyA/IGxvY2FsSW5mby5kZWJ1Z0FjY2Vzc2VzIDogbG9jYWxJbmZvLm5vbkRlYnVnQWNjZXNzZXMpLnB1c2goYWNjZXNzKSxcblxuXG5cdC8vIFZyIHNldHRlcnNcblx0c2V0RW5kTG9vcCA9IChlbmRMb29wLCBsb29wKSA9PiB7XG5cdFx0dnIuZW5kTG9vcFRvTG9vcC5zZXQoZW5kTG9vcCwgbG9vcClcblx0fSxcblxuXHRyZWdpc3RlckxvY2FsID0gbG9jYWwgPT4ge1xuXHRcdHZyLmxvY2FsVG9JbmZvLnNldChsb2NhbCwgTG9jYWxJbmZvKGlzSW5EZWJ1ZywgW10sIFtdKSlcblx0fSxcblxuXHRzZXRFbnRyeUluZGV4ID0gKGxpc3RNYXBFbnRyeSwgaW5kZXgpID0+IHtcblx0XHR2ci5lbnRyeVRvSW5kZXguc2V0KGxpc3RNYXBFbnRyeSwgaW5kZXgpXG5cdH1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdmVyaWZ5KGN4LCBlKSB7XG5cdGluaXQoY3gpXG5cdGUudmVyaWZ5KClcblx0dmVyaWZ5TG9jYWxVc2UoKVxuXHRjb25zdCBvdXQgPSB2clxuXHR1bmluaXQoKVxuXHRyZXR1cm4gb3V0XG59XG5cbmNvbnN0IHZlcmlmeUxvY2FsVXNlID0gKCkgPT4ge1xuXHR2ci5sb2NhbFRvSW5mby5mb3JFYWNoKChpbmZvLCBsb2NhbCkgPT4ge1xuXHRcdGlmICghKGxvY2FsIGluc3RhbmNlb2YgTG9jYWxEZWNsYXJlUmVzKSkge1xuXHRcdFx0Y29uc3Qgbm9Ob25EZWJ1ZyA9IGlzRW1wdHkoaW5mby5ub25EZWJ1Z0FjY2Vzc2VzKVxuXHRcdFx0aWYgKG5vTm9uRGVidWcgJiYgaXNFbXB0eShpbmZvLmRlYnVnQWNjZXNzZXMpKVxuXHRcdFx0XHRjeC53YXJuKGxvY2FsLmxvYywgKCkgPT4gYFVudXNlZCBsb2NhbCB2YXJpYWJsZSAke2NvZGUobG9jYWwubmFtZSl9LmApXG5cdFx0XHRlbHNlIGlmIChpbmZvLmlzSW5EZWJ1Zylcblx0XHRcdFx0Y3gud2FybklmKCFub05vbkRlYnVnLCAoKSA9PiBoZWFkKGluZm8ubm9uRGVidWdBY2Nlc3NlcykubG9jLCAoKSA9PlxuXHRcdFx0XHRcdGBEZWJ1Zy1vbmx5IGxvY2FsICR7Y29kZShsb2NhbC5uYW1lKX0gdXNlZCBvdXRzaWRlIG9mIGRlYnVnLmApXG5cdFx0XHRlbHNlXG5cdFx0XHRcdGN4Lndhcm5JZihub05vbkRlYnVnLCBsb2NhbC5sb2MsICgpID0+XG5cdFx0XHRcdFx0YExvY2FsICR7Y29kZShsb2NhbC5uYW1lKX0gdXNlZCBvbmx5IGluIGRlYnVnLmApXG5cdFx0fVxuXHR9KVxufVxuXG5pbXBsZW1lbnRNYW55KEVFeHBvcnRzLCAndmVyaWZ5Jywge1xuXHRBc3NpZ24oKSB7XG5cdFx0Y29uc3QgZG9WID0gKCkgPT4ge1xuXHRcdFx0dGhpcy5hc3NpZ25lZS52ZXJpZnkoKVxuXHRcdFx0dGhpcy52YWx1ZS52ZXJpZnkoKVxuXHRcdH1cblx0XHRpZiAodGhpcy5hc3NpZ25lZS5pc0xhenkpXG5cdFx0XHR3aXRoQmxvY2tMb2NhbHMoZG9WKVxuXHRcdGVsc2Vcblx0XHRcdGRvVigpXG5cdH0sXG5cdEJsb2NrRG8oKSB7IHZlcmlmeUxpbmVzKHRoaXMubGluZXMpIH0sXG5cdEJsb2NrV2l0aFJldHVybigpIHtcblx0XHRjb25zdCB7IG5ld0xvY2FscyB9ID0gdmVyaWZ5TGluZXModGhpcy5saW5lcylcblx0XHRwbHVzTG9jYWxzKG5ld0xvY2FscywgKCkgPT4gdGhpcy5yZXR1cm5lZC52ZXJpZnkoKSlcblx0fSxcblx0QmxvY2tPYmooKSB7XG5cdFx0Y29uc3QgeyBuZXdMb2NhbHMgfSA9IHZlcmlmeUxpbmVzKHRoaXMubGluZXMpXG5cdFx0dGhpcy5rZXlzLmZvckVhY2goXyA9PiBhY2Nlc3NMb2NhbEZvclJldHVybihfLCB0aGlzKSlcblx0XHRvcEVhY2godGhpcy5vcE9iamVkLCBfID0+IHBsdXNMb2NhbHMobmV3TG9jYWxzLCAoKSA9PiBfLnZlcmlmeSgpKSlcblx0fSxcblx0QmxvY2tCYWc6IGJsb2NrQmFnT3JNYXAsXG5cdEJsb2NrTWFwOiBibG9ja0JhZ09yTWFwLFxuXHRCbG9ja1dyYXAoKSB7XG5cdFx0dGhpcy5ibG9jay52ZXJpZnkoKVxuXHR9LFxuXHRDYXNlRG86IHZlcmlmeUNhc2UsXG5cdENhc2VWYWw6IHZlcmlmeUNhc2UsXG5cdC8vIE9ubHkgcmVhY2ggaGVyZSBmb3IgaW4vb3V0IGNvbmRpdGlvblxuXHREZWJ1ZygpIHsgdmVyaWZ5TGluZXMoWyB0aGlzIF0pIH0sXG5cdEVuZExvb3AoKSB7XG5cdFx0aWZFbHNlKG9wTG9vcCwgXyA9PiBzZXRFbmRMb29wKHRoaXMsIF8pLCAoKSA9PiBjeC5mYWlsKHRoaXMubG9jLCAnTm90IGluIGEgbG9vcC4nKSlcblx0fSxcblx0RnVuKCkge1xuXHRcdHdpdGhCbG9ja0xvY2FscygoKSA9PiB7XG5cdFx0XHRjeC5jaGVjayh0aGlzLm9wUmVzRGVjbGFyZSA9PT0gbnVsbCB8fCB0aGlzLmJsb2NrIGluc3RhbmNlb2YgQmxvY2tWYWwsIHRoaXMubG9jLFxuXHRcdFx0XHQnRnVuY3Rpb24gd2l0aCByZXR1cm4gY29uZGl0aW9uIG11c3QgcmV0dXJuIHNvbWV0aGluZy4nKVxuXHRcdFx0dGhpcy5hcmdzLmZvckVhY2goYXJnID0+IHZvcChhcmcub3BUeXBlKSlcblx0XHRcdHdpdGhJbkdlbmVyYXRvcih0aGlzLmlzR2VuZXJhdG9yLCAoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGFsbEFyZ3MgPSBjYXQodGhpcy5hcmdzLCB0aGlzLm9wUmVzdEFyZylcblx0XHRcdFx0YWxsQXJncy5mb3JFYWNoKF8gPT4gcmVnaXN0ZXJMb2NhbChfKSlcblx0XHRcdFx0cGx1c0xvY2FscyhhbGxBcmdzLCAoKSA9PiB7XG5cdFx0XHRcdFx0dm9wKHRoaXMub3BJbilcblx0XHRcdFx0XHR0aGlzLmJsb2NrLnZlcmlmeSgpXG5cdFx0XHRcdFx0b3BFYWNoKHRoaXMub3BSZXNEZWNsYXJlLCBfID0+IHtcblx0XHRcdFx0XHRcdF8udmVyaWZ5KClcblx0XHRcdFx0XHRcdHJlZ2lzdGVyTG9jYWwoXylcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdGNvbnN0IHZlcmlmeU91dCA9ICgpID0+IG9wRWFjaCh0aGlzLm9wT3V0LCBfID0+IF8udmVyaWZ5KCkpXG5cdFx0XHRcdFx0aWZFbHNlKHRoaXMub3BSZXNEZWNsYXJlLCByZCA9PiBwbHVzTG9jYWxzKFsgcmQgXSwgdmVyaWZ5T3V0KSwgdmVyaWZ5T3V0KVxuXHRcdFx0XHR9KVxuXHRcdFx0fSlcblx0XHR9KVxuXHR9LFxuXHRMb2NhbEFjY2VzcygpIHtcblx0XHRjb25zdCBkZWNsYXJlID0gbG9jYWxzLmdldCh0aGlzLm5hbWUpXG5cdFx0Y3guY2hlY2soZGVjbGFyZSAhPT0gdW5kZWZpbmVkLCB0aGlzLmxvYywgKCkgPT5cblx0XHRcdGBObyBzdWNoIGxvY2FsICR7Y29kZSh0aGlzLm5hbWUpfS5cXG5Mb2NhbHMgYXJlOlxcbiR7Y29kZShtYXBLZXlzKGxvY2Fscykuam9pbignICcpKX0uYClcblx0XHR2ci5hY2Nlc3NUb0xvY2FsLnNldCh0aGlzLCBkZWNsYXJlKVxuXHRcdGFjY2Vzc0xvY2FsKGRlY2xhcmUsIHRoaXMsIGlzSW5EZWJ1Zylcblx0fSxcblx0TG9vcCgpIHsgd2l0aEluTG9vcCh0aGlzLCAoKSA9PiB0aGlzLmJsb2NrLnZlcmlmeSgpKSB9LFxuXHQvLyBBZGRpbmcgTG9jYWxEZWNsYXJlcyB0byB0aGUgYXZhaWxhYmxlIGxvY2FscyBpcyBkb25lIGJ5IEZ1biBvciBsaW5lTmV3TG9jYWxzLlxuXHRMb2NhbERlY2xhcmUoKSB7IHZvcCh0aGlzLm9wVHlwZSkgfSxcblx0TWFwRW50cnkoKSB7XG5cdFx0dGhpcy5rZXkudmVyaWZ5KClcblx0XHR0aGlzLnZhbC52ZXJpZnkoKVxuXHR9LFxuXHRNb2R1bGUoKSB7XG5cdFx0Y29uc3QgdXNlTG9jYWxzID0gdmVyaWZ5VXNlcyh0aGlzLnVzZXMsIHRoaXMuZGVidWdVc2VzKVxuXHRcdHBsdXNMb2NhbHModXNlTG9jYWxzLCAoKSA9PiB7XG5cdFx0XHRjb25zdCB7IG5ld0xvY2FscyB9ID0gdmVyaWZ5TGluZXModGhpcy5saW5lcylcblx0XHRcdHRoaXMuZXhwb3J0cy5mb3JFYWNoKGV4ID0+IGFjY2Vzc0xvY2FsRm9yUmV0dXJuKGV4LCB0aGlzKSlcblx0XHRcdG9wRWFjaCh0aGlzLm9wRGVmYXVsdEV4cG9ydCwgXyA9PiBwbHVzTG9jYWxzKG5ld0xvY2FscywgKCkgPT4gXy52ZXJpZnkoKSkpXG5cdFx0fSlcblxuXHRcdGNvbnN0IGV4cG9ydHMgPSBuZXdTZXQodGhpcy5leHBvcnRzKVxuXHRcdGNvbnN0IG1hcmtFeHBvcnRMaW5lcyA9IGxpbmUgPT4ge1xuXHRcdFx0aWYgKGxpbmUgaW5zdGFuY2VvZiBBc3NpZ24gJiYgZXhwb3J0cy5oYXMobGluZS5hc3NpZ25lZSkgfHxcblx0XHRcdFx0bGluZSBpbnN0YW5jZW9mIEFzc2lnbkRlc3RydWN0dXJlICYmIGxpbmUuYXNzaWduZWVzLnNvbWUoXyA9PiBleHBvcnRzLmhhcyhfKSkpXG5cdFx0XHRcdHZyLmV4cG9ydEFzc2lnbnMuYWRkKGxpbmUpXG5cdFx0XHRlbHNlIGlmIChsaW5lIGluc3RhbmNlb2YgRGVidWcpXG5cdFx0XHRcdGxpbmUubGluZXMuZm9yRWFjaChtYXJrRXhwb3J0TGluZXMpXG5cdFx0fVxuXHRcdHRoaXMubGluZXMuZm9yRWFjaChtYXJrRXhwb3J0TGluZXMpXG5cdH0sXG5cdFlpZWxkKCkge1xuXHRcdGN4LmNoZWNrKGlzSW5HZW5lcmF0b3IsIHRoaXMubG9jLCAnQ2Fubm90IHlpZWxkIG91dHNpZGUgb2YgZ2VuZXJhdG9yIGNvbnRleHQnKVxuXHRcdHRoaXMueWllbGRlZC52ZXJpZnkoKVxuXHR9LFxuXHRZaWVsZFRvKCkge1xuXHRcdGN4LmNoZWNrKGlzSW5HZW5lcmF0b3IsIHRoaXMubG9jLCAnQ2Fubm90IHlpZWxkIG91dHNpZGUgb2YgZ2VuZXJhdG9yIGNvbnRleHQnKVxuXHRcdHRoaXMueWllbGRlZFRvLnZlcmlmeSgpXG5cdH0sXG5cblx0Ly8gVGhlc2Ugb25lcyBqdXN0IHJlY3Vyc2UgdG8gdGhlaXIgY2hpbGRyZW4uXG5cdEFzc2lnbkRlc3RydWN0dXJlKCkge1xuXHRcdHRoaXMudmFsdWUudmVyaWZ5KClcblx0XHR2bSh0aGlzLmFzc2lnbmVlcylcblx0fSxcblx0Q2FsbCgpIHtcblx0XHR0aGlzLmNhbGxlZC52ZXJpZnkoKVxuXHRcdHZtKHRoaXMuYXJncylcblx0fSxcblx0Q2FzZURvUGFydDogdmVyaWZ5Q2FzZVBhcnQsXG5cdENhc2VWYWxQYXJ0OiB2ZXJpZnlDYXNlUGFydCxcblx0R2xvYmFsQWNjZXNzKCkgeyB9LFxuXHRPYmpTaW1wbGUoKSB7XG5cdFx0Y29uc3Qga2V5cyA9IG5ldyBTZXQoKVxuXHRcdHRoaXMucGFpcnMuZm9yRWFjaChwYWlyID0+IHtcblx0XHRcdGN4LmNoZWNrKCFrZXlzLmhhcyhwYWlyLmtleSksIHBhaXIubG9jLCAoKSA9PiBgRHVwbGljYXRlIGtleSAke3BhaXIua2V5fWApXG5cdFx0XHRrZXlzLmFkZChwYWlyLmtleSlcblx0XHRcdHBhaXIudmFsdWUudmVyaWZ5KClcblx0XHR9KVxuXHR9LFxuXHRMYXp5KCkgeyB3aXRoQmxvY2tMb2NhbHMoKCkgPT4gdGhpcy52YWx1ZS52ZXJpZnkoKSkgfSxcblx0QmFnRW50cnkoKSB7IHRoaXMudmFsdWUudmVyaWZ5KCkgfSxcblx0TGlzdFNpbXBsZSgpIHsgdm0odGhpcy5wYXJ0cykgfSxcblx0TnVtYmVyTGl0ZXJhbCgpIHsgfSxcblx0TWVtYmVyKCkgeyB0aGlzLm9iamVjdC52ZXJpZnkoKSB9LFxuXHRRdW90ZSgpIHtcblx0XHR0aGlzLnBhcnRzLmZvckVhY2goXyA9PiB7XG5cdFx0XHRpZiAodHlwZW9mIF8gIT09ICdzdHJpbmcnKVxuXHRcdFx0XHRfLnZlcmlmeSgpXG5cdFx0fSlcblx0fSxcblx0U3BlY2lhbCgpIHsgfSxcblx0U3BsYXQoKSB7IHRoaXMuc3BsYXR0ZWQudmVyaWZ5KCkgfVxufSlcblxuZnVuY3Rpb24gYmxvY2tCYWdPck1hcCgpIHtcblx0Y29uc3QgeyBsaXN0TWFwTGVuZ3RoIH0gPSB2ZXJpZnlMaW5lcyh0aGlzLmxpbmVzKVxuXHR2ci5ibG9ja1RvTGVuZ3RoLnNldCh0aGlzLCBsaXN0TWFwTGVuZ3RoKVxufVxuXG5mdW5jdGlvbiB2ZXJpZnlDYXNlKCkge1xuXHRjb25zdCBuZXdMb2NhbHMgPSBbXVxuXHRvcEVhY2godGhpcy5vcENhc2VkLCBfID0+IHtcblx0XHRyZWdpc3RlckxvY2FsKF8uYXNzaWduZWUpXG5cdFx0Xy52ZXJpZnkoKVxuXHRcdG5ld0xvY2Fscy5wdXNoKF8uYXNzaWduZWUpXG5cdH0pXG5cdHBsdXNMb2NhbHMobmV3TG9jYWxzLCAoKSA9PiB7XG5cdFx0dm0odGhpcy5wYXJ0cylcblx0XHR2b3AodGhpcy5vcEVsc2UpXG5cdH0pXG59XG5cbmZ1bmN0aW9uIHZlcmlmeUNhc2VQYXJ0KCkge1xuXHRpZiAodGhpcy50ZXN0IGluc3RhbmNlb2YgUGF0dGVybikge1xuXHRcdHRoaXMudGVzdC50eXBlLnZlcmlmeSgpXG5cdFx0dGhpcy50ZXN0LnBhdHRlcm5lZC52ZXJpZnkoKVxuXHRcdHZtKHRoaXMudGVzdC5sb2NhbHMpXG5cdFx0dGhpcy50ZXN0LmxvY2Fscy5mb3JFYWNoKHJlZ2lzdGVyTG9jYWwpXG5cdFx0cGx1c0xvY2Fscyh0aGlzLnRlc3QubG9jYWxzLCAoKSA9PiB0aGlzLnJlc3VsdC52ZXJpZnkoKSlcblx0fSBlbHNlIHtcblx0XHR0aGlzLnRlc3QudmVyaWZ5KClcblx0XHR0aGlzLnJlc3VsdC52ZXJpZnkoKVxuXHR9XG59XG5cbmNvbnN0XG5cdHZlcmlmeVVzZXMgPSAodXNlcywgZGVidWdVc2VzKSA9PiB7XG5cdFx0Y29uc3QgdXNlTG9jYWxzID0gW11cblx0XHRjb25zdFxuXHRcdFx0dmVyaWZ5VXNlID0gdXNlID0+IHtcblx0XHRcdFx0dXNlLnVzZWQuZm9yRWFjaCh1c2VMb2NhbClcblx0XHRcdFx0b3BFYWNoKHVzZS5vcFVzZURlZmF1bHQsIHVzZUxvY2FsKVxuXHRcdFx0fSxcblx0XHRcdHVzZUxvY2FsID0gXyA9PiB7XG5cdFx0XHRcdHJlZ2lzdGVyTG9jYWwoXylcblx0XHRcdFx0dXNlTG9jYWxzLnB1c2goXylcblx0XHRcdH1cblx0XHR1c2VzLmZvckVhY2godXNlID0+IHtcblx0XHRcdGlmICghKHVzZSBpbnN0YW5jZW9mIFVzZURvKSkgdmVyaWZ5VXNlKHVzZSlcblx0XHR9KVxuXHRcdHdpdGhJbkRlYnVnKHRydWUsICgpID0+IGRlYnVnVXNlcy5mb3JFYWNoKHZlcmlmeVVzZSkpXG5cdFx0cmV0dXJuIHVzZUxvY2Fsc1xuXHR9LFxuXG5cdHZlcmlmeUxpbmVzID0gbGluZXMgPT4ge1xuXHRcdGNvbnN0IG5ld0xvY2FscyA9IFsgXVxuXHRcdC8vIEZpcnN0LCBnZXQgbG9jYWxzIGZvciB0aGUgd2hvbGUgYmxvY2suXG5cdFx0Y29uc3QgZ2V0TGluZUxvY2FscyA9IGxpbmUgPT4ge1xuXHRcdFx0aWYgKGxpbmUgaW5zdGFuY2VvZiBEZWJ1Zylcblx0XHRcdFx0d2l0aEluRGVidWcodHJ1ZSwgKCkgPT4gbGluZS5saW5lcy5mb3JFYWNoKGdldExpbmVMb2NhbHMpKVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGNvbnN0IG5ld3MgPSBsaW5lTmV3TG9jYWxzKGxpbmUpXG5cdFx0XHRcdG5ld3MuZm9yRWFjaChyZWdpc3RlckxvY2FsKVxuXHRcdFx0XHRuZXdMb2NhbHMucHVzaCguLi5uZXdzKVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGxpbmVzLmZvckVhY2goZ2V0TGluZUxvY2FscylcblxuXHRcdGNvbnN0IHRoaXNCbG9ja0xvY2FsTmFtZXMgPSBuZXcgU2V0KClcblx0XHRjb25zdCBzaGFkb3dlZCA9IG5ldyBNYXAoKVxuXG5cdFx0bGV0IGxpc3RNYXBMZW5ndGggPSAwXG5cblx0XHRjb25zdCB2ZXJpZnlMaW5lID0gbGluZSA9PiB7XG5cdFx0XHRpZiAobGluZSBpbnN0YW5jZW9mIERlYnVnKVxuXHRcdFx0XHQvLyBUT0RPOiBEbyBhbnl0aGluZyBpbiB0aGlzIHNpdHVhdGlvbj9cblx0XHRcdFx0Ly8gY3guY2hlY2soIWluRGVidWcsIGxpbmUubG9jLCAnUmVkdW5kYW50IGBkZWJ1Z2AuJylcblx0XHRcdFx0d2l0aEluRGVidWcodHJ1ZSwgKCkgPT4gbGluZS5saW5lcy5mb3JFYWNoKHZlcmlmeUxpbmUpKVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdHZlcmlmeUlzU3RhdGVtZW50KGxpbmUpXG5cdFx0XHRcdGxpbmVOZXdMb2NhbHMobGluZSkuZm9yRWFjaChsID0+IHtcblx0XHRcdFx0XHRjb25zdCBnb3QgPSBsb2NhbHMuZ2V0KGwubmFtZSlcblx0XHRcdFx0XHRpZiAoZ290ICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdGN4LmNoZWNrKCF0aGlzQmxvY2tMb2NhbE5hbWVzLmhhcyhsLm5hbWUpLCBsLmxvYyxcblx0XHRcdFx0XHRcdFx0KCkgPT4gYEEgbG9jYWwgJHtjb2RlKGwubmFtZSl9IGlzIGFscmVhZHkgaW4gdGhpcyBibG9jay5gKVxuXHRcdFx0XHRcdFx0c2hhZG93ZWQuc2V0KGwubmFtZSwgZ290KVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRsb2NhbHMuc2V0KGwubmFtZSwgbClcblx0XHRcdFx0XHR0aGlzQmxvY2tMb2NhbE5hbWVzLmFkZChsLm5hbWUpXG5cdFx0XHRcdH0pXG5cdFx0XHRcdGlmIChsaW5lIGluc3RhbmNlb2YgQmFnRW50cnkgfHwgbGluZSBpbnN0YW5jZW9mIE1hcEVudHJ5KSB7XG5cdFx0XHRcdFx0c2V0RW50cnlJbmRleChsaW5lLCBsaXN0TWFwTGVuZ3RoKVxuXHRcdFx0XHRcdGxpc3RNYXBMZW5ndGggPSBsaXN0TWFwTGVuZ3RoICsgMVxuXHRcdFx0XHR9XG5cdFx0XHRcdGxpbmUudmVyaWZ5KClcblx0XHRcdH1cblx0XHR9XG5cblx0XHRwbHVzUGVuZGluZ0Jsb2NrTG9jYWxzKG5ld0xvY2FscywgKCkgPT4gbGluZXMuZm9yRWFjaCh2ZXJpZnlMaW5lKSlcblxuXHRcdG5ld0xvY2Fscy5mb3JFYWNoKGwgPT4ge1xuXHRcdFx0Y29uc3QgcyA9IHNoYWRvd2VkLmdldChsLm5hbWUpXG5cdFx0XHRpZiAocyA9PT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRsb2NhbHMuZGVsZXRlKGwubmFtZSlcblx0XHRcdGVsc2Vcblx0XHRcdFx0bG9jYWxzLnNldChsLm5hbWUsIHMpXG5cdFx0fSlcblxuXHRcdHJldHVybiB7IG5ld0xvY2FscywgbGlzdE1hcExlbmd0aCB9XG5cdH0sXG5cblx0dmVyaWZ5SXNTdGF0ZW1lbnQgPSBsaW5lID0+IHtcblx0XHRjb25zdCBpc1N0YXRlbWVudCA9XG5cdFx0XHRsaW5lIGluc3RhbmNlb2YgRG8gfHxcblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBDYWxsIHx8XG5cdFx0XHRsaW5lIGluc3RhbmNlb2YgWWllbGQgfHxcblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBZaWVsZFRvIHx8XG5cdFx0XHRsaW5lIGluc3RhbmNlb2YgQmFnRW50cnkgfHxcblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBNYXBFbnRyeSB8fFxuXHRcdFx0bGluZSBpbnN0YW5jZW9mIFNwZWNpYWwgJiYgbGluZS5raW5kID09PSBTUF9EZWJ1Z2dlciB8fFxuXHRcdFx0Ly8gT0ssIHVzZWQgdG8gbWVhbiBgcGFzc2Bcblx0XHRcdGxpbmUgaW5zdGFuY2VvZiBHbG9iYWxBY2Nlc3MgJiYgbGluZS5uYW1lID09PSAnbnVsbCdcblx0XHRjeC5jaGVjayhpc1N0YXRlbWVudCwgbGluZS5sb2MsICdFeHByZXNzaW9uIGluIHN0YXRlbWVudCBwb3NpdGlvbi4nKVxuXHR9LFxuXG5cdGxpbmVOZXdMb2NhbHMgPSBsaW5lID0+XG5cdFx0bGluZSBpbnN0YW5jZW9mIEFzc2lnbiA/XG5cdFx0XHRbIGxpbmUuYXNzaWduZWUgXSA6XG5cdFx0XHRsaW5lIGluc3RhbmNlb2YgQXNzaWduRGVzdHJ1Y3R1cmUgP1xuXHRcdFx0bGluZS5hc3NpZ25lZXMgOlxuXHRcdFx0WyBdXG4iXSwic291cmNlUm9vdCI6Ii9zcmMifQ==