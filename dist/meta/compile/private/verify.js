if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module', '../CompileError', '../Expression', './U/Bag', './U/Op', './U/util', './Vr'], function (exports, module, _CompileError, _Expression, _UBag, _UOp, _UUtil, _Vr) {
	'use strict';

	module.exports = verify;

	function _interopRequire(obj) { return obj && obj.__esModule ? obj['default'] : obj; }

	function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

	var _Vr2 = _interopRequire(_Vr);

	const vm = function (es) {
		return es.forEach(function (e) {
			return e.verify();
		});
	};

	let cx, locals,
	// Locals for this block.
	// Replaces `locals` when entering into sub-function.
	pendingBlockLocals, isInDebug, isInGenerator, opLoop, vr;

	const init = function (_cx) {
		cx = _cx;
		locals = new Map();
		pendingBlockLocals = [];
		isInDebug = false;
		isInGenerator = false;
		opLoop = [];
		vr = new _Vr2();
	},
	     
	// Release for garbage collection
	uninit = function () {
		locals = pendingBlockLocals = opLoop = vr = undefined;
	},
	      withInGenerator = function (_isInGenerator, fun) {
		const g = isInGenerator;
		isInGenerator = _isInGenerator;
		fun();
		isInGenerator = g;
	},
	      plusLocals = function (addedLocals, fun) {
		const shadowed = new Map();
		addedLocals.forEach(function (l) {
			const got = locals.get(l.name);
			if (got !== undefined) shadowed.set(l.name, got);
			locals.set(l.name, l);
		});
		fun();
		addedLocals.forEach(function (l) {
			const s = shadowed.get(l.name);
			if (s === undefined) locals.delete(l.name);else locals.set(l.name, s);
		});
	},
	      plusPendingBlockLocals = function (pending, fun) {
		const oldLength = pendingBlockLocals.length;
		pendingBlockLocals.push.apply(pendingBlockLocals, _toConsumableArray(pending));
		fun();
		while (pendingBlockLocals.length > oldLength) pendingBlockLocals.pop();
	},
	      withInLoop = function (loop, fun) {
		const l = opLoop;
		opLoop = _UOp.some(loop);
		fun();
		opLoop = l;
	},
	      withInDebug = function (_isInDebug, fun) {
		const d = isInDebug;
		isInDebug = _isInDebug;
		fun();
		isInDebug = d;
	},
	      withBlockLocals = function (fun) {
		const bl = pendingBlockLocals;
		pendingBlockLocals = [];
		plusLocals(bl, fun);
		pendingBlockLocals = bl;
	},
	      accessLocal = function (declare, access, isDebugAccess) {
		return _addAccess(vr.localToInfo.get(declare), access, isDebugAccess);
	},
	      accessLocalForReturn = function (declare, access) {
		const info = vr.localToInfo.get(declare);
		_addAccess(info, access, info.isInDebug);
	},
	      _addAccess = function (localInfo, access, isDebugAccess) {
		return (isDebugAccess ? localInfo.debugAccesses : localInfo.nonDebugAccesses).push(access);
	},
	     

	// Vr setters
	setEndLoop = function (endLoop, loop) {
		vr.endLoopToLoop.set(endLoop, loop);
	},
	      registerLocal = function (local) {
		vr.localToInfo.set(local, _Vr.VrLocalInfo(isInDebug, [], []));
	},
	      setEntryIndex = function (listMapEntry, index) {
		vr.entryToIndex.set(listMapEntry, index);
	},
	      maybeSetListMapLength = function (returner, length) {
		if (returner instanceof _Expression.ListReturn || returner instanceof _Expression.MapReturn) vr.returnToLength.set(returner, length);else _UUtil.assert(length === 0);
	};

	function verify(cx, e) {
		init(cx);
		e.verify();
		verifyLocalUse();
		const out = vr;
		uninit();
		return out;
	}

	const verifyLocalUse = function () {
		vr.localToInfo.forEach(function (info, local) {
			if (!(local instanceof _Expression.LocalDeclareRes)) {
				const noNonDebug = _UBag.isEmpty(info.nonDebugAccesses);
				if (noNonDebug && _UBag.isEmpty(info.debugAccesses)) cx.warn(local.loc, function () {
					return 'Unused local variable ' + _CompileError.code(local.name) + '.';
				});else if (info.isInDebug) cx.warnIf(!noNonDebug, function () {
					return _UBag.head(info.nonDebugAccesses).loc;
				}, function () {
					return 'Debug-only local ' + _CompileError.code(local.name) + ' used outside of debug.';
				});else cx.warnIf(noNonDebug, local.loc, function () {
					return 'Local ' + _CompileError.code(local.name) + ' used only in debug.';
				});
			}
		});
	};

	_UUtil.implementMany(_Expression, 'verify', {
		Assign: function () {
			var _this = this;

			const doV = function () {
				_this.assignee.verify();
				_this.value.verify();
			};
			if (this.assignee.isLazy) withBlockLocals(doV);else doV();
		},
		BlockDo: function () {
			verifyLines(this.lines);
		},
		BlockVal: function () {
			var _this2 = this;

			var _verifyLines = verifyLines(this.lines);

			const newLocals = _verifyLines.newLocals;
			const listMapLength = _verifyLines.listMapLength;

			maybeSetListMapLength(this.returned, listMapLength);
			plusLocals(newLocals, function () {
				return _this2.returned.verify();
			});
		},
		BlockWrap: function () {
			this.block.verify();
		},
		CaseDo: verifyCase,
		CaseVal: verifyCase,
		// Only reach here for in/out condition
		Debug: function () {
			verifyLines([this]);
		},
		EndLoop: function () {
			var _this3 = this;

			_UOp.ifElse(opLoop, function (loop) {
				return setEndLoop(_this3, loop);
			}, function () {
				return cx.fail(_this3.loc, 'Not in a loop.');
			});
		},
		Fun: function () {
			var _this4 = this;

			withBlockLocals(function () {
				cx.check(_UBag.isEmpty(_this4.opResDeclare) || _this4.block instanceof _Expression.BlockVal, _this4.loc, 'Function with return condition must return something.');
				_this4.args.forEach(function (arg) {
					return vm(arg.opType);
				});
				withInGenerator(_this4.isGenerator, function () {
					const allArgs = _this4.args.concat(_this4.opRestArg);
					allArgs.forEach(function (_) {
						return registerLocal(_);
					});
					plusLocals(allArgs, function () {
						vm(_this4.opIn);
						_this4.block.verify();
						_this4.opResDeclare.forEach(function (rd) {
							rd.verify();
							registerLocal(rd);
						});
						_this4.opOut.forEach(function (o) {
							return plusLocals(_this4.opResDeclare, function () {
								return o.verify();
							});
						});
					});
				});
			});
		},
		LocalAccess: function () {
			var _this5 = this;

			const declare = locals.get(this.name);
			cx.check(declare !== undefined, this.loc, function () {
				return 'No such local ' + _CompileError.code(_this5.name) + '.\nLocals are:\n' + _CompileError.code(_UUtil.mapKeys(locals).join(' ')) + '.';
			});
			vr.accessToLocal.set(this, declare);
			accessLocal(declare, this, isInDebug);
		},
		Loop: function () {
			var _this6 = this;

			withInLoop(this, function () {
				return _this6.block.verify();
			});
		},
		// Adding LocalDeclares to the available locals is done by Fun or lineNewLocals.
		LocalDeclare: function () {
			vm(this.opType);
		},
		MapEntry: function () {
			this.key.verify();
			this.val.verify();
		},
		Module: function () {
			var _this7 = this;

			const useLocals = verifyUses(this.uses, this.debugUses);
			plusLocals(useLocals, function () {
				var _verifyLines2 = verifyLines(_this7.lines);

				const newLocals = _verifyLines2.newLocals;
				const listMapLength = _verifyLines2.listMapLength;

				_this7.exports.forEach(function (ex) {
					return accessLocalForReturn(ex, _this7);
				});
				_this7.opDefaultExport.forEach(function (def) {
					maybeSetListMapLength(def, listMapLength);
					plusLocals(newLocals, function () {
						return def.verify();
					});
				});
			});

			const exports = _UUtil.newSet(this.exports);
			const markExportLines = function (line) {
				if (line instanceof _Expression.Assign && exports.has(line.assignee) || line instanceof _Expression.AssignDestructure && line.assignees.some(function (_) {
					return exports.has(_);
				})) vr.exportAssigns.add(line);else if (line instanceof _Expression.Debug) line.lines.forEach(markExportLines);
			};
			this.lines.forEach(markExportLines);
		},
		ObjReturn: function () {
			var _this8 = this;

			vm(this.opObjed);
			this.keys.forEach(function (key) {
				return accessLocalForReturn(key, _this8);
			});
		},
		Yield: function () {
			cx.check(isInGenerator, this.loc, 'Cannot yield outside of generator context');
			this.yielded.verify();
		},
		YieldTo: function () {
			cx.check(isInGenerator, this.loc, 'Cannot yield outside of generator context');
			this.yieldedTo.verify();
		},

		// These ones just recurse to their children.
		AssignDestructure: function () {
			this.value.verify();
			vm(this.assignees);
		},
		Call: function () {
			this.called.verify();
			vm(this.args);
		},
		CaseDoPart: verifyCasePart,
		CaseValPart: verifyCasePart,
		GlobalAccess: function () {},
		ObjSimple: function () {
			const keys = new Set();
			this.pairs.forEach(function (pair) {
				cx.check(!keys.has(pair.key), pair.loc, function () {
					return 'Duplicate key ' + pair.key;
				});
				keys.add(pair.key);
				pair.value.verify();
			});
		},
		Lazy: function () {
			var _this9 = this;

			withBlockLocals(function () {
				return _this9.value.verify();
			});
		},
		ListReturn: function () {},
		ListEntry: function () {
			this.value.verify();
		},
		ListSimple: function () {
			vm(this.parts);
		},
		NumberLiteral: function () {},
		MapReturn: function () {},
		Member: function () {
			this.object.verify();
		},
		Quote: function () {
			this.parts.forEach(function (_) {
				if (typeof _ !== 'string') _.verify();
			});
		},
		Special: function () {},
		Splat: function () {
			this.splatted.verify();
		}
	});

	function verifyCase() {
		var _this10 = this;

		const newLocals = [];
		this.opCased.forEach(function (cased) {
			registerLocal(cased.assignee);
			cased.verify();
			newLocals.push(cased.assignee);
		});
		plusLocals(newLocals, function () {
			vm(_this10.parts);
			vm(_this10.opElse);
		});
	}

	function verifyCasePart() {
		var _this11 = this;

		if (this.test instanceof _Expression.Pattern) {
			this.test.type.verify();
			this.test.patterned.verify();
			vm(this.test.locals);
			this.test.locals.forEach(registerLocal);
			plusLocals(this.test.locals, function () {
				return _this11.result.verify();
			});
		} else {
			this.test.verify();
			this.result.verify();
		}
	}

	const verifyUses = function (uses, debugUses) {
		const useLocals = [];
		const verifyUse = function (use) {
			use.used.forEach(useLocal);
			use.opUseDefault.forEach(useLocal);
		},
		      useLocal = function (_) {
			registerLocal(_);
			useLocals.push(_);
		};
		uses.forEach(function (use) {
			if (!(use instanceof _Expression.UseDo)) verifyUse(use);
		});
		withInDebug(true, function () {
			return debugUses.forEach(verifyUse);
		});
		return useLocals;
	},
	      verifyLines = function (lines) {
		const newLocals = [];
		// First, get locals for the whole block.
		const getLineLocals = function (line) {
			if (line instanceof _Expression.Debug) withInDebug(true, function () {
				return line.lines.forEach(getLineLocals);
			});else {
				const news = lineNewLocals(line);
				news.forEach(registerLocal);
				newLocals.push.apply(newLocals, _toConsumableArray(news));
			}
		};

		lines.forEach(getLineLocals);

		const thisBlockLocalNames = new Set();
		const shadowed = new Map();

		let listMapLength = 0;

		const verifyLine = function (line) {
			if (line instanceof _Expression.Debug)
				// TODO: Do anything in this situation?
				// cx.check(!inDebug, line.loc, 'Redundant `debug`.')
				withInDebug(true, function () {
					return line.lines.forEach(verifyLine);
				});else {
				verifyIsStatement(line);
				lineNewLocals(line).forEach(function (l) {
					const got = locals.get(l.name);
					if (got !== undefined) {
						cx.check(!thisBlockLocalNames.has(l.name), l.loc, function () {
							return 'A local ' + _CompileError.code(l.name) + ' is already in this block.';
						});
						shadowed.set(l.name, got);
					}
					locals.set(l.name, l);
					thisBlockLocalNames.add(l.name);
				});
				if (line instanceof _Expression.ListEntry || line instanceof _Expression.MapEntry) {
					setEntryIndex(line, listMapLength);
					listMapLength = listMapLength + 1;
				}
				line.verify();
			}
		};

		plusPendingBlockLocals(newLocals, function () {
			return lines.forEach(verifyLine);
		});

		newLocals.forEach(function (l) {
			const s = shadowed.get(l.name);
			if (s === undefined) locals.delete(l.name);else locals.set(l.name, s);
		});

		return { newLocals: newLocals, listMapLength: listMapLength };
	},
	      verifyIsStatement = function (line) {
		switch (true) {
			case line instanceof _Expression.Do:
			// Some Vals are also conceptually Dos, but this was easier than multiple inheritance.
			case line instanceof _Expression.Call:
			case line instanceof _Expression.Yield:
			case line instanceof _Expression.YieldTo:
			case line instanceof _Expression.Special && line.k === _Expression.SP_Debugger:
			// OK, used to mean `pass`
			case line instanceof _Expression.GlobalAccess && line.name === 'null':
				return;
			default:
				cx.fail(line.loc, 'Expression in statement position.');
		}
	},
	      lineNewLocals = function (line) {
		return line instanceof _Expression.Assign ? [line.assignee] : line instanceof _Expression.AssignDestructure ? line.assignees : [];
	};
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1ldGEvY29tcGlsZS9wcml2YXRlL3ZlcmlmeS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7a0JBMEh3QixNQUFNOzs7Ozs7OztBQWhIOUIsT0FBTSxFQUFFLEdBQUcsVUFBQSxFQUFFO1NBQUksRUFBRSxDQUFDLE9BQU8sQ0FBQyxVQUFBLENBQUM7VUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFO0dBQUEsQ0FBQztFQUFBLENBQUE7O0FBRTVDLEtBQ0MsRUFBRSxFQUNGLE1BQU07OztBQUdOLG1CQUFrQixFQUNsQixTQUFTLEVBQ1QsYUFBYSxFQUNiLE1BQU0sRUFDTixFQUFFLENBQUE7O0FBRUgsT0FDQyxJQUFJLEdBQUcsVUFBQSxHQUFHLEVBQUk7QUFDYixJQUFFLEdBQUcsR0FBRyxDQUFBO0FBQ1IsUUFBTSxHQUFHLElBQUksR0FBRyxFQUFFLENBQUE7QUFDbEIsb0JBQWtCLEdBQUcsRUFBRSxDQUFBO0FBQ3ZCLFdBQVMsR0FBRyxLQUFLLENBQUE7QUFDakIsZUFBYSxHQUFHLEtBQUssQ0FBQTtBQUNyQixRQUFNLEdBQUcsRUFBRSxDQUFBO0FBQ1gsSUFBRSxHQUFHLFVBQVEsQ0FBQTtFQUNiOzs7QUFFRCxPQUFNLEdBQUcsWUFBTTtBQUNkLFFBQU0sR0FBRyxrQkFBa0IsR0FBRyxNQUFNLEdBQUcsRUFBRSxHQUFHLFNBQVMsQ0FBQTtFQUNyRDtPQUVELGVBQWUsR0FBRyxVQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUs7QUFDMUMsUUFBTSxDQUFDLEdBQUcsYUFBYSxDQUFBO0FBQ3ZCLGVBQWEsR0FBRyxjQUFjLENBQUE7QUFDOUIsS0FBRyxFQUFFLENBQUE7QUFDTCxlQUFhLEdBQUcsQ0FBQyxDQUFBO0VBQ2pCO09BRUQsVUFBVSxHQUFHLFVBQUMsV0FBVyxFQUFFLEdBQUcsRUFBSztBQUNsQyxRQUFNLFFBQVEsR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFBO0FBQzFCLGFBQVcsQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDLEVBQUk7QUFDeEIsU0FB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QWxZaUUsS0FBSyxBQWtZckQsQ0FBQztBQUMzQixRQUFLLElBQUksd0JBbll3RSxPQUFPLEFBbVk1RCxDQUFDO0FBQzdCLFFBQUssSUFBSSx3QkFwWW9DLE9BQU8sQUFvWXhCLElBQUksSUFBSSxDQUFDLENBQUMsaUJBcFlnQixXQUFXLEFBb1lYLENBQUM7O0FBRXZELFFBQUssSUFBSSx3QkF2WW1ELFlBQVksQUF1WXZDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNO0FBQ3hELFdBQU07QUFBQSxBQUNQO0FBQ0MsTUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLG1DQUFtQyxDQUFDLENBQUE7QUFBQSxHQUN2RDtFQUNEO09BRUQsYUFBYSxHQUFHLFVBQUEsSUFBSTtTQUNuQixJQUFJLHdCQS9ZRyxNQUFNLEFBK1lTLEdBQ3JCLENBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBRSxHQUNqQixJQUFJLHdCQWpaVSxpQkFBaUIsQUFpWkUsR0FDakMsSUFBSSxDQUFDLFNBQVMsR0FDZCxFQUFHO0VBQUEsQ0FBQSIsImZpbGUiOiJtZXRhL2NvbXBpbGUvcHJpdmF0ZS92ZXJpZnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb2RlIH0gZnJvbSAnLi4vQ29tcGlsZUVycm9yJ1xuaW1wb3J0ICogYXMgRUV4cG9ydHMgZnJvbSAnLi4vRXhwcmVzc2lvbidcbmltcG9ydCB7IEFzc2lnbiwgQXNzaWduRGVzdHJ1Y3R1cmUsIEJsb2NrVmFsLCBDYWxsLCBEZWJ1ZywgRG8sIEdsb2JhbEFjY2VzcywgTGlzdEVudHJ5LCBMaXN0UmV0dXJuLFxuXHRMb2NhbERlY2xhcmVSZXMsIE1hcEVudHJ5LCBNYXBSZXR1cm4sIFBhdHRlcm4sIFNwZWNpYWwsIFNQX0RlYnVnZ2VyLCBVc2VEbywgWWllbGQsIFlpZWxkVG9cblx0fSBmcm9tICcuLi9FeHByZXNzaW9uJ1xuaW1wb3J0IHsgaGVhZCwgaXNFbXB0eSB9IGZyb20gJy4vVS9CYWcnXG5pbXBvcnQgeyBpZkVsc2UsIHNvbWUgfSBmcm9tICcuL1UvT3AnXG5pbXBvcnQgeyBhc3NlcnQsIGltcGxlbWVudE1hbnksIG1hcEtleXMsIG5ld1NldCB9IGZyb20gJy4vVS91dGlsJ1xuaW1wb3J0IFZyLCB7IFZyTG9jYWxJbmZvIH0gZnJvbSAnLi9WcidcblxuY29uc3Qgdm0gPSBlcyA9PiBlcy5mb3JFYWNoKGUgPT4gZS52ZXJpZnkoKSlcblxubGV0XG5cdGN4LFxuXHRsb2NhbHMsXG5cdC8vIExvY2FscyBmb3IgdGhpcyBibG9jay5cblx0Ly8gUmVwbGFjZXMgYGxvY2Fsc2Agd2hlbiBlbnRlcmluZyBpbnRvIHN1Yi1mdW5jdGlvbi5cblx0cGVuZGluZ0Jsb2NrTG9jYWxzLFxuXHRpc0luRGVidWcsXG5cdGlzSW5HZW5lcmF0b3IsXG5cdG9wTG9vcCxcblx0dnJcblxuY29uc3Rcblx0aW5pdCA9IF9jeCA9PiB7XG5cdFx0Y3ggPSBfY3hcblx0XHRsb2NhbHMgPSBuZXcgTWFwKClcblx0XHRwZW5kaW5nQmxvY2tMb2NhbHMgPSBbXVxuXHRcdGlzSW5EZWJ1ZyA9IGZhbHNlXG5cdFx0aXNJbkdlbmVyYXRvciA9IGZhbHNlXG5cdFx0b3BMb29wID0gW11cblx0XHR2ciA9IG5ldyBWcigpXG5cdH0sXG5cdC8vIFJlbGVhc2UgZm9yIGdhcmJhZ2UgY29sbGVjdGlvblxuXHR1bmluaXQgPSAoKSA9PiB7XG5cdFx0bG9jYWxzID0gcGVuZGluZ0Jsb2NrTG9jYWxzID0gb3BMb29wID0gdnIgPSB1bmRlZmluZWRcblx0fSxcblxuXHR3aXRoSW5HZW5lcmF0b3IgPSAoX2lzSW5HZW5lcmF0b3IsIGZ1bikgPT4ge1xuXHRcdGNvbnN0IGcgPSBpc0luR2VuZXJhdG9yXG5cdFx0aXNJbkdlbmVyYXRvciA9IF9pc0luR2VuZXJhdG9yXG5cdFx0ZnVuKClcblx0XHRpc0luR2VuZXJhdG9yID0gZ1xuXHR9LFxuXG5cdHBsdXNMb2NhbHMgPSAoYWRkZWRMb2NhbHMsIGZ1bikgPT4ge1xuXHRcdGNvbnN0IHNoYWRvd2VkID0gbmV3IE1hcCgpXG5cdFx0YWRkZWRMb2NhbHMuZm9yRWFjaChsID0+IHtcblx0XHRcdGNvbnN0IGdvdCA9IGxvY2Fscy5nZXQobC5uYW1lKVxuXHRcdFx0aWYgKGdvdCAhPT0gdW5kZWZpbmVkKVxuXHRcdFx0XHRzaGFkb3dlZC5zZXQobC5uYW1lLCBnb3QpXG5cdFx0XHRsb2NhbHMuc2V0KGwubmFtZSwgbClcblx0XHR9KVxuXHRcdGZ1bigpXG5cdFx0YWRkZWRMb2NhbHMuZm9yRWFjaChsID0+IHtcblx0XHRcdGNvbnN0IHMgPSBzaGFkb3dlZC5nZXQobC5uYW1lKVxuXHRcdFx0aWYgKHMgPT09IHVuZGVmaW5lZClcblx0XHRcdFx0bG9jYWxzLmRlbGV0ZShsLm5hbWUpXG5cdFx0XHRlbHNlXG5cdFx0XHRcdGxvY2Fscy5zZXQobC5uYW1lLCBzKVxuXHRcdH0pXG5cdH0sXG5cblx0cGx1c1BlbmRpbmdCbG9ja0xvY2FscyA9IChwZW5kaW5nLCBmdW4pID0+IHtcblx0XHRjb25zdCBvbGRMZW5ndGggPSBwZW5kaW5nQmxvY2tMb2NhbHMubGVuZ3RoXG5cdFx0cGVuZGluZ0Jsb2NrTG9jYWxzLnB1c2goLi4ucGVuZGluZylcblx0XHRmdW4oKVxuXHRcdHdoaWxlIChwZW5kaW5nQmxvY2tMb2NhbHMubGVuZ3RoID4gb2xkTGVuZ3RoKVxuXHRcdFx0cGVuZGluZ0Jsb2NrTG9jYWxzLnBvcCgpXG5cdH0sXG5cblx0d2l0aEluTG9vcCA9IChsb29wLCBmdW4pID0+IHtcblx0XHRjb25zdCBsID0gb3BMb29wXG5cdFx0b3BMb29wID0gc29tZShsb29wKVxuXHRcdGZ1bigpXG5cdFx0b3BMb29wID0gbFxuXHR9LFxuXG5cdHdpdGhJbkRlYnVnID0gKF9pc0luRGVidWcsIGZ1bikgPT4ge1xuXHRcdGNvbnN0IGQgPSBpc0luRGVidWdcblx0XHRpc0luRGVidWcgPSBfaXNJbkRlYnVnXG5cdFx0ZnVuKClcblx0XHRpc0luRGVidWcgPSBkXG5cdH0sXG5cblx0d2l0aEJsb2NrTG9jYWxzID0gZnVuID0+IHtcblx0XHRjb25zdCBibCA9IHBlbmRpbmdCbG9ja0xvY2Fsc1xuXHRcdHBlbmRpbmdCbG9ja0xvY2FscyA9IFtdXG5cdFx0cGx1c0xvY2FscyhibCwgZnVuKVxuXHRcdHBlbmRpbmdCbG9ja0xvY2FscyA9IGJsXG5cdH0sXG5cblx0YWNjZXNzTG9jYWwgPSAoZGVjbGFyZSwgYWNjZXNzLCBpc0RlYnVnQWNjZXNzKSA9PlxuXHRcdF9hZGRBY2Nlc3ModnIubG9jYWxUb0luZm8uZ2V0KGRlY2xhcmUpLCBhY2Nlc3MsIGlzRGVidWdBY2Nlc3MpLFxuXHRhY2Nlc3NMb2NhbEZvclJldHVybiA9IChkZWNsYXJlLCBhY2Nlc3MpID0+IHtcblx0XHRjb25zdCBpbmZvID0gdnIubG9jYWxUb0luZm8uZ2V0KGRlY2xhcmUpXG5cdFx0X2FkZEFjY2VzcyhpbmZvLCBhY2Nlc3MsIGluZm8uaXNJbkRlYnVnKVxuXHR9LFxuXHRfYWRkQWNjZXNzID0gKGxvY2FsSW5mbywgYWNjZXNzLCBpc0RlYnVnQWNjZXNzKSA9PlxuXHRcdChpc0RlYnVnQWNjZXNzID8gbG9jYWxJbmZvLmRlYnVnQWNjZXNzZXMgOiBsb2NhbEluZm8ubm9uRGVidWdBY2Nlc3NlcykucHVzaChhY2Nlc3MpLFxuXG5cblx0Ly8gVnIgc2V0dGVyc1xuXHRzZXRFbmRMb29wID0gKGVuZExvb3AsIGxvb3ApID0+IHtcblx0XHR2ci5lbmRMb29wVG9Mb29wLnNldChlbmRMb29wLCBsb29wKVxuXHR9LFxuXG5cdHJlZ2lzdGVyTG9jYWwgPSBsb2NhbCA9PiB7XG5cdFx0dnIubG9jYWxUb0luZm8uc2V0KGxvY2FsLCBWckxvY2FsSW5mbyhcdGlzSW5EZWJ1ZywgW10sIFtdKSlcblx0fSxcblxuXHRzZXRFbnRyeUluZGV4ID0gKGxpc3RNYXBFbnRyeSwgaW5kZXgpID0+IHtcblx0XHR2ci5lbnRyeVRvSW5kZXguc2V0KGxpc3RNYXBFbnRyeSwgaW5kZXgpXG5cdH0sXG5cblx0bWF5YmVTZXRMaXN0TWFwTGVuZ3RoID0gKHJldHVybmVyLCBsZW5ndGgpID0+IHtcblx0XHRpZiAocmV0dXJuZXIgaW5zdGFuY2VvZiBMaXN0UmV0dXJuIHx8IHJldHVybmVyIGluc3RhbmNlb2YgTWFwUmV0dXJuKVxuXHRcdFx0dnIucmV0dXJuVG9MZW5ndGguc2V0KHJldHVybmVyLCBsZW5ndGgpXG5cdFx0ZWxzZVxuXHRcdFx0YXNzZXJ0KGxlbmd0aCA9PT0gMClcblx0fVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiB2ZXJpZnkoY3gsIGUpIHtcblx0aW5pdChjeClcblx0ZS52ZXJpZnkoKVxuXHR2ZXJpZnlMb2NhbFVzZSgpXG5cdGNvbnN0IG91dCA9IHZyXG5cdHVuaW5pdCgpXG5cdHJldHVybiBvdXRcbn1cblxuY29uc3QgdmVyaWZ5TG9jYWxVc2UgPSAoKSA9PiB7XG5cdHZyLmxvY2FsVG9JbmZvLmZvckVhY2goKGluZm8sIGxvY2FsKSA9PiB7XG5cdFx0aWYgKCEobG9jYWwgaW5zdGFuY2VvZiBMb2NhbERlY2xhcmVSZXMpKSB7XG5cdFx0XHRjb25zdCBub05vbkRlYnVnID0gaXNFbXB0eShpbmZvLm5vbkRlYnVnQWNjZXNzZXMpXG5cdFx0XHRpZiAobm9Ob25EZWJ1ZyAmJiBpc0VtcHR5KGluZm8uZGVidWdBY2Nlc3NlcykpXG5cdFx0XHRcdGN4Lndhcm4obG9jYWwubG9jLCAoKSA9PiBgVW51c2VkIGxvY2FsIHZhcmlhYmxlICR7Y29kZShsb2NhbC5uYW1lKX0uYClcblx0XHRcdGVsc2UgaWYgKGluZm8uaXNJbkRlYnVnKVxuXHRcdFx0XHRjeC53YXJuSWYoIW5vTm9uRGVidWcsICgpID0+IGhlYWQoaW5mby5ub25EZWJ1Z0FjY2Vzc2VzKS5sb2MsICgpID0+XG5cdFx0XHRcdFx0YERlYnVnLW9ubHkgbG9jYWwgJHtjb2RlKGxvY2FsLm5hbWUpfSB1c2VkIG91dHNpZGUgb2YgZGVidWcuYClcblx0XHRcdGVsc2Vcblx0XHRcdFx0Y3gud2FybklmKG5vTm9uRGVidWcsIGxvY2FsLmxvYywgKCkgPT5cblx0XHRcdFx0XHRgTG9jYWwgJHtjb2RlKGxvY2FsLm5hbWUpfSB1c2VkIG9ubHkgaW4gZGVidWcuYClcblx0XHR9XG5cdH0pXG59XG5cbmltcGxlbWVudE1hbnkoRUV4cG9ydHMsICd2ZXJpZnknLCB7XG5cdEFzc2lnbigpIHtcblx0XHRjb25zdCBkb1YgPSAoKSA9PiB7XG5cdFx0XHR0aGlzLmFzc2lnbmVlLnZlcmlmeSgpXG5cdFx0XHR0aGlzLnZhbHVlLnZlcmlmeSgpXG5cdFx0fVxuXHRcdGlmICh0aGlzLmFzc2lnbmVlLmlzTGF6eSlcblx0XHRcdHdpdGhCbG9ja0xvY2Fscyhkb1YpXG5cdFx0ZWxzZVxuXHRcdFx0ZG9WKClcblx0fSxcblx0QmxvY2tEbygpIHsgdmVyaWZ5TGluZXModGhpcy5saW5lcykgfSxcblx0QmxvY2tWYWwoKSB7XG5cdFx0Y29uc3QgeyBuZXdMb2NhbHMsIGxpc3RNYXBMZW5ndGggfSA9IHZlcmlmeUxpbmVzKHRoaXMubGluZXMpXG5cdFx0bWF5YmVTZXRMaXN0TWFwTGVuZ3RoKHRoaXMucmV0dXJuZWQsIGxpc3RNYXBMZW5ndGgpXG5cdFx0cGx1c0xvY2FscyhuZXdMb2NhbHMsICgpID0+IHRoaXMucmV0dXJuZWQudmVyaWZ5KCkpXG5cdH0sXG5cdEJsb2NrV3JhcCgpIHtcblx0XHR0aGlzLmJsb2NrLnZlcmlmeSgpXG5cdH0sXG5cdENhc2VEbzogdmVyaWZ5Q2FzZSxcblx0Q2FzZVZhbDogdmVyaWZ5Q2FzZSxcblx0Ly8gT25seSByZWFjaCBoZXJlIGZvciBpbi9vdXQgY29uZGl0aW9uXG5cdERlYnVnKCkgeyB2ZXJpZnlMaW5lcyhbIHRoaXMgXSkgfSxcblx0RW5kTG9vcCgpIHtcblx0XHRpZkVsc2Uob3BMb29wLFxuXHRcdFx0bG9vcCA9PiBzZXRFbmRMb29wKHRoaXMsIGxvb3ApLFxuXHRcdFx0KCkgPT4gY3guZmFpbCh0aGlzLmxvYywgJ05vdCBpbiBhIGxvb3AuJykpXG5cdH0sXG5cdEZ1bigpIHtcblx0XHR3aXRoQmxvY2tMb2NhbHMoKCkgPT4ge1xuXHRcdFx0Y3guY2hlY2soaXNFbXB0eSh0aGlzLm9wUmVzRGVjbGFyZSkgfHwgdGhpcy5ibG9jayBpbnN0YW5jZW9mIEJsb2NrVmFsLCB0aGlzLmxvYyxcblx0XHRcdFx0J0Z1bmN0aW9uIHdpdGggcmV0dXJuIGNvbmRpdGlvbiBtdXN0IHJldHVybiBzb21ldGhpbmcuJylcblx0XHRcdHRoaXMuYXJncy5mb3JFYWNoKGFyZyA9PiB2bShhcmcub3BUeXBlKSlcblx0XHRcdHdpdGhJbkdlbmVyYXRvcih0aGlzLmlzR2VuZXJhdG9yLCAoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGFsbEFyZ3MgPSB0aGlzLmFyZ3MuY29uY2F0KHRoaXMub3BSZXN0QXJnKVxuXHRcdFx0XHRhbGxBcmdzLmZvckVhY2goXyA9PiByZWdpc3RlckxvY2FsKF8pKVxuXHRcdFx0XHRwbHVzTG9jYWxzKGFsbEFyZ3MsICgpID0+IHtcblx0XHRcdFx0XHR2bSh0aGlzLm9wSW4pXG5cdFx0XHRcdFx0dGhpcy5ibG9jay52ZXJpZnkoKVxuXHRcdFx0XHRcdHRoaXMub3BSZXNEZWNsYXJlLmZvckVhY2gocmQgPT4ge1xuXHRcdFx0XHRcdFx0cmQudmVyaWZ5KClcblx0XHRcdFx0XHRcdHJlZ2lzdGVyTG9jYWwocmQpXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHR0aGlzLm9wT3V0LmZvckVhY2gobyA9PiBwbHVzTG9jYWxzKHRoaXMub3BSZXNEZWNsYXJlLCAoKSA9PiBvLnZlcmlmeSgpKSlcblx0XHRcdFx0fSlcblx0XHRcdH0pXG5cdFx0fSlcblx0fSxcblx0TG9jYWxBY2Nlc3MoKSB7XG5cdFx0Y29uc3QgZGVjbGFyZSA9IGxvY2Fscy5nZXQodGhpcy5uYW1lKVxuXHRcdGN4LmNoZWNrKGRlY2xhcmUgIT09IHVuZGVmaW5lZCwgdGhpcy5sb2MsICgpID0+XG5cdFx0XHRgTm8gc3VjaCBsb2NhbCAke2NvZGUodGhpcy5uYW1lKX0uXFxuTG9jYWxzIGFyZTpcXG4ke2NvZGUobWFwS2V5cyhsb2NhbHMpLmpvaW4oJyAnKSl9LmApXG5cdFx0dnIuYWNjZXNzVG9Mb2NhbC5zZXQodGhpcywgZGVjbGFyZSlcblx0XHRhY2Nlc3NMb2NhbChkZWNsYXJlLCB0aGlzLCBpc0luRGVidWcpXG5cdH0sXG5cdExvb3AoKSB7IHdpdGhJbkxvb3AodGhpcywgKCkgPT4gdGhpcy5ibG9jay52ZXJpZnkoKSkgfSxcblx0Ly8gQWRkaW5nIExvY2FsRGVjbGFyZXMgdG8gdGhlIGF2YWlsYWJsZSBsb2NhbHMgaXMgZG9uZSBieSBGdW4gb3IgbGluZU5ld0xvY2Fscy5cblx0TG9jYWxEZWNsYXJlKCkgeyB2bSh0aGlzLm9wVHlwZSkgfSxcblx0TWFwRW50cnkoKSB7XG5cdFx0dGhpcy5rZXkudmVyaWZ5KClcblx0XHR0aGlzLnZhbC52ZXJpZnkoKVxuXHR9LFxuXHRNb2R1bGUoKSB7XG5cdFx0Y29uc3QgdXNlTG9jYWxzID0gdmVyaWZ5VXNlcyh0aGlzLnVzZXMsIHRoaXMuZGVidWdVc2VzKVxuXHRcdHBsdXNMb2NhbHModXNlTG9jYWxzLCAoKSA9PiB7XG5cdFx0XHRjb25zdCB7IG5ld0xvY2FscywgbGlzdE1hcExlbmd0aCB9ID0gdmVyaWZ5TGluZXModGhpcy5saW5lcylcblx0XHRcdHRoaXMuZXhwb3J0cy5mb3JFYWNoKGV4ID0+IGFjY2Vzc0xvY2FsRm9yUmV0dXJuKGV4LCB0aGlzKSlcblx0XHRcdHRoaXMub3BEZWZhdWx0RXhwb3J0LmZvckVhY2goZGVmID0+IHtcblx0XHRcdFx0bWF5YmVTZXRMaXN0TWFwTGVuZ3RoKGRlZiwgbGlzdE1hcExlbmd0aClcblx0XHRcdFx0cGx1c0xvY2FscyhuZXdMb2NhbHMsICgpID0+IGRlZi52ZXJpZnkoKSlcblx0XHRcdH0pXG5cdFx0fSlcblxuXHRcdGNvbnN0IGV4cG9ydHMgPSBuZXdTZXQodGhpcy5leHBvcnRzKVxuXHRcdGNvbnN0IG1hcmtFeHBvcnRMaW5lcyA9IGxpbmUgPT4ge1xuXHRcdFx0aWYgKGxpbmUgaW5zdGFuY2VvZiBBc3NpZ24gJiYgZXhwb3J0cy5oYXMobGluZS5hc3NpZ25lZSkgfHxcblx0XHRcdFx0bGluZSBpbnN0YW5jZW9mIEFzc2lnbkRlc3RydWN0dXJlICYmIGxpbmUuYXNzaWduZWVzLnNvbWUoXyA9PiBleHBvcnRzLmhhcyhfKSkpXG5cdFx0XHRcdHZyLmV4cG9ydEFzc2lnbnMuYWRkKGxpbmUpXG5cdFx0XHRlbHNlIGlmIChsaW5lIGluc3RhbmNlb2YgRGVidWcpXG5cdFx0XHRcdGxpbmUubGluZXMuZm9yRWFjaChtYXJrRXhwb3J0TGluZXMpXG5cdFx0fVxuXHRcdHRoaXMubGluZXMuZm9yRWFjaChtYXJrRXhwb3J0TGluZXMpXG5cdH0sXG5cdE9ialJldHVybigpIHtcblx0XHR2bSh0aGlzLm9wT2JqZWQpXG5cdFx0dGhpcy5rZXlzLmZvckVhY2goa2V5ID0+IGFjY2Vzc0xvY2FsRm9yUmV0dXJuKGtleSwgdGhpcykpXG5cdH0sXG5cdFlpZWxkKCkge1xuXHRcdGN4LmNoZWNrKGlzSW5HZW5lcmF0b3IsIHRoaXMubG9jLCAnQ2Fubm90IHlpZWxkIG91dHNpZGUgb2YgZ2VuZXJhdG9yIGNvbnRleHQnKVxuXHRcdHRoaXMueWllbGRlZC52ZXJpZnkoKVxuXHR9LFxuXHRZaWVsZFRvKCkge1xuXHRcdGN4LmNoZWNrKGlzSW5HZW5lcmF0b3IsIHRoaXMubG9jLCAnQ2Fubm90IHlpZWxkIG91dHNpZGUgb2YgZ2VuZXJhdG9yIGNvbnRleHQnKVxuXHRcdHRoaXMueWllbGRlZFRvLnZlcmlmeSgpXG5cdH0sXG5cblx0Ly8gVGhlc2Ugb25lcyBqdXN0IHJlY3Vyc2UgdG8gdGhlaXIgY2hpbGRyZW4uXG5cdEFzc2lnbkRlc3RydWN0dXJlKCkge1xuXHRcdHRoaXMudmFsdWUudmVyaWZ5KClcblx0XHR2bSh0aGlzLmFzc2lnbmVlcylcblx0fSxcblx0Q2FsbCgpIHtcblx0XHR0aGlzLmNhbGxlZC52ZXJpZnkoKVxuXHRcdHZtKHRoaXMuYXJncylcblx0fSxcblx0Q2FzZURvUGFydDogdmVyaWZ5Q2FzZVBhcnQsXG5cdENhc2VWYWxQYXJ0OiB2ZXJpZnlDYXNlUGFydCxcblx0R2xvYmFsQWNjZXNzKCkgeyB9LFxuXHRPYmpTaW1wbGUoKSB7XG5cdFx0Y29uc3Qga2V5cyA9IG5ldyBTZXQoKVxuXHRcdHRoaXMucGFpcnMuZm9yRWFjaChwYWlyID0+IHtcblx0XHRcdGN4LmNoZWNrKCFrZXlzLmhhcyhwYWlyLmtleSksIHBhaXIubG9jLCAoKSA9PiBgRHVwbGljYXRlIGtleSAke3BhaXIua2V5fWApXG5cdFx0XHRrZXlzLmFkZChwYWlyLmtleSlcblx0XHRcdHBhaXIudmFsdWUudmVyaWZ5KClcblx0XHR9KVxuXHR9LFxuXHRMYXp5KCkgeyB3aXRoQmxvY2tMb2NhbHMoKCkgPT4gdGhpcy52YWx1ZS52ZXJpZnkoKSkgfSxcblx0TGlzdFJldHVybigpIHsgfSxcblx0TGlzdEVudHJ5KCkgeyB0aGlzLnZhbHVlLnZlcmlmeSgpIH0sXG5cdExpc3RTaW1wbGUoKSB7IHZtKHRoaXMucGFydHMpIH0sXG5cdE51bWJlckxpdGVyYWwoKSB7IH0sXG5cdE1hcFJldHVybigpIHsgfSxcblx0TWVtYmVyKCkgeyB0aGlzLm9iamVjdC52ZXJpZnkoKSB9LFxuXHRRdW90ZSgpIHtcblx0XHR0aGlzLnBhcnRzLmZvckVhY2goXyA9PiB7XG5cdFx0XHRpZiAodHlwZW9mIF8gIT09ICdzdHJpbmcnKVxuXHRcdFx0XHRfLnZlcmlmeSgpXG5cdFx0fSlcblx0fSxcblx0U3BlY2lhbCgpIHsgfSxcblx0U3BsYXQoKSB7IHRoaXMuc3BsYXR0ZWQudmVyaWZ5KCkgfVxufSlcblxuZnVuY3Rpb24gdmVyaWZ5Q2FzZSgpIHtcblx0Y29uc3QgbmV3TG9jYWxzID0gW11cblx0dGhpcy5vcENhc2VkLmZvckVhY2goY2FzZWQgPT4ge1xuXHRcdHJlZ2lzdGVyTG9jYWwoY2FzZWQuYXNzaWduZWUpXG5cdFx0Y2FzZWQudmVyaWZ5KClcblx0XHRuZXdMb2NhbHMucHVzaChjYXNlZC5hc3NpZ25lZSlcblx0fSlcblx0cGx1c0xvY2FscyhuZXdMb2NhbHMsICgpID0+IHtcblx0XHR2bSh0aGlzLnBhcnRzKVxuXHRcdHZtKHRoaXMub3BFbHNlKVxuXHR9KVxufVxuXG5mdW5jdGlvbiB2ZXJpZnlDYXNlUGFydCgpIHtcblx0aWYgKHRoaXMudGVzdCBpbnN0YW5jZW9mIFBhdHRlcm4pIHtcblx0XHR0aGlzLnRlc3QudHlwZS52ZXJpZnkoKVxuXHRcdHRoaXMudGVzdC5wYXR0ZXJuZWQudmVyaWZ5KClcblx0XHR2bSh0aGlzLnRlc3QubG9jYWxzKVxuXHRcdHRoaXMudGVzdC5sb2NhbHMuZm9yRWFjaChyZWdpc3RlckxvY2FsKVxuXHRcdHBsdXNMb2NhbHModGhpcy50ZXN0LmxvY2FscywgKCkgPT4gdGhpcy5yZXN1bHQudmVyaWZ5KCkpXG5cdH0gZWxzZSB7XG5cdFx0dGhpcy50ZXN0LnZlcmlmeSgpXG5cdFx0dGhpcy5yZXN1bHQudmVyaWZ5KClcblx0fVxufVxuXG5jb25zdFxuXHR2ZXJpZnlVc2VzID0gKHVzZXMsIGRlYnVnVXNlcykgPT4ge1xuXHRcdGNvbnN0IHVzZUxvY2FscyA9IFtdXG5cdFx0Y29uc3Rcblx0XHRcdHZlcmlmeVVzZSA9IHVzZSA9PiB7XG5cdFx0XHRcdHVzZS51c2VkLmZvckVhY2godXNlTG9jYWwpXG5cdFx0XHRcdHVzZS5vcFVzZURlZmF1bHQuZm9yRWFjaCh1c2VMb2NhbClcblx0XHRcdH0sXG5cdFx0XHR1c2VMb2NhbCA9IF8gPT4ge1xuXHRcdFx0XHRyZWdpc3RlckxvY2FsKF8pXG5cdFx0XHRcdHVzZUxvY2Fscy5wdXNoKF8pXG5cdFx0XHR9XG5cdFx0dXNlcy5mb3JFYWNoKHVzZSA9PiB7XG5cdFx0XHRpZiAoISh1c2UgaW5zdGFuY2VvZiBVc2VEbykpIHZlcmlmeVVzZSh1c2UpXG5cdFx0fSlcblx0XHR3aXRoSW5EZWJ1Zyh0cnVlLCAoKSA9PiBkZWJ1Z1VzZXMuZm9yRWFjaCh2ZXJpZnlVc2UpKVxuXHRcdHJldHVybiB1c2VMb2NhbHNcblx0fSxcblxuXHR2ZXJpZnlMaW5lcyA9IGxpbmVzID0+IHtcblx0XHRjb25zdCBuZXdMb2NhbHMgPSBbIF1cblx0XHQvLyBGaXJzdCwgZ2V0IGxvY2FscyBmb3IgdGhlIHdob2xlIGJsb2NrLlxuXHRcdGNvbnN0IGdldExpbmVMb2NhbHMgPSBsaW5lID0+IHtcblx0XHRcdGlmIChsaW5lIGluc3RhbmNlb2YgRGVidWcpXG5cdFx0XHRcdHdpdGhJbkRlYnVnKHRydWUsICgpID0+IGxpbmUubGluZXMuZm9yRWFjaChnZXRMaW5lTG9jYWxzKSlcblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRjb25zdCBuZXdzID0gbGluZU5ld0xvY2FscyhsaW5lKVxuXHRcdFx0XHRuZXdzLmZvckVhY2gocmVnaXN0ZXJMb2NhbClcblx0XHRcdFx0bmV3TG9jYWxzLnB1c2goLi4ubmV3cylcblx0XHRcdH1cblx0XHR9XG5cblx0XHRsaW5lcy5mb3JFYWNoKGdldExpbmVMb2NhbHMpXG5cblx0XHRjb25zdCB0aGlzQmxvY2tMb2NhbE5hbWVzID0gbmV3IFNldCgpXG5cdFx0Y29uc3Qgc2hhZG93ZWQgPSBuZXcgTWFwKClcblxuXHRcdGxldCBsaXN0TWFwTGVuZ3RoID0gMFxuXG5cdFx0Y29uc3QgdmVyaWZ5TGluZSA9IGxpbmUgPT4ge1xuXHRcdFx0aWYgKGxpbmUgaW5zdGFuY2VvZiBEZWJ1Zylcblx0XHRcdFx0Ly8gVE9ETzogRG8gYW55dGhpbmcgaW4gdGhpcyBzaXR1YXRpb24/XG5cdFx0XHRcdC8vIGN4LmNoZWNrKCFpbkRlYnVnLCBsaW5lLmxvYywgJ1JlZHVuZGFudCBgZGVidWdgLicpXG5cdFx0XHRcdHdpdGhJbkRlYnVnKHRydWUsICgpID0+IGxpbmUubGluZXMuZm9yRWFjaCh2ZXJpZnlMaW5lKSlcblx0XHRcdGVsc2Uge1xuXHRcdFx0XHR2ZXJpZnlJc1N0YXRlbWVudChsaW5lKVxuXHRcdFx0XHRsaW5lTmV3TG9jYWxzKGxpbmUpLmZvckVhY2gobCA9PiB7XG5cdFx0XHRcdFx0Y29uc3QgZ290ID0gbG9jYWxzLmdldChsLm5hbWUpXG5cdFx0XHRcdFx0aWYgKGdvdCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0XHRjeC5jaGVjayghdGhpc0Jsb2NrTG9jYWxOYW1lcy5oYXMobC5uYW1lKSwgbC5sb2MsXG5cdFx0XHRcdFx0XHRcdCgpID0+IGBBIGxvY2FsICR7Y29kZShsLm5hbWUpfSBpcyBhbHJlYWR5IGluIHRoaXMgYmxvY2suYClcblx0XHRcdFx0XHRcdHNoYWRvd2VkLnNldChsLm5hbWUsIGdvdClcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0bG9jYWxzLnNldChsLm5hbWUsIGwpXG5cdFx0XHRcdFx0dGhpc0Jsb2NrTG9jYWxOYW1lcy5hZGQobC5uYW1lKVxuXHRcdFx0XHR9KVxuXHRcdFx0XHRpZiAobGluZSBpbnN0YW5jZW9mIExpc3RFbnRyeSB8fCBsaW5lIGluc3RhbmNlb2YgTWFwRW50cnkpIHtcblx0XHRcdFx0XHRzZXRFbnRyeUluZGV4KGxpbmUsIGxpc3RNYXBMZW5ndGgpXG5cdFx0XHRcdFx0bGlzdE1hcExlbmd0aCA9IGxpc3RNYXBMZW5ndGggKyAxXG5cdFx0XHRcdH1cblx0XHRcdFx0bGluZS52ZXJpZnkoKVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHBsdXNQZW5kaW5nQmxvY2tMb2NhbHMobmV3TG9jYWxzLCAoKSA9PiBsaW5lcy5mb3JFYWNoKHZlcmlmeUxpbmUpKVxuXG5cdFx0bmV3TG9jYWxzLmZvckVhY2gobCA9PiB7XG5cdFx0XHRjb25zdCBzID0gc2hhZG93ZWQuZ2V0KGwubmFtZSlcblx0XHRcdGlmIChzID09PSB1bmRlZmluZWQpXG5cdFx0XHRcdGxvY2Fscy5kZWxldGUobC5uYW1lKVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHRsb2NhbHMuc2V0KGwubmFtZSwgcylcblx0XHR9KVxuXG5cdFx0cmV0dXJuIHsgbmV3TG9jYWxzLCBsaXN0TWFwTGVuZ3RoIH1cblx0fSxcblxuXHR2ZXJpZnlJc1N0YXRlbWVudCA9IGxpbmUgPT4ge1xuXHRcdHN3aXRjaCAodHJ1ZSkge1xuXHRcdFx0Y2FzZSBsaW5lIGluc3RhbmNlb2YgRG86XG5cdFx0XHQvLyBTb21lIFZhbHMgYXJlIGFsc28gY29uY2VwdHVhbGx5IERvcywgYnV0IHRoaXMgd2FzIGVhc2llciB0aGFuIG11bHRpcGxlIGluaGVyaXRhbmNlLlxuXHRcdFx0Y2FzZSBsaW5lIGluc3RhbmNlb2YgQ2FsbDpcblx0XHRcdGNhc2UgbGluZSBpbnN0YW5jZW9mIFlpZWxkOlxuXHRcdFx0Y2FzZSBsaW5lIGluc3RhbmNlb2YgWWllbGRUbzpcblx0XHRcdGNhc2UgbGluZSBpbnN0YW5jZW9mIFNwZWNpYWwgJiYgbGluZS5rID09PSBTUF9EZWJ1Z2dlcjpcblx0XHRcdC8vIE9LLCB1c2VkIHRvIG1lYW4gYHBhc3NgXG5cdFx0XHRjYXNlIGxpbmUgaW5zdGFuY2VvZiBHbG9iYWxBY2Nlc3MgJiYgbGluZS5uYW1lID09PSAnbnVsbCc6XG5cdFx0XHRcdHJldHVyblxuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0Y3guZmFpbChsaW5lLmxvYywgJ0V4cHJlc3Npb24gaW4gc3RhdGVtZW50IHBvc2l0aW9uLicpXG5cdFx0fVxuXHR9LFxuXG5cdGxpbmVOZXdMb2NhbHMgPSBsaW5lID0+XG5cdFx0bGluZSBpbnN0YW5jZW9mIEFzc2lnbiA/XG5cdFx0XHRbIGxpbmUuYXNzaWduZWUgXSA6XG5cdFx0XHRsaW5lIGluc3RhbmNlb2YgQXNzaWduRGVzdHJ1Y3R1cmUgP1xuXHRcdFx0bGluZS5hc3NpZ25lZXMgOlxuXHRcdFx0WyBdXG4iXSwic291cmNlUm9vdCI6Ii9zcmMifQ==