{"version":3,"sources":["meta/compile/private/parse/parseExpr.js"],"names":[],"mappings":"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","file":"meta/compile/private/parse/parseExpr.js","sourcesContent":["import { Assign, Call, GlobalAccess, ObjReturn, ObjSimple, Yield, YieldTo } from '../../Expression'\nimport { Keyword } from '../Token'\nimport type from '../U/type'\nimport { assert, lazy } from '../U/util'\nimport { GeneratorKeywords, KFun } from '../Lang'\nimport { ifElse } from '../U/Op'\nimport { cons, head, isEmpty, last, push, rtail, tail } from '../U/Bag'\nimport parseFun from './parseFun'\nimport { parseLocalDeclare } from './parseLocalDeclares'\nimport parseSingle from './parseSingle'\nimport Px from './Px'\n// TODO:ES6\nimport * as PC from './parseCase'\n\nexport default function parseExpr(px) {\n\treturn ifElse(px.tokens.opSplitManyWhere(Keyword.isObjAssign),\n\t\tsplits => {\n\t\t\t// Short object form, such as (a. 1, b. 2)\n\t\t\tconst first = splits[0].before\n\t\t\tconst tokensCaller = first.rtail()\n\n\t\t\tconst keysVals = {}\n\t\t\tfor (let i = 0; i < splits.length - 1; i = i + 1) {\n\t\t\t\tconst local = px.wt(splits[i].before.last(), parseLocalDeclare)\n\t\t\t\t// Can't have got a type because there's only one token.\n\t\t\t\tassert(isEmpty(local.opType))\n\t\t\t\tconst tokensValue = i === splits.length - 2 ?\n\t\t\t\t\tsplits[i + 1].before :\n\t\t\t\t\tsplits[i + 1].before.rtail()\n\t\t\t\tconst value = px.w(tokensValue, parseExprPlain)\n\t\t\t\tpx.check(!Object.prototype.hasOwnProperty.call(keysVals, local.name),\n\t\t\t\t\tlocal.loc, () => `Duplicate property ${local}.`)\n\t\t\t\tObject.defineProperty(keysVals, local.name, { value })\n\t\t\t}\n\t\t\tassert(last(splits).at === undefined)\n\t\t\tconst val = ObjSimple(px.loc, keysVals)\n\t\t\tif (tokensCaller.isEmpty())\n\t\t\t\treturn val\n\t\t\telse {\n\t\t\t\tconst parts = px.w(tokensCaller, parseExprParts)\n\t\t\t\tassert(!isEmpty(parts))\n\t\t\t\treturn Call(px.loc, head(parts), push(tail(parts), val))\n\t\t\t}\n\t\t},\n\t\t() => parseExprPlain(px)\n\t)\n}\n\nfunction parseExprPlain(px) {\n\ttype(px, Px)\n\tconst parts = parseExprParts(px)\n\tswitch (parts.length) {\n\t\tcase 0:\n\t\t\treturn GlobalAccess.null(px.loc)\n\t\tcase 1:\n\t\t\treturn head(parts)\n\t\tdefault:\n\t\t\treturn Call(px.loc, head(parts), tail(parts))\n\t}\n}\n\nexport function parseExprParts(px) {\n\tconst out = []\n\tconst end = px.tokens.end\n\tfor (let i = px.tokens.start; i < end; i = i + 1) {\n\t\tconst here = px.tokens.data[i]\n\t\tif (here instanceof Keyword) {\n\t\t\tconst rest = () => px.tokens._new(i + 1, end)\n\t\t\tswitch (here.k) {\n\t\t\t\tcase '|': case '~|':\n\t\t\t\t\treturn push(out, px.w(rest(), parseFun, here.k))\n\t\t\t\tcase 'case':\n\t\t\t\t\treturn push(out, px.w(rest(), PC.parseCase, 'case', false))\n\t\t\t\tcase '<~':\n\t\t\t\t\treturn push(out, Yield(px.loc, px.w(rest(), parseExpr)))\n\t\t\t\tcase '<~~':\n\t\t\t\t\treturn push(out, YieldTo(px.loc, px.w(rest(), parseExpr)))\n\t\t\t\tdefault:\n\t\t\t\t\t// fallthrough\n\t\t\t}\n\t\t}\n\t\tout.push(px.wt(here, parseSingle))\n\t}\n\treturn out\n}\n"],"sourceRoot":"/src"}