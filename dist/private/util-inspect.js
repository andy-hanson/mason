if (typeof define !== 'function') var define = require('amdefine')(module);define(['exports', 'module'], function (exports, module) {
	'use strict';

	const inspect = (obj, opts) => {
		// default options
		let ctx = {
			seen: new Set()
		};
		if (opts) Object.assign(ctx, opts);
		// set default options
		if (ctx.showHidden === undefined) ctx.showHidden = false;
		if (ctx.depth === undefined) ctx.depth = 2;
		if (ctx.customInspect === undefined) ctx.customInspect = true;
		return formatValue(ctx, obj, ctx.depth);
	};
	module.exports = inspect;

	const getConstructorOf = obj => {
		while (obj) {
			let descriptor = Object.getOwnPropertyDescriptor(obj, 'constructor');
			if (descriptor !== undefined && typeof descriptor.value === 'function' && descriptor.value.name !== '') return descriptor.value;

			obj = Object.getPrototypeOf(obj);
		}

		return null;
	},
	      inspectPromise = () => {
		//TODO: this was using Debug...
		return null;
	};

	const formatValue = (ctx, value, recurseTimes) => {
		// Provide a hook for user-specified inspect functions.
		// Check that value is an object with an inspect function on it
		if (ctx.customInspect && value && typeof value.inspect === 'function' &&
		// Filter out the util module, it's inspect function is special
		value.inspect !== inspect &&
		// Also filter out any prototype objects using the circular check.
		!(value.constructor && value.constructor.prototype === value)) {
			let ret = value.inspect(recurseTimes, ctx);
			if (typeof ret !== 'string') ret = formatValue(ctx, ret, recurseTimes);
			return ret;
		}

		// Primitive types cannot have properties
		let primitive = formatPrimitive(ctx, value);
		if (primitive) return primitive;

		// Look up the keys of the object.
		let keys = Object.keys(value);
		let visibleKeys = new Set(keys);

		if (ctx.showHidden) {
			keys = Object.getOwnPropertyNames(value);
			keys = keys.concat(Object.getOwnPropertySymbols(value));
		}

		// This could be a boxed primitive (new String(), etc.), check valueOf()
		// NOTE: Avoid calling `valueOf` on `Date` instance because it will return
		// a number which, when object has some additional user-stored `keys`,
		// will be printed out.
		let formatted;
		let raw = value;
		try {
			// the .valueOf() call can fail for a multitude of reasons
			if (!isDate(value)) raw = value.valueOf();
		} catch (e) {
			// ignore...
		}

		if (typeof raw === 'string')
			// for boxed Strings, we have to remove the 0-n indexed entries,
			// since they just noisey up the output and are redundant
			keys = keys.filter(key => !(key >= 0 && key < raw.length));

		// Some type of object without properties can be shortcutted.
		if (keys.length === 0) {
			if (typeof value === 'function') return `[Function${ value.name ? `: ${ value.name }` : '' }]`;
			if (isRegExp(value)) return RegExp.prototype.toString.call(value);
			if (isDate(value)) return Date.prototype.toString.call(value);
			if (isError(value)) return formatError(value);
			// now check the `raw` value to handle boxed primitives
			if (typeof raw === 'string') return `[String: ${ formatPrimitive(ctx, raw) }]`;
			if (typeof raw === 'number') return `[Number: ${ formatPrimitive(ctx, raw) }]`;
			if (typeof raw === 'boolean') return `[Boolean: ${ formatPrimitive(ctx, raw) }]`;
		}

		let constructor = getConstructorOf(value);
		let base = '',
		    empty = false,
		    braces,
		    formatter;

		if (Array.isArray(value)) {
			if (constructor === Array) constructor = null;
			braces = ['[', ']'];
			empty = value.length === 0;
			formatter = formatArray;
		} else if (value instanceof Set) {
			braces = ['{', '}'];
			// With `showHidden`, `length` will display as a hidden property for
			// arrays. For consistency's sake, do the same for `size`, even though this
			// property isn't selected by Object.getOwnPropertyNames().
			if (ctx.showHidden) keys.unshift('size');
			empty = value.size === 0;
			formatter = formatSet;
		} else if (value instanceof Map) {
			braces = ['{', '}'];
			// Ditto.
			if (ctx.showHidden) keys.unshift('size');
			empty = value.size === 0;
			formatter = formatMap;
		} else {
			// Only create a mirror if the object superficially looks like a Promise.
			let promiseInternals = value instanceof Promise && inspectPromise(value);
			if (promiseInternals) {
				braces = ['{', '}'];
				formatter = formatPromise;
			} else {
				if (constructor === Object) constructor = null;
				braces = ['{', '}'];
				empty = true; // No other data than keys.
				formatter = formatObject;
			}
		}

		empty = empty === true && keys.length === 0;

		// Make functions say that they are functions
		if (typeof value === 'function') {
			let n = value.name ? ': ' + value.name : '';
			base = ' [Function' + n + ']';
		}

		// Make RegExps say that they are RegExps
		if (isRegExp(value)) base = ' ' + RegExp.prototype.toString.call(value);

		//TODO: else if
		// Make dates with properties first say the date
		if (isDate(value)) base = ' ' + Date.prototype.toUTCString.call(value);

		// Make error with message first say the error
		if (isError(value)) base = ' ' + formatError(value);

		// Make boxed primitive Strings look like such
		if (typeof raw === 'string') base = `[String: ${ formatPrimitive(ctx, raw) }]`;

		// Make boxed primitive Numbers look like such
		if (typeof raw === 'number') base = `[Number: ${ formatPrimitive(ctx, raw) }]`;

		// Make boxed primitive Booleans look like such
		if (typeof raw === 'boolean') base = `[Boolean: ${ formatPrimitive(ctx, raw) }]`;

		// Add constructor name if available
		if (base === '' && constructor) braces[0] = constructor.name + ' ' + braces[0];

		if (empty === true) return braces[0] + base + braces[1];

		if (recurseTimes < 0) return isRegExp(value) ? RegExp.prototype.toString.call(value) : '[Object]';

		ctx.seen.add(value);

		let output = formatter(ctx, value, recurseTimes, visibleKeys, keys);

		ctx.seen.delete(value);

		return reduceToSingleString(output, base, braces);
	};

	const formatPrimitive = (ctx, value) => {
		if (value === undefined) return 'undefined';

		// For some reason typeof null is "object", so special case here.
		if (value === null) return 'null';

		let type = typeof value;

		if (type === 'string') {
			let simple = '\'' + JSON.stringify(value).replace(/^"|"$/g, '').replace(/'/g, '\\\'').replace(/\\"/g, '"') + '\'';
			return simple;
		}
		if (type === 'number') {
			// Format -0 as '-0'. Strict equality won't distinguish 0 from -0,
			// so instead we use the fact that 1 / -0 < 0 whereas 1 / 0 > 0 .
			if (value === 0 && 1 / value < 0) return '-0';
			return `${ value }`;
		}
		if (type === 'boolean') return `${ value }`;
		// es6 symbol primitive
		if (type === 'symbol') return `${ value.toString() }`;
	};

	const formatError = value => `[${ Error.prototype.toString.call(value) }]`,
	      formatObject = (ctx, value, recurseTimes, visibleKeys, keys) => keys.map(key => formatProperty(ctx, value, recurseTimes, visibleKeys, key, false)),
	      formatArray = (ctx, value, recurseTimes, visibleKeys, keys) => {
		let output = [];
		for (let i = 0, l = value.length; i < l; i = i + 1) if (hasOwnProperty(value, String(i))) output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, String(i), true));else output.push('');
		for (let key of keys) {
			if (typeof key === 'symbol' || !key.match(/^\d+$/)) output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, key, true));
		}
		return output;
	},
	      formatSet = (ctx, value, recurseTimes, visibleKeys, keys) => {
		let output = [];
		for (let v of value) {
			let nextRecurseTimes = recurseTimes === null ? null : recurseTimes - 1;
			let str = formatalue(ctx, v, nextRecurseTimes);
			output.push(str);
		}
		for (let key of keys) output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, key, false));
		return output;
	},
	      formatMap = (ctx, value, recurseTimes, visibleKeys, keys) => {
		let output = [];
		value.forEach((v, k) => {
			let nextRecurseTimes = recurseTimes === null ? null : recurseTimes - 1;
			let str = formatValue(ctx, k, nextRecurseTimes);
			str = str + ' => ';
			str = str + formatValue(ctx, v, nextRecurseTimes);
			output.push(str);
		});
		for (let key of keys) {
			output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, key, false));
		}
		return output;
	},
	      formatPromise = (ctx, value, recurseTimes, visibleKeys, keys) => {
		let output = [];
		let internals = inspectPromise(value);
		if (internals.status === 'pending') output.push('<pending>');else {
			let nextRecurseTimes = recurseTimes === null ? null : recurseTimes - 1;
			let str = formatValue(ctx, internals.value, nextRecurseTimes);
			if (internals.status === 'rejected') output.push('<rejected> ' + str);else output.push(str);
		}
		for (let key of keys) {
			output.push(formatProperty(ctx, value, recurseTimes, visibleKeys, key, false));
		}
		return output;
	},
	      formatProperty = (ctx, value, recurseTimes, visibleKeys, key, array) => {
		let name, str, desc;
		desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };
		if (desc.get) str = desc.set ? '[Getter/Setter]' : '[Getter]';else if (desc.set) str = '[Setter]';

		if (!visibleKeys.has(key)) name = typeof key === 'symbol' ? '[' + key.toString() + ']' : '[' + key + ']';
		if (!str) {
			if (ctx.seen.has(desc.value)) {
				str = recurseTimes === null ? formatValue(ctx, desc.value, null) : formatValue(ctx, desc.value, recurseTimes - 1);
				if (str.indexOf('\n') > -1) {
					str = '\n' + str.split('\n').map(line => '   ' + line).join('\n');
					if (array) str = str.substr(2);
				}
			} else str = '[Circular]';
		}
		if (name === undefined) {
			if (array && key.match(/^\d+$/)) return str;
			name = JSON.stringify('' + key);
			if (name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)) name = name.substr(1, name.length - 2);else name = name.replace(/'/g, '\\\'').replace(/\\"/g, '"').replace(/(^"|"$)/g, '\'').replace(/\\\\/g, '\\');
		}

		return name + ': ' + str;
	},
	      reduceToSingleString = (output, base, braces) => {
		let length = output.reduce((prev, cur) => prev + cur.replace(/\u001b\[\d\d?m/g, '').length + 1, 0);

		if (length > 60) return braces[0] + (
		// If the opening "brace" is too large, like in the case of "Set {",
		// we need to force the first item to be on the next line or the
		// items will not line up correctly.
		base === '' && braces[0].length === 1 ? '' : base + '\n ') + ' ' + output.join(',\n  ') + ' ' + braces[1];

		return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];
	};

	const isRegExp = re => objectToString(re) === '[object RegExp]',
	      isDate = d => objectToString(d) === '[object Date]',
	      isError = e => objectToString(e) === '[object Error]' || e instanceof Error,
	      objectToString = o => Object.prototype.toString.call(o),
	      hasOwnProperty = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop);
});
//# sourceMappingURL=data:application/json;base64,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QUNkLE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQzs7OztBQUlYLE1BQUksS0FBSyxFQUFFLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sS0FBSyxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksR0FBRyxLQUFLLENBQUEsQUFBQyxHQUMzRCxHQUFHLEdBQ0gsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FDcEIsR0FBRyxHQUNILE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTs7QUFFZCxTQUFPLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsR0FBRyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtFQUNuRSxDQUFBOztBQUVGLE9BQ0MsUUFBUSxHQUFHLEVBQUUsSUFBSSxjQUFjLENBQUMsRUFBRSxDQUFDLEtBQUssaUJBQWlCO09BQ3pELE1BQU0sR0FBRyxDQUFDLElBQUksY0FBYyxDQUFDLENBQUMsQ0FBQyxLQUFLLGVBQWU7T0FDbkQsT0FBTyxHQUFHLENBQUMsSUFBSSxjQUFjLENBQUMsQ0FBQyxDQUFDLEtBQUssZ0JBQWdCLElBQUksQ0FBQyxZQUFZLEtBQUs7T0FDM0UsY0FBYyxHQUFHLENBQUMsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO09BQ3ZELGNBQWMsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFJLEtBQUssTUFBTSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQSIsImZpbGUiOiJwcml2YXRlL3V0aWwtaW5zcGVjdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuY29uc3QgaW5zcGVjdCA9IChvYmosIG9wdHMpID0+IHtcblx0Ly8gZGVmYXVsdCBvcHRpb25zXG5cdGxldCBjdHggPSB7XG5cdFx0c2VlbjogbmV3IFNldCgpXG5cdH1cblx0aWYgKG9wdHMpXG5cdFx0T2JqZWN0LmFzc2lnbihjdHgsIG9wdHMpXG5cdC8vIHNldCBkZWZhdWx0IG9wdGlvbnNcblx0aWYgKGN0eC5zaG93SGlkZGVuID09PSB1bmRlZmluZWQpIGN0eC5zaG93SGlkZGVuID0gZmFsc2Vcblx0aWYgKGN0eC5kZXB0aCA9PT0gdW5kZWZpbmVkKSBjdHguZGVwdGggPSAyXG5cdGlmIChjdHguY3VzdG9tSW5zcGVjdCA9PT0gdW5kZWZpbmVkKSBjdHguY3VzdG9tSW5zcGVjdCA9IHRydWVcblx0cmV0dXJuIGZvcm1hdFZhbHVlKGN0eCwgb2JqLCBjdHguZGVwdGgpXG59XG5leHBvcnQgZGVmYXVsdCBpbnNwZWN0XG5cbmNvbnN0XG5cdGdldENvbnN0cnVjdG9yT2YgPSBvYmogPT4ge1xuXHRcdHdoaWxlIChvYmopIHtcblx0XHRcdGxldCBkZXNjcmlwdG9yID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosICdjb25zdHJ1Y3RvcicpXG5cdFx0XHRpZiAoZGVzY3JpcHRvciAhPT0gdW5kZWZpbmVkICYmXG5cdFx0XHRcdFx0dHlwZW9mIGRlc2NyaXB0b3IudmFsdWUgPT09ICdmdW5jdGlvbicgJiZcblx0XHRcdFx0XHRkZXNjcmlwdG9yLnZhbHVlLm5hbWUgIT09ICcnKVxuXHRcdFx0XHRyZXR1cm4gZGVzY3JpcHRvci52YWx1ZVxuXG5cdFx0XHRvYmogPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKVxuXHRcdH1cblxuXHRcdHJldHVybiBudWxsXG5cdH0sXG5cblx0aW5zcGVjdFByb21pc2UgPSAoKSA9PiB7XG5cdFx0Ly9UT0RPOiB0aGlzIHdhcyB1c2luZyBEZWJ1Zy4uLlxuXHRcdHJldHVybiBudWxsXG5cdH1cblxuXG5jb25zdCBmb3JtYXRWYWx1ZSA9IChjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMpID0+IHtcblx0Ly8gUHJvdmlkZSBhIGhvb2sgZm9yIHVzZXItc3BlY2lmaWVkIGluc3BlY3QgZnVuY3Rpb25zLlxuXHQvLyBDaGVjayB0aGF0IHZhbHVlIGlzIGFuIG9iamVjdCB3aXRoIGFuIGluc3BlY3QgZnVuY3Rpb24gb24gaXRcblx0aWYgKGN0eC5jdXN0b21JbnNwZWN0ICYmXG5cdFx0XHR2YWx1ZSAmJlxuXHRcdFx0dHlwZW9mIHZhbHVlLmluc3BlY3QgPT09ICdmdW5jdGlvbicgJiZcblx0XHRcdC8vIEZpbHRlciBvdXQgdGhlIHV0aWwgbW9kdWxlLCBpdCdzIGluc3BlY3QgZnVuY3Rpb24gaXMgc3BlY2lhbFxuXHRcdFx0dmFsdWUuaW5zcGVjdCAhPT0gaW5zcGVjdCAmJlxuXHRcdFx0Ly8gQWxzbyBmaWx0ZXIgb3V0IGFueSBwcm90b3R5cGUgb2JqZWN0cyB1c2luZyB0aGUgY2lyY3VsYXIgY2hlY2suXG5cdFx0XHQhKHZhbHVlLmNvbnN0cnVjdG9yICYmIHZhbHVlLmNvbnN0cnVjdG9yLnByb3RvdHlwZSA9PT0gdmFsdWUpKSB7XG5cdFx0bGV0IHJldCA9IHZhbHVlLmluc3BlY3QocmVjdXJzZVRpbWVzLCBjdHgpXG5cdFx0aWYgKHR5cGVvZiByZXQgIT09ICdzdHJpbmcnKVxuXHRcdFx0cmV0ID0gZm9ybWF0VmFsdWUoY3R4LCByZXQsIHJlY3Vyc2VUaW1lcylcblx0XHRyZXR1cm4gcmV0XG5cdH1cblxuXHQvLyBQcmltaXRpdmUgdHlwZXMgY2Fubm90IGhhdmUgcHJvcGVydGllc1xuXHRsZXQgcHJpbWl0aXZlID0gZm9ybWF0UHJpbWl0aXZlKGN0eCwgdmFsdWUpXG5cdGlmIChwcmltaXRpdmUpXG5cdFx0cmV0dXJuIHByaW1pdGl2ZVxuXG5cdC8vIExvb2sgdXAgdGhlIGtleXMgb2YgdGhlIG9iamVjdC5cblx0bGV0IGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSlcblx0bGV0IHZpc2libGVLZXlzID0gbmV3IFNldChrZXlzKVxuXG5cdGlmIChjdHguc2hvd0hpZGRlbikge1xuXHRcdGtleXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh2YWx1ZSlcblx0XHRrZXlzID0ga2V5cy5jb25jYXQoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyh2YWx1ZSkpXG5cdH1cblxuXHQvLyBUaGlzIGNvdWxkIGJlIGEgYm94ZWQgcHJpbWl0aXZlIChuZXcgU3RyaW5nKCksIGV0Yy4pLCBjaGVjayB2YWx1ZU9mKClcblx0Ly8gTk9URTogQXZvaWQgY2FsbGluZyBgdmFsdWVPZmAgb24gYERhdGVgIGluc3RhbmNlIGJlY2F1c2UgaXQgd2lsbCByZXR1cm5cblx0Ly8gYSBudW1iZXIgd2hpY2gsIHdoZW4gb2JqZWN0IGhhcyBzb21lIGFkZGl0aW9uYWwgdXNlci1zdG9yZWQgYGtleXNgLFxuXHQvLyB3aWxsIGJlIHByaW50ZWQgb3V0LlxuXHRsZXQgZm9ybWF0dGVkXG5cdGxldCByYXcgPSB2YWx1ZVxuXHR0cnkge1xuXHRcdC8vIHRoZSAudmFsdWVPZigpIGNhbGwgY2FuIGZhaWwgZm9yIGEgbXVsdGl0dWRlIG9mIHJlYXNvbnNcblx0XHRpZiAoIWlzRGF0ZSh2YWx1ZSkpXG5cdFx0XHRyYXcgPSB2YWx1ZS52YWx1ZU9mKClcblx0fSBjYXRjaCAoZSkge1xuXHRcdC8vIGlnbm9yZS4uLlxuXHR9XG5cblx0aWYgKHR5cGVvZiByYXcgPT09ICdzdHJpbmcnKVxuXHRcdC8vIGZvciBib3hlZCBTdHJpbmdzLCB3ZSBoYXZlIHRvIHJlbW92ZSB0aGUgMC1uIGluZGV4ZWQgZW50cmllcyxcblx0XHQvLyBzaW5jZSB0aGV5IGp1c3Qgbm9pc2V5IHVwIHRoZSBvdXRwdXQgYW5kIGFyZSByZWR1bmRhbnRcblx0XHRrZXlzID0ga2V5cy5maWx0ZXIoa2V5ID0+XG5cdFx0XHQhKGtleSA+PSAwICYmIGtleSA8IHJhdy5sZW5ndGgpKVxuXG5cdC8vIFNvbWUgdHlwZSBvZiBvYmplY3Qgd2l0aG91dCBwcm9wZXJ0aWVzIGNhbiBiZSBzaG9ydGN1dHRlZC5cblx0aWYgKGtleXMubGVuZ3RoID09PSAwKSB7XG5cdFx0aWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcblx0XHRcdHJldHVybiBgW0Z1bmN0aW9uJHt2YWx1ZS5uYW1lID8gYDogJHt2YWx1ZS5uYW1lfWAgOiAnJ31dYFxuXHRcdGlmIChpc1JlZ0V4cCh2YWx1ZSkpXG5cdFx0XHRyZXR1cm4gUmVnRXhwLnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKVxuXHRcdGlmIChpc0RhdGUodmFsdWUpKVxuXHRcdFx0cmV0dXJuIERhdGUucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpXG5cdFx0aWYgKGlzRXJyb3IodmFsdWUpKVxuXHRcdFx0cmV0dXJuIGZvcm1hdEVycm9yKHZhbHVlKVxuXHRcdC8vIG5vdyBjaGVjayB0aGUgYHJhd2AgdmFsdWUgdG8gaGFuZGxlIGJveGVkIHByaW1pdGl2ZXNcblx0XHRpZiAodHlwZW9mIHJhdyA9PT0gJ3N0cmluZycpXG5cdFx0XHRyZXR1cm4gYFtTdHJpbmc6ICR7Zm9ybWF0UHJpbWl0aXZlKGN0eCwgcmF3KX1dYFxuXHRcdGlmICh0eXBlb2YgcmF3ID09PSAnbnVtYmVyJylcblx0XHRcdHJldHVybiBgW051bWJlcjogJHtmb3JtYXRQcmltaXRpdmUoY3R4LCByYXcpfV1gXG5cdFx0aWYgKHR5cGVvZiByYXcgPT09ICdib29sZWFuJylcblx0XHRcdHJldHVybiBgW0Jvb2xlYW46ICR7Zm9ybWF0UHJpbWl0aXZlKGN0eCwgcmF3KX1dYFxuXHR9XG5cblx0bGV0IGNvbnN0cnVjdG9yID0gZ2V0Q29uc3RydWN0b3JPZih2YWx1ZSlcblx0bGV0IGJhc2UgPSAnJywgZW1wdHkgPSBmYWxzZSwgYnJhY2VzLCBmb3JtYXR0ZXJcblxuXHRpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcblx0XHRpZiAoY29uc3RydWN0b3IgPT09IEFycmF5KVxuXHRcdFx0Y29uc3RydWN0b3IgPSBudWxsXG5cdFx0YnJhY2VzID0gWydbJywgJ10nXVxuXHRcdGVtcHR5ID0gdmFsdWUubGVuZ3RoID09PSAwXG5cdFx0Zm9ybWF0dGVyID0gZm9ybWF0QXJyYXlcblx0fSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFNldCkge1xuXHRcdGJyYWNlcyA9IFsneycsICd9J11cblx0XHQvLyBXaXRoIGBzaG93SGlkZGVuYCwgYGxlbmd0aGAgd2lsbCBkaXNwbGF5IGFzIGEgaGlkZGVuIHByb3BlcnR5IGZvclxuXHRcdC8vIGFycmF5cy4gRm9yIGNvbnNpc3RlbmN5J3Mgc2FrZSwgZG8gdGhlIHNhbWUgZm9yIGBzaXplYCwgZXZlbiB0aG91Z2ggdGhpc1xuXHRcdC8vIHByb3BlcnR5IGlzbid0IHNlbGVjdGVkIGJ5IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKCkuXG5cdFx0aWYgKGN0eC5zaG93SGlkZGVuKVxuXHRcdFx0a2V5cy51bnNoaWZ0KCdzaXplJylcblx0XHRlbXB0eSA9IHZhbHVlLnNpemUgPT09IDBcblx0XHRmb3JtYXR0ZXIgPSBmb3JtYXRTZXRcblx0fSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE1hcCkge1xuXHRcdGJyYWNlcyA9IFsneycsICd9J11cblx0XHQvLyBEaXR0by5cblx0XHRpZiAoY3R4LnNob3dIaWRkZW4pXG5cdFx0XHRrZXlzLnVuc2hpZnQoJ3NpemUnKVxuXHRcdGVtcHR5ID0gdmFsdWUuc2l6ZSA9PT0gMFxuXHRcdGZvcm1hdHRlciA9IGZvcm1hdE1hcFxuXHR9IGVsc2Uge1xuXHRcdC8vIE9ubHkgY3JlYXRlIGEgbWlycm9yIGlmIHRoZSBvYmplY3Qgc3VwZXJmaWNpYWxseSBsb29rcyBsaWtlIGEgUHJvbWlzZS5cblx0XHRsZXQgcHJvbWlzZUludGVybmFscyA9IHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSAmJiBpbnNwZWN0UHJvbWlzZSh2YWx1ZSlcblx0XHRpZiAocHJvbWlzZUludGVybmFscykge1xuXHRcdFx0YnJhY2VzID0gWyd7JywgJ30nXVxuXHRcdFx0Zm9ybWF0dGVyID0gZm9ybWF0UHJvbWlzZVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoY29uc3RydWN0b3IgPT09IE9iamVjdClcblx0XHRcdFx0Y29uc3RydWN0b3IgPSBudWxsXG5cdFx0XHRicmFjZXMgPSBbJ3snLCAnfSddXG5cdFx0XHRlbXB0eSA9IHRydWUgIC8vIE5vIG90aGVyIGRhdGEgdGhhbiBrZXlzLlxuXHRcdFx0Zm9ybWF0dGVyID0gZm9ybWF0T2JqZWN0XG5cdFx0fVxuXHR9XG5cblx0ZW1wdHkgPSBlbXB0eSA9PT0gdHJ1ZSAmJiBrZXlzLmxlbmd0aCA9PT0gMFxuXG5cdC8vIE1ha2UgZnVuY3Rpb25zIHNheSB0aGF0IHRoZXkgYXJlIGZ1bmN0aW9uc1xuXHRpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG5cdFx0bGV0IG4gPSB2YWx1ZS5uYW1lID8gJzogJyArIHZhbHVlLm5hbWUgOiAnJ1xuXHRcdGJhc2UgPSAnIFtGdW5jdGlvbicgKyBuICsgJ10nXG5cdH1cblxuXHQvLyBNYWtlIFJlZ0V4cHMgc2F5IHRoYXQgdGhleSBhcmUgUmVnRXhwc1xuXHRpZiAoaXNSZWdFeHAodmFsdWUpKVxuXHRcdGJhc2UgPSAnICcgKyBSZWdFeHAucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpXG5cblx0Ly9UT0RPOiBlbHNlIGlmXG5cdC8vIE1ha2UgZGF0ZXMgd2l0aCBwcm9wZXJ0aWVzIGZpcnN0IHNheSB0aGUgZGF0ZVxuXHRpZiAoaXNEYXRlKHZhbHVlKSlcblx0XHRiYXNlID0gJyAnICsgRGF0ZS5wcm90b3R5cGUudG9VVENTdHJpbmcuY2FsbCh2YWx1ZSlcblxuXHQvLyBNYWtlIGVycm9yIHdpdGggbWVzc2FnZSBmaXJzdCBzYXkgdGhlIGVycm9yXG5cdGlmIChpc0Vycm9yKHZhbHVlKSlcblx0XHRiYXNlID0gJyAnICsgZm9ybWF0RXJyb3IodmFsdWUpXG5cblx0Ly8gTWFrZSBib3hlZCBwcmltaXRpdmUgU3RyaW5ncyBsb29rIGxpa2Ugc3VjaFxuXHRpZiAodHlwZW9mIHJhdyA9PT0gJ3N0cmluZycpXG5cdFx0YmFzZSA9IGBbU3RyaW5nOiAke2Zvcm1hdFByaW1pdGl2ZShjdHgsIHJhdyl9XWBcblxuXHQvLyBNYWtlIGJveGVkIHByaW1pdGl2ZSBOdW1iZXJzIGxvb2sgbGlrZSBzdWNoXG5cdGlmICh0eXBlb2YgcmF3ID09PSAnbnVtYmVyJylcblx0XHRiYXNlID0gYFtOdW1iZXI6ICR7Zm9ybWF0UHJpbWl0aXZlKGN0eCwgcmF3KX1dYFxuXG5cdC8vIE1ha2UgYm94ZWQgcHJpbWl0aXZlIEJvb2xlYW5zIGxvb2sgbGlrZSBzdWNoXG5cdGlmICh0eXBlb2YgcmF3ID09PSAnYm9vbGVhbicpXG5cdFx0YmFzZSA9IGBbQm9vbGVhbjogJHtmb3JtYXRQcmltaXRpdmUoY3R4LCByYXcpfV1gXG5cblx0Ly8gQWRkIGNvbnN0cnVjdG9yIG5hbWUgaWYgYXZhaWxhYmxlXG5cdGlmIChiYXNlID09PSAnJyAmJiBjb25zdHJ1Y3Rvcilcblx0XHRicmFjZXNbMF0gPSBjb25zdHJ1Y3Rvci5uYW1lICsgJyAnICsgYnJhY2VzWzBdXG5cblx0aWYgKGVtcHR5ID09PSB0cnVlKVxuXHRcdHJldHVybiBicmFjZXNbMF0gKyBiYXNlICsgYnJhY2VzWzFdXG5cblx0aWYgKHJlY3Vyc2VUaW1lcyA8IDApXG5cdFx0cmV0dXJuIGlzUmVnRXhwKHZhbHVlKSA/IFJlZ0V4cC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh2YWx1ZSkgOiAnW09iamVjdF0nXG5cblx0Y3R4LnNlZW4uYWRkKHZhbHVlKVxuXG5cdGxldCBvdXRwdXQgPSBmb3JtYXR0ZXIoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cylcblxuXHRjdHguc2Vlbi5kZWxldGUodmFsdWUpXG5cblx0cmV0dXJuIHJlZHVjZVRvU2luZ2xlU3RyaW5nKG91dHB1dCwgYmFzZSwgYnJhY2VzKVxufVxuXG5jb25zdCBmb3JtYXRQcmltaXRpdmUgPSAoY3R4LCB2YWx1ZSkgPT4ge1xuXHRpZiAodmFsdWUgPT09IHVuZGVmaW5lZClcblx0XHRyZXR1cm4gJ3VuZGVmaW5lZCdcblxuXHQvLyBGb3Igc29tZSByZWFzb24gdHlwZW9mIG51bGwgaXMgXCJvYmplY3RcIiwgc28gc3BlY2lhbCBjYXNlIGhlcmUuXG5cdGlmICh2YWx1ZSA9PT0gbnVsbClcblx0XHRyZXR1cm4gJ251bGwnXG5cblx0bGV0IHR5cGUgPSB0eXBlb2YgdmFsdWVcblxuXHRpZiAodHlwZSA9PT0gJ3N0cmluZycpIHtcblx0XHRsZXQgc2ltcGxlID0gJ1xcJycgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkucmVwbGFjZSgvXlwifFwiJC9nLCAnJylcblx0XHRcdFx0LnJlcGxhY2UoLycvZywgJ1xcXFxcXCcnKVxuXHRcdFx0XHQucmVwbGFjZSgvXFxcXFwiL2csICdcIicpICsgJ1xcJydcblx0XHRyZXR1cm4gc2ltcGxlXG5cdH1cblx0aWYgKHR5cGUgPT09ICdudW1iZXInKSB7XG5cdFx0Ly8gRm9ybWF0IC0wIGFzICctMCcuIFN0cmljdCBlcXVhbGl0eSB3b24ndCBkaXN0aW5ndWlzaCAwIGZyb20gLTAsXG5cdFx0Ly8gc28gaW5zdGVhZCB3ZSB1c2UgdGhlIGZhY3QgdGhhdCAxIC8gLTAgPCAwIHdoZXJlYXMgMSAvIDAgPiAwIC5cblx0XHRpZiAodmFsdWUgPT09IDAgJiYgMSAvIHZhbHVlIDwgMClcblx0XHRcdHJldHVybiAnLTAnXG5cdFx0cmV0dXJuIGAke3ZhbHVlfWBcblx0fVxuXHRpZiAodHlwZSA9PT0gJ2Jvb2xlYW4nKVxuXHRcdHJldHVybiBgJHt2YWx1ZX1gXG5cdC8vIGVzNiBzeW1ib2wgcHJpbWl0aXZlXG5cdGlmICh0eXBlID09PSAnc3ltYm9sJylcblx0XHRyZXR1cm4gYCR7dmFsdWUudG9TdHJpbmcoKX1gXG59XG5cbmNvbnN0XG5cdGZvcm1hdEVycm9yID0gdmFsdWUgPT5cblx0XHRgWyR7RXJyb3IucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwodmFsdWUpfV1gLFxuXG5cdGZvcm1hdE9iamVjdCA9IChjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLCBrZXlzKSA9PlxuXHRcdGtleXMubWFwKGtleSA9PiBmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLCBrZXksIGZhbHNlKSksXG5cblx0Zm9ybWF0QXJyYXkgPSAoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cykgPT4ge1xuXHRcdGxldCBvdXRwdXQgPSBbXVxuXHRcdGZvciAobGV0IGkgPSAwLCBsID0gdmFsdWUubGVuZ3RoOyBpIDwgbDsgaSA9IGkgKyAxKVxuXHRcdFx0aWYgKGhhc093blByb3BlcnR5KHZhbHVlLCBTdHJpbmcoaSkpKVxuXHRcdFx0XHRvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLFxuXHRcdFx0XHRcdFx0U3RyaW5nKGkpLCB0cnVlKSlcblx0XHRcdGVsc2Vcblx0XHRcdFx0b3V0cHV0LnB1c2goJycpXG5cdFx0Zm9yIChsZXQga2V5IG9mIGtleXMpIHtcblx0XHRcdGlmICh0eXBlb2Yga2V5ID09PSAnc3ltYm9sJyB8fCAha2V5Lm1hdGNoKC9eXFxkKyQvKSlcblx0XHRcdFx0b3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cyxcblx0XHRcdFx0XHRcdGtleSwgdHJ1ZSkpXG5cdFx0fVxuXHRcdHJldHVybiBvdXRwdXRcblx0fSxcblxuXHRmb3JtYXRTZXQgPSAoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cykgPT4ge1xuXHRcdGxldCBvdXRwdXQgPSBbXVxuXHRcdGZvciAobGV0IHYgb2YgdmFsdWUpIHtcblx0XHRcdGxldCBuZXh0UmVjdXJzZVRpbWVzID0gcmVjdXJzZVRpbWVzID09PSBudWxsID8gbnVsbCA6IHJlY3Vyc2VUaW1lcyAtIDFcblx0XHRcdGxldCBzdHIgPSBmb3JtYXRhbHVlKGN0eCwgdiwgbmV4dFJlY3Vyc2VUaW1lcylcblx0XHRcdG91dHB1dC5wdXNoKHN0cilcblx0XHR9XG5cdFx0Zm9yIChsZXQga2V5IG9mIGtleXMpXG5cdFx0XHRvdXRwdXQucHVzaChmb3JtYXRQcm9wZXJ0eShjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLFxuXHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHQga2V5LCBmYWxzZSkpXG5cdFx0cmV0dXJuIG91dHB1dFxuXHR9LFxuXG5cdGZvcm1hdE1hcCA9IChjdHgsIHZhbHVlLCByZWN1cnNlVGltZXMsIHZpc2libGVLZXlzLCBrZXlzKSA9PiB7XG5cdFx0bGV0IG91dHB1dCA9IFtdXG5cdFx0dmFsdWUuZm9yRWFjaCgodiwgaykgPT4ge1xuXHRcdFx0bGV0IG5leHRSZWN1cnNlVGltZXMgPSByZWN1cnNlVGltZXMgPT09IG51bGwgPyBudWxsIDogcmVjdXJzZVRpbWVzIC0gMVxuXHRcdFx0bGV0IHN0ciA9IGZvcm1hdFZhbHVlKGN0eCwgaywgbmV4dFJlY3Vyc2VUaW1lcylcblx0XHRcdHN0ciA9IHN0ciArICcgPT4gJ1xuXHRcdFx0c3RyID0gc3RyICsgZm9ybWF0VmFsdWUoY3R4LCB2LCBuZXh0UmVjdXJzZVRpbWVzKVxuXHRcdFx0b3V0cHV0LnB1c2goc3RyKVxuXHRcdH0pXG5cdFx0Zm9yIChsZXQga2V5IG9mIGtleXMpIHtcblx0XHRcdG91dHB1dC5wdXNoKGZvcm1hdFByb3BlcnR5KGN0eCwgdmFsdWUsIHJlY3Vyc2VUaW1lcywgdmlzaWJsZUtleXMsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdCBrZXksIGZhbHNlKSlcblx0XHR9XG5cdFx0cmV0dXJuIG91dHB1dFxuXHR9LFxuXG5cdGZvcm1hdFByb21pc2UgPSAoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5cykgPT4ge1xuXHRcdGxldCBvdXRwdXQgPSBbXVxuXHRcdGxldCBpbnRlcm5hbHMgPSBpbnNwZWN0UHJvbWlzZSh2YWx1ZSlcblx0XHRpZiAoaW50ZXJuYWxzLnN0YXR1cyA9PT0gJ3BlbmRpbmcnKVxuXHRcdFx0b3V0cHV0LnB1c2goJzxwZW5kaW5nPicpXG5cdFx0ZWxzZSB7XG5cdFx0XHRsZXQgbmV4dFJlY3Vyc2VUaW1lcyA9IHJlY3Vyc2VUaW1lcyA9PT0gbnVsbCA/IG51bGwgOiByZWN1cnNlVGltZXMgLSAxXG5cdFx0XHRsZXQgc3RyID0gZm9ybWF0VmFsdWUoY3R4LCBpbnRlcm5hbHMudmFsdWUsIG5leHRSZWN1cnNlVGltZXMpXG5cdFx0XHRpZiAoaW50ZXJuYWxzLnN0YXR1cyA9PT0gJ3JlamVjdGVkJylcblx0XHRcdFx0b3V0cHV0LnB1c2goJzxyZWplY3RlZD4gJyArIHN0cilcblx0XHRcdGVsc2Vcblx0XHRcdFx0b3V0cHV0LnB1c2goc3RyKVxuXHRcdH1cblx0XHRmb3IgKGxldCBrZXkgb2Yga2V5cykge1xuXHRcdFx0b3V0cHV0LnB1c2goZm9ybWF0UHJvcGVydHkoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cyxcblx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0XHRcdFx0IGtleSwgZmFsc2UpKVxuXHRcdH1cblx0XHRyZXR1cm4gb3V0cHV0XG5cdH0sXG5cblx0Zm9ybWF0UHJvcGVydHkgPSAoY3R4LCB2YWx1ZSwgcmVjdXJzZVRpbWVzLCB2aXNpYmxlS2V5cywga2V5LCBhcnJheSkgPT4ge1xuXHRcdGxldCBuYW1lLCBzdHIsIGRlc2Ncblx0XHRkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih2YWx1ZSwga2V5KSB8fCB7IHZhbHVlOiB2YWx1ZVtrZXldIH1cblx0XHRpZiAoZGVzYy5nZXQpXG5cdFx0XHRzdHIgPSBkZXNjLnNldCA/ICdbR2V0dGVyL1NldHRlcl0nIDogJ1tHZXR0ZXJdJ1xuXHRcdGVsc2UgaWYgKGRlc2Muc2V0KVxuXHRcdFx0c3RyID0gJ1tTZXR0ZXJdJ1xuXG5cdFx0aWYgKCF2aXNpYmxlS2V5cy5oYXMoa2V5KSlcblx0XHRcdG5hbWUgPSB0eXBlb2Yga2V5ID09PSAnc3ltYm9sJyA/XG5cdFx0XHRcdCdbJyArIGtleS50b1N0cmluZygpICsgJ10nIDpcblx0XHRcdFx0J1snICsga2V5ICsgJ10nXG5cdFx0aWYgKCFzdHIpIHtcblx0XHRcdGlmIChjdHguc2Vlbi5oYXMoZGVzYy52YWx1ZSkpIHtcblx0XHRcdFx0c3RyID0gcmVjdXJzZVRpbWVzID09PSBudWxsID9cblx0XHRcdFx0XHRmb3JtYXRWYWx1ZShjdHgsIGRlc2MudmFsdWUsIG51bGwpIDpcblx0XHRcdFx0XHRmb3JtYXRWYWx1ZShjdHgsIGRlc2MudmFsdWUsIHJlY3Vyc2VUaW1lcyAtIDEpXG5cdFx0XHRcdGlmIChzdHIuaW5kZXhPZignXFxuJykgPiAtMSkge1xuXHRcdFx0XHRcdHN0ciA9ICdcXG4nICsgc3RyLnNwbGl0KCdcXG4nKS5tYXAobGluZSA9PiAnICAgJyArIGxpbmUpLmpvaW4oJ1xcbicpXG5cdFx0XHRcdFx0aWYgKGFycmF5KVxuXHRcdFx0XHRcdFx0c3RyID0gc3RyLnN1YnN0cigyKVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Vcblx0XHRcdFx0c3RyID0gJ1tDaXJjdWxhcl0nXG5cdFx0fVxuXHRcdGlmIChuYW1lID09PSB1bmRlZmluZWQpIHtcblx0XHRcdGlmIChhcnJheSAmJiBrZXkubWF0Y2goL15cXGQrJC8pKVxuXHRcdFx0XHRyZXR1cm4gc3RyXG5cdFx0XHRuYW1lID0gSlNPTi5zdHJpbmdpZnkoJycgKyBrZXkpXG5cdFx0XHRpZiAobmFtZS5tYXRjaCgvXlwiKFthLXpBLVpfXVthLXpBLVpfMC05XSopXCIkLykpXG5cdFx0XHRcdG5hbWUgPSBuYW1lLnN1YnN0cigxLCBuYW1lLmxlbmd0aCAtIDIpXG5cdFx0XHRlbHNlXG5cdFx0XHRcdG5hbWUgPSBuYW1lLnJlcGxhY2UoLycvZywgJ1xcXFxcXCcnKVxuXHRcdFx0XHRcdFx0XHRcdFx0IC5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJylcblx0XHRcdFx0XHRcdFx0XHRcdCAucmVwbGFjZSgvKF5cInxcIiQpL2csICdcXCcnKVxuXHRcdFx0XHRcdFx0XHRcdFx0IC5yZXBsYWNlKC9cXFxcXFxcXC9nLCAnXFxcXCcpXG5cdFx0fVxuXG5cdFx0cmV0dXJuIG5hbWUgKyAnOiAnICsgc3RyXG5cdH0sXG5cblx0cmVkdWNlVG9TaW5nbGVTdHJpbmcgPSAob3V0cHV0LCBiYXNlLCBicmFjZXMpID0+IHtcblx0XHRsZXQgbGVuZ3RoID0gb3V0cHV0LnJlZHVjZShcblx0XHRcdChwcmV2LCBjdXIpID0+cHJldiArIGN1ci5yZXBsYWNlKC9cXHUwMDFiXFxbXFxkXFxkP20vZywgJycpLmxlbmd0aCArIDEsXG5cdFx0XHQwKVxuXG5cdFx0aWYgKGxlbmd0aCA+IDYwKVxuXHRcdFx0cmV0dXJuIGJyYWNlc1swXSArXG5cdFx0XHRcdFx0XHQgLy8gSWYgdGhlIG9wZW5pbmcgXCJicmFjZVwiIGlzIHRvbyBsYXJnZSwgbGlrZSBpbiB0aGUgY2FzZSBvZiBcIlNldCB7XCIsXG5cdFx0XHRcdFx0XHQgLy8gd2UgbmVlZCB0byBmb3JjZSB0aGUgZmlyc3QgaXRlbSB0byBiZSBvbiB0aGUgbmV4dCBsaW5lIG9yIHRoZVxuXHRcdFx0XHRcdFx0IC8vIGl0ZW1zIHdpbGwgbm90IGxpbmUgdXAgY29ycmVjdGx5LlxuXHRcdFx0XHRcdFx0IChiYXNlID09PSAnJyAmJiBicmFjZXNbMF0ubGVuZ3RoID09PSAxID8gJycgOiBiYXNlICsgJ1xcbiAnKSArXG5cdFx0XHRcdFx0XHQgJyAnICtcblx0XHRcdFx0XHRcdCBvdXRwdXQuam9pbignLFxcbiAgJykgK1xuXHRcdFx0XHRcdFx0ICcgJyArXG5cdFx0XHRcdFx0XHQgYnJhY2VzWzFdXG5cblx0XHRyZXR1cm4gYnJhY2VzWzBdICsgYmFzZSArICcgJyArIG91dHB1dC5qb2luKCcsICcpICsgJyAnICsgYnJhY2VzWzFdXG5cdH1cblxuY29uc3Rcblx0aXNSZWdFeHAgPSByZSA9PiBvYmplY3RUb1N0cmluZyhyZSkgPT09ICdbb2JqZWN0IFJlZ0V4cF0nLFxuXHRpc0RhdGUgPSBkID0+IG9iamVjdFRvU3RyaW5nKGQpID09PSAnW29iamVjdCBEYXRlXScsXG5cdGlzRXJyb3IgPSBlID0+IG9iamVjdFRvU3RyaW5nKGUpID09PSAnW29iamVjdCBFcnJvcl0nIHx8IGUgaW5zdGFuY2VvZiBFcnJvcixcblx0b2JqZWN0VG9TdHJpbmcgPSBvID0+IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKSxcblx0aGFzT3duUHJvcGVydHkgPSAob2JqLCBwcm9wKSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKVxuIl0sInNvdXJjZVJvb3QiOiIvc3JjIn0=